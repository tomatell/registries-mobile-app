!function(angular){"use strict";angular.module("xpsui:services",[])}(angular),function(angular){"use strict";function dotAccess(obj,key,def){key=Array.isArray(key)?key:key.split(".");for(var i=0,l=key.length;l>i;i++){var part=key[i];if(!(part in obj))return def;obj=obj[part]}return obj}angular.module("xpsui:services").factory("xpsui:Calculator:ComputationRegistry",["$q",function(q){return{noop:function(args){return args},concat:function(args){for(var keys=Object.keys(args).sort(),result="",i=0;i<keys.length;i++)result=result.concat(args[keys[i]]);return result},get:function(args,scope,def){var keys=Object.keys(args).sort(),path=args[keys[0]];return dotAccess(scope,path,def)},substr:function(args){var length,keys=Object.keys(args).sort(),string=args[keys[0]],start=args[keys[1]];return keys[2]&&(length=args[keys[2]]),string.substr(start,length)},mod:function(args){var keys=Object.keys(args).sort(),first=args[keys[0]],second=args[keys[1]];return first%second},replace:function(args){var keys=Object.keys(args).sort(),string=args[keys[0]],search=args[keys[1]],value=args[keys[2]];return string.replace(search,value)},"if":function(args){var keys=Object.keys(args).sort(),condition=args[keys[0]],first=args[keys[1]],second=args[keys[2]];return condition?first:second},length:function(args){var keys=Object.keys(args).sort(),first=args[keys[0]];return first.length},eq:function(args){var keys=Object.keys(args).sort(),first=args[keys[0]],second=args[keys[1]];return first==second},gt:function(args){var keys=Object.keys(args).sort(),first=args[keys[0]],second=args[keys[1]];return first>second},gte:function(args){var keys=Object.keys(args).sort(),first=args[keys[0]],second=args[keys[1]];return first>=second},lt:function(args){var keys=Object.keys(args).sort(),first=args[keys[0]],second=args[keys[1]];return second>first},lte:function(args){var keys=Object.keys(args).sort(),first=args[keys[0]],second=args[keys[1]];return second>=first},and:function(args){var keys=Object.keys(args).sort(),first=args[keys[0]],second=args[keys[1]];return first&&second},or:function(args){var keys=Object.keys(args).sort(),first=args[keys[0]],second=args[keys[1]];return first||second},pad:function(args){var keys=Object.keys(args).sort(),string=args[keys[0]]+"",size=args[keys[1]],fill="0";for(keys[2]&&(fill=args[keys[2]]);string.length<size;)string=fill+string;return string}}}]).factory("xpsui:Calculator:ComputedProperty",["$q","xpsui:Calculator:ComputationRegistry",function(q,computationRegistry){function ComputedProperty(schema){this.schema=schema}return ComputedProperty.prototype.getter=function(scope){var computationFunc=computationRegistry[this.schema.func]||computationRegistry.noop,args={},self=this;for(var argName in this.schema.args)if(this.schema.args.hasOwnProperty(argName)){var arg=this.schema.args[argName];if("object"==typeof arg){var argProperty=new ComputedProperty(arg);args[argName]=argProperty.getter(scope)}else args[argName]=arg}return q.all(args).then(function(results){return computationFunc(results,scope,self.schema.def)})},ComputedProperty.prototype.watcher=function(scope){function collect(subschema){var result=[];for(var argName in subschema.args)if(subschema.args.hasOwnProperty(argName)){var arg=subschema.args[argName];"object"==typeof arg&&("get"===arg.func?arg.watch===!0&&result.push(dotAccess(scope,arg.args.path,arg.def)):arg.args&&(result=result.concat(collect(arg))))}return result}var self=this;return function(){return collect(self.schema)}},ComputedProperty}]).factory("xpsui:Calculator",["xpsui:Calculator:ComputedProperty",function(ComputedProperty){return{createProperty:function(schema){return new ComputedProperty(schema)}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:ComponentGenerator",["xpsui:logging",function(log){function isPrimitiveProperty(schemaFragment){return!schemaFragment.type||"string"!==schemaFragment.type&&"number"!==schemaFragment.type?!1:!0}function generatePrimitiveViewControl(schemaFragment,schemaPath,modelPath){var control=angular.element("<div xpsui-string-view></div>");return control.attr("ng-model",modelPath),control}function generatePrimitiveEditControl(schemaFragment,schemaPath,modelPath){var control=angular.element("<div xpsui-string-edit></div>");return control.attr("ng-model",modelPath),control}function generateStandardPrimitivePropertyPair(schemaFragment,schemaPath,modelPath,mode){var propContainer=angular.element('<div class="x-standard-prop-pair"></div>'),label=angular.element('<div class="x-label"></div>');propContainer.append(label),schemaFragment&&schemaFragment.title&&label.text(schemaFragment.title);var control;if("EDIT_MODE"===mode)control=generatePrimitiveEditControl(schemaFragment,schemaPath,modelPath);else if("VIEW_MODE"===mode)control=generatePrimitiveViewControl(schemaFragment,schemaPath,modelPath);else if("EDITVIEW_MODE"!==mode)return log.error("Unknown mode"),null;return propContainer.append(control),propContainer}function generate(schemaFragment,schemaPath,modelPath,mode){var result;return schemaFragment?schemaFragment.type&&"array"===schemaFragment.type?(result=angular.element("<xpsui-array></xpsui-array>"),result.attr("xpsui-schema",schemaPath),result.attr("xpsui-model",modelPath),result):isPrimitiveProperty(schemaFragment)?generateStandardPrimitivePropertyPair(schemaFragment,schemaPath,modelPath,mode||VIEW_MODE):(result=angular.element("<div xpsui-fieldset></div>"),result.attr("xpsui-schema",schemaPath),result.attr("xpsui-model",modelPath),result):void log.error("No schemaFragment provided, cannot generate component")}var VIEW_MODE="VIEW_MODE";return{generate:generate}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:DateUtil",["xpsui:logging","$translate",function(log,$translate){function getDateFromYYYYMMDD(value){var year=value.substring(0,4),month=value.substring(4,6),day=value.substring(6,8);return 4===year.length&&2===month.length&&2===day.length?new Date(year,month-1,day):null}function getDateFromDMYYYY(value){if(/^[0-9]{1,2}\.[0-9]{1,2}\.[1-9][0-9][0-9][0-9]$/.test(value)){var s=value.split("."),day=parseInt(s[0]),month=parseInt(s[1]),year=parseInt(s[2]);if(day>0&&32>day&&month>0&&13>month&&year>0&&1e4>year){var d=new Date;return d.setDate(day),d.setMonth(month-1),d.setYear(year),d}}return null}function formatterDMYYYY(date){return angular.isString(date)&&(date=getDateFromYYYYMMDD(date)),date instanceof Date?date.getDate()+"."+(date.getMonth()+1)+"."+date.getFullYear():null}function formatterYYYYMMDD(date){if(date instanceof Date){var ys=date.getFullYear().toString(10),ms=(date.getMonth()+1).toString(10);ms.length<2&&(ms="0".concat(ms));var ds=date.getDate().toString();return ds.length<2&&(ds="0".concat(ds)),ds.conat(".",ms,".",ys)}return null}function parserDMYYYY(value){var date;if(date=angular.isDate(value)?new Date(value.getTime()):getDateFromDMYYYY(value),angular.isDate(date)){var ys=date.getFullYear().toString(10),ms=(date.getMonth()+1).toString(10);ms.length<2&&(ms="0".concat(ms));var ds=date.getDate().toString();return ds.length<2&&(ds="0".concat(ds)),ys.concat(ms,ds)}return null}function nowToReverse(){return parserDMYYYY(new Date)}return{getDateFromYYYYMMDD:getDateFromYYYYMMDD,nowToReverse:function(){return nowToReverse()},formatter:function(value){if(value){var string=formatterDMYYYY(value);return string?string:value}return""},parser:function(value){if(value){var string=parserDMYYYY(value);return string?string:void 0}},formatterToBackend:function(value){if(value){var string=formatterYYYYMMDD(value);return string?string:value}return""},getNameOfMonth:function(month){return 0==month?$translate.instant("date.jan"):1==month?$translate.instant("date.feb"):2==month?$translate.instant("date.mar"):3==month?$translate.instant("date.apr"):4==month?$translate.instant("date.may"):5==month?$translate.instant("date.jun"):6==month?$translate.instant("date.jul"):7==month?$translate.instant("date.aug"):8==month?$translate.instant("date.sep"):9==month?$translate.instant("date.oct"):10==month?$translate.instant("date.nov"):11==month?$translate.instant("date.dec"):void 0}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:DropdownFactory",["xpsui:logging","$timeout","$translate",function(log,$timeout,$translate){function Dropdown($element,options){this.$element=$element,this.options=angular.extend({},Dropdown.DEFAULTS,options||{}),this.closeTimeout=null}return Dropdown.DEFAULTS={closingTime:150,clsOpen:"x-open",bodyClsOpen:"x-dropdown-open-sm",allowClose:!0,showDropdownAction:!0,titleTransCode:null},Dropdown.prototype.getElement=function(){return this.$element},Dropdown.prototype.getContentElement=function(){return this.$bodyEl},Dropdown.prototype.setInput=function(input){var self=this;return this.$inputElement=input,this.$inputElement.on("keydown",function(evt){switch(evt.keyCode){case 40:case 13:self.open()}}),this},Dropdown.prototype.renderInit=function(){var self=this;this.$contentEl||(this.initDropdownAtion(),this.$contentEl=angular.element('<div class="x-dropdown-content"></div>'),this.$contentInnerEl=angular.element('<div class="x-dropdown-content-inner"></div>'),this.$contentEl.append(this.$contentInnerEl),this.$titleEl=angular.element('<div class="x-dropdown-header">'+this.getTitle()+"</div>"),this.$contentInnerEl.append(this.$titleEl),this.$closeEl=angular.element('<a href="#" class="x-dropdown-close"></a>'),this.$contentInnerEl.append(this.$closeEl),this.$bodyEl=angular.element('<div class="x-dropdown-body"></div>'),this.$contentInnerEl.append(this.$bodyEl),this.$element.append(this.$actionEl),this.$element.append(this.$contentEl),this.$closeEl.on("click",function(event){self.onCloseButton(event)}))},Dropdown.prototype.initDropdownAtion=function(){var self=this;this.options.showDropdownAction&&(this.$actionEl=angular.element('<div class="x-dropdown-action"><span>'+$translate.instant("Dropdown.toggle")+"</span></div>"),this.$actionEl.on("click",function(event){self.onCloseButton(event)}),this.$element.addClass("x-dropdown-action-enabled"))},Dropdown.prototype.getTitle=function(){return this.options.titleTransCode?$translate.instant(this.options.titleTransCode):""},Dropdown.prototype.onCloseButton=function(event){this.$element.hasClass(this.options.clsOpen)?this.close(!1):this.open(),event.stopPropagation(),event.preventDefault()},Dropdown.prototype.setOptions=function(options){angular.extend(this.options,options||{})},Dropdown.prototype.toggle=function(){this.$element.hasClass(this.options.clsOpen)?this.close():this.open()},Dropdown.prototype.close=function(waiting){var self=this;return void 0===waiting&&(waiting=!0),waiting?(this.closeTimeout=$timeout(function(){self.close(!1)},this.options.closingTime),!0):void(this.options.allowClose&&(this.$element.removeClass(this.options.clsOpen),this.afterClose(),document.querySelector("body").classList.remove(this.options.bodyClsOpen)))},Dropdown.prototype.afterClose=function(){},Dropdown.prototype.open=function(){this.$element.hasClass(this.options.clsOpen)||(this.$element.addClass(this.options.clsOpen),this.afterOpen(),document.querySelector("body").classList.add(this.options.bodyClsOpen))},Dropdown.prototype.afterOpen=function(){},Dropdown.prototype.cancelClosing=function(){this.closeTimeout&&$timeout.cancel(this.closeTimeout)},Dropdown.prototype.render=function(){this.renderInit(),this.$element.addClass("x-dropdown")},{create:function(element,options){return new Dropdown(element,options)}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:FileUploadFactory",["$http",function($http){var idCounter=0,FileUploader=function($scope,data,contentType,url){this.id=++idCounter,this.$scope=$scope,this.data=data,this.xhr=new XMLHttpRequest,this.progress=0,this.contentType=contentType,this.url=url,this.upload=function(callback){var that=this;that.callback=callback,this.xhr.upload.addEventListener("progress",function(evt){evt.lengthComputable&&(that.progress=evt.loaded/evt.total),that.$scope.$emit("psui:fileupload-progress",{uploader:that})}),this.xhr.onreadystatechange=function(){1===that.xhr.readyState?(that.$scope.$emit("psui:fileupload-start",{uploader:that}),that.xhr.setRequestHeader("content-type",that.contentType||"application/octet-stream"),that.xhr.send(that.data)):4===that.xhr.readyState&&(that.progress=1,200===that.xhr.status?(that.$scope.$emit("psui:fileupload-success",{uploader:that}),that.callback(null,that.xhr.responseText)):(that.$scope.$emit("psui-fileupload-fail",{uploader:that}),that.callback(that.xhr.status)))},this.xhr.open("PUT",this.url)}},exports={FileUploader:FileUploader};return exports}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:FormGenerator",["xpsui:logging","$compile","xpsui:ComponentGenerator","$timeout","$translate",function(log,$compile,componentGenerator,$timeout,$translate){function FormGenerator(){}return FormGenerator.prototype.MODE={VIEW:"view",EDIT:"edit",VIEWEDIT:"viewedit"},FormGenerator.prototype.generateLabel=function(schemaFragment){var isRequired=schemaFragment.required?" x-required":"",fieldsetClass="x-fieldset-label";return angular.element('<div class="'+fieldsetClass+" "+isRequired+'" ><span>'+(schemaFragment.transCode?$translate.instant(schemaFragment.transCode):schemaFragment.title)+"</span></div>")},FormGenerator.prototype.generateValidations=function(field,schemaFragment,schemaPath,modelPath,mode){return mode===this.MODE.EDIT&&(schemaFragment.required&&(field.attr("required",!0),field.attr("xpsui-validity-mark","")),schemaFragment.unique&&(console.log(""),field.attr("xpsui-unique",schemaPath+".unique"),field.attr("xpsui-validity-mark",""))),field},FormGenerator.prototype.generateField=function(schemaFragment,schemaPath,modelPath,mode){var field;if(mode===this.MODE.VIEWEDIT)field=angular.element("<div></div>"),field.attr("xpsui-form-control","x"),field.attr("xpsui-inlineedit",this.MODE.VIEW),field.attr("xpsui-model",modelPath),field.attr("xpsui-schema",schemaPath);else if(mode===this.MODE.EDIT){if("array"===schemaFragment.type)field=schemaFragment.items&&schemaFragment.items.render&&schemaFragment.items.render.component?angular.element('<div xpsui-array-control-edit="'+schemaFragment.items.render.component+'"></div>'):angular.element("<div xpsui-array-control-edit></div>"),field.attr("xpsui-schema",schemaPath);else if(schemaFragment.objectLink2)field=angular.element("<div xpsui-objectlink2-edit></div>"),field.attr("xpsui-schema",schemaPath);else if(schemaFragment.uploadableImage||schemaFragment.render&&"psui-uploadable-image"===schemaFragment.render.component){field=angular.element("<div xpsui-uploadable-image xpsui-imageresizor /></div>"),field.attr("xpsui-schema",schemaPath);var width=schemaFragment.uploadableImage?schemaFragment.uploadableImage.width:schemaFragment.render.width,height=schemaFragment.uploadableImage?schemaFragment.uploadableImage.height:schemaFragment.render.height;field.attr("psui-width",width),field.attr("psui-height",height)}else schemaFragment["enum"]?(field=angular.element("<div xpsui-select-edit></div>"),field.attr("xpsui-schema",schemaPath)):field=schemaFragment.render&&schemaFragment.render.component?"psui-textarea"==schemaFragment.render.component?angular.element("<div xpsui-textarea-edit></div>"):"psui-datepicker"==schemaFragment.render.component?angular.element("<div xpsui-date-edit xpsui-calendar ></div>"):"psui-contenteditable"==schemaFragment.render.component?angular.element("<div xpsui-contenteditable></div>"):"psui-uploadable-file"==schemaFragment.render.component?angular.element("<div xpsui-uploadable-file></div>"):angular.element("<div>Unsupported render component "+schemaFragment.render.component+"</div>"):angular.element("<div xpsui-string-edit></div>");field.attr("xpsui-schema",schemaPath),field.attr("ng-model",modelPath)}else{if("array"===schemaFragment.type)field=schemaFragment.items&&schemaFragment.items.render&&schemaFragment.items.render.component?angular.element('<div xpsui-array-control-view="'+schemaFragment.items.render.component+'"></div>'):angular.element("<div xpsui-array-control-view></div>"),field.attr("xpsui-schema",schemaPath);else if(schemaFragment.objectLink2)field=angular.element("<div xpsui-objectlink2-view></div>"),field.attr("xpsui-schema",schemaPath);else if(schemaFragment.uploadableImage||schemaFragment.render&&"psui-uploadable-image"===schemaFragment.render.component){field=angular.element("<div xpsui-uploadable-image-view></div>");var width=schemaFragment.uploadableImage?schemaFragment.uploadableImage.width:schemaFragment.render.width,height=schemaFragment.uploadableImage?schemaFragment.uploadableImage.height:schemaFragment.render.height,style="width: 100% !important;"+(height?"height:"+height+"px !important;":"height:150px;")+"background-size: contain;background-repeat: no-repeat;background-position: top left;";field=angular.element('<div style="'+style+"background-image: url('{{"+modelPath+"?"+modelPath+":'/img/no_photo.jpg'}}')\"></div>")}else"date"===schemaFragment.type||schemaFragment.render&&"psui-datepicker"===schemaFragment.render.component?field=angular.element("<div xpsui-date-view></div>"):schemaFragment["enum"]?(field=angular.element("<div xpsui-select-view></div>"),field.attr("xpsui-schema",schemaPath)):field=angular.element("<div xpsui-string-view></div>");field.attr("ng-model",modelPath)}return field},FormGenerator.prototype.generatePropertyRow=function(schemaFragment,schemaPath,modelPath,mode){if("array"===schemaFragment.type){var container=angular.element("<div ></div>"),row1=angular.element('<div class="x-fieldset-row"></div>');row1.append(this.generateLabel(schemaFragment)),schemaFragment.readOnly&&(mode=this.MODE.VIEW);var row2=angular.element('<div class="x-fieldset-row"></div>');return row2.append(this.generateValidations(this.generateField(schemaFragment,schemaPath,modelPath,mode),schemaFragment,schemaPath,modelPath,mode)),container.append(row1),container.append(row2),container}var row=angular.element('<div class="x-fieldset-row"></div>');row.append(this.generateLabel(schemaFragment));var value=angular.element('<div class="x-fieldset-value"></div>');return schemaFragment.readOnly&&(mode=this.MODE.VIEW),value.append(this.generateValidations(this.generateField(schemaFragment,schemaPath,modelPath,mode),schemaFragment,schemaPath,modelPath,mode)),row.append(value),row},FormGenerator.prototype.generateForm=function(scope,elm,schemaFragment,schemaPath,modelPath,mode){var p,localSchemaPath,localModelPath,localFragment,component;if(!schemaFragment)return void log.warn("Schema fragment not defined, existing");if(schemaFragment)if("object"==typeof schemaFragment.properties)for(p in schemaFragment.properties)component=null,localSchemaPath=schemaPath.concat(".properties.",p),localModelPath=modelPath.concat(".",p),localFragment=schemaFragment.properties[p],log.group('Generating element for "%s"',localSchemaPath),localFragment&&localFragment.type?"object"===localFragment.type?localFragment.objectLink2?component=this.generatePropertyRow(localFragment,localSchemaPath,localModelPath,mode):(component=angular.element("<div></div>"),component.attr("xpsui-options",localSchemaPath),component.attr("xpsui-model",localModelPath),component.attr("xpsui-fieldset",mode)):"string"===localFragment.type||"array"===localFragment.type||"number"===localFragment.type?component=this.generatePropertyRow(localFragment,localSchemaPath,localModelPath,mode):log.warn("Local fragment type %s not implemented yet",localFragment.type):localFragment.objectLink2?component=this.generatePropertyRow(localFragment,localSchemaPath,localModelPath,mode):log.warn("Cannot identify type of fragment %s",localSchemaPath),component&&(elm.append(component),$compile(component)(scope)),log.groupEnd();else log.warn('Schema fragment type "%s" not implemented yet',schemaFragment.type);else log.warn("Schema fragment has not explicit type defined")},new FormGenerator}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:GeneratorsGenerator",["$http","xpsui:safeUrlEncoder","xpsui:SchemaUtil","$q","xpsui:ObjectTools",function($http,urlEncoder,schemaUtilFactory,$q,objectTools){function bergerTable(teams,terms){var n,i,floatTable=[],increment=1,atype=1,minmove=0,flipcolors=0;teams.length%2===1&&teams.push({complement:!0}),n=teams.length;for(var j,temp,colorFlag,incr,nr=n-1,n2=n/2,max_round=terms.length,test_r=0,outRounds=[],r=1;max_round>=r;r++){var outRound={round:r,term:terms[r-1],matches:[]};if(outRounds.push(outRound),1==r){for(incr=n-3,j=0,i=1;n>i;i++)floatTable[j]=i,j+=incr,j%=n-1;floatTable[nr]=n}else{for(temp=floatTable[n-2],i=n-2;i>0;i--)floatTable[i]=floatTable[i-1];floatTable[0]=temp}for(r==n&&(flipcolors^=1,test_r=1),i=0,"1"==atype&&(increment=2);;){colorFlag=0===i?(r-test_r)%2?1:0:i%2?0:1,colorFlag^=flipcolors;var match={home:teams[floatTable[colorFlag?nr-i:i]-1],visitors:teams[floatTable[colorFlag?i:nr-i]-1],boar:i};if(0===i&&(match={home:match.visitors,visitors:match.home,board:i}),match.home.complement?outRound.notPlaying=match.visitors:match.visitors.complement?outRound.notPlaying=match.home:outRound.matches.push(match),minmove&&0===i&&r%2===0?i=1:i+=increment,i>=n2){if(1==increment)break;increment=-2,i=i>n2?i-3:--i}if(1>i&&-2==increment)break}}return outRounds}function saveBerger(entity,callback){var saveSchema=schemaUtilFactory.encodeUri("uri://registries/refereeReports#views/refereeReports/new"),all=[];entity.saving=!0,entity.generated.map(function(round){round.matches.map(function(match){var toSave={};toSave.baseData={},toSave.baseData.homeClub=match.home,toSave.baseData.awayClub=match.visitors,toSave.baseData.matchRound={registry:"schedules",oid:round.term.id},toSave.baseData.competition=entity.baseData.competition,toSave.baseData.competitionPart={registry:"competitionParts",oid:entity.id},toSave.baseData.matchDate=round.term.baseData.date,toSave.baseData.state="Otvorený",all.push($http({url:"/udao/saveBySchema/"+saveSchema,method:"PUT",data:toSave}))})}),$q.all(all).then(function(){callback(null)})}function generateBerger(entity,callback){var searchSchema="uri://registries/schedule#views/schedule/search";$http({method:"POST",url:"/search/"+schemaUtilFactory.encodeUri(searchSchema),data:{crits:[{f:"baseData.competitionPart.oid",v:entity.id,op:"eq"}],sorts:[{f:"baseData.date",o:"asc"}]}}).success(function(terms){var teams=entity.listOfTeam.team;entity.generated=bergerTable(teams,terms),callback()}).error(function(err){callback(err)})}function generateUserAccounting(entity,callback){$http({method:"GET",url:"/info/accounting/user/"+entity.id}).success(function(info){entity.accounting=info,callback()}).error(function(err){callback(err)})}function generateClubAccounting(entity,callback){$http({method:"get",url:"/info/accounting/club/"+entity.id}).success(function(info){entity.accounting=info,callback()}).error(function(err){callback(err)})}var service={};return service.exportCsv=function(){for(var c=convertCriteria($scope.searchCrit),idx=0;idx<$scope.forcedCriterias.length;idx++)c.push($scope.forcedCriterias[idx]);genericSearchFactory.getSearch($scope.entityUri,$scope.lastCriteria,convertSortBy($scope.sortBy),0,1e3).success(function(data){data=toHtml($scope.schema,data);var blob=new Blob([data],{type:"application/vnd.ms-excel;charset=utf-8"}),url=window.webkitURL||window.URL,link=document.createElementNS("http://www.w3.org/1999/xhtml","a");link.href=url.createObjectURL(blob),link.download="search-export.xls";var event=document.createEvent("MouseEvents");event.initEvent("click",!0,!1),link.dispatchEvent(event)}).error(function(err){notificationFactory.error(err)})},service.generate=function(entity,type,callback){switch(type){case"BERGER":generateBerger(entity,callback);break;case"USER-ACCOUNTING":generateUserAccounting(entity,callback);break;case"CLUB-ACCOUNTING":generateClubAccounting(entity,callback)}},service.save=function(entity,type,callback){switch(type){case"BERGER":saveBerger(entity,callback)}},service}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:GenericSearchFactory",["$http","xpsui:SchemaUtil","$translate",function($http,schemaUtilFactory,$translate){var service={};return service.getSearch=function(searchSchema,crits,sortBy,skip,limit){return $http({method:"POST",url:"/search/"+schemaUtilFactory.encodeUri(schemaUtilFactory.concatUri(searchSchema,"search")),data:{crits:crits,sortBy:sortBy,limit:limit,skip:skip}})},service.getSearchCount=function(searchSchema,crits){return $http({method:"POST",url:"/search/count/"+schemaUtilFactory.encodeUri(schemaUtilFactory.concatUri(searchSchema,"search")),data:{crits:crits}})},service.parseSearchDef=function(schema){function collectProperties(pathPrefix,objectDef,group,resultArr){for(var pr in objectDef.properties)objectDef.properties[pr].objectLink2?resultArr.push({path:pathPrefix+pr+".oid",type:objectDef.properties[pr].type,render:{objectLink2:objectDef.properties[pr].objectLink2},schemaFragment:objectDef.properties[pr],group:group,title:objectDef.properties[pr].transCode?$translate.instant(objectDef.properties[pr].transCode):objectDef.properties[pr].title}):"render"in objectDef.properties[pr]&&"psui-datepicker"===objectDef.properties[pr].render.component?resultArr.push({path:pathPrefix+pr,type:objectDef.properties[pr].type,render:{datepicker:!0},schemaFragment:objectDef.properties[pr],group:group,title:objectDef.properties[pr].transCode?$translate.instant(objectDef.properties[pr].transCode):objectDef.properties[pr].title}):"object"===objectDef.properties[pr].type?collectProperties(pr+".",objectDef.properties[pr],objectDef.properties[pr].transCode?$translate.instant(objectDef.properties[pr].transCode):objectDef.properties[pr].title,resultArr):resultArr.push({path:pathPrefix+pr,type:objectDef.properties[pr].type,group:group,title:objectDef.properties[pr].transCode?$translate.instant(objectDef.properties[pr].transCode):objectDef.properties[pr].title})}var retval={};return retval.schema=schema.url,retval.attributes=[],retval.operators=[{title:"=",value:"eq"},{title:">",value:"gt"},{title:">=",value:"gte"},{title:"<",value:"lt"},{title:"<=",value:"lte"},{title:"je iné ako",value:"neq"},{title:"začína s",value:"starts"},{title:"obsahuje",value:"contains"},{title:"má vyplnené",value:"ex"}],collectProperties("",schema,null,retval.attributes),retval},service}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:HttpHandlerFactory",["$http","$q",function($http,$q){function HttpHandler(){this.activeDeffered=null}return HttpHandler.prototype.http=function(config){var deffered=$q.defer(),self=this;return this.activeDeffered&&(this.activeDeffered.reject("cancelled"),this.activeDeffered=null),$http(config).then(function(){self.activeDeffered===deffered&&(deffered.resolve.apply(deffered,arguments),self.activeDeffered=null)},function(){self.activeDeffered===deffered&&(deffered.reject.apply(deffered,arguments),self.activeDeffered=null)},function(){self.activeDeffered===deffered&&deffered.notify.apply(deffered,arguments)}),this.activeDeffered=deffered,deffered.promise},{newHandler:function(){return new HttpHandler}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").provider("xpsui:logging",[function(){function Logger(loggingLevel){this.level=loggingLevel,this.ERROR=1,this.WARN=2,this.INFO=3,this.DEBUG=4,this.TRACE=5}var level=7;Logger.prototype.info=function(){this.level>=this.INFO&&console.info.apply(console,arguments)},Logger.prototype.debug=function(){this.level>=this.DEBUG&&console.debug.apply(console,arguments)},Logger.prototype.trace=function(){this.level>=this.TRACE&&console.trace.apply(console,arguments)},Logger.prototype.warn=function(){this.level>=this.WARN&&console.warn.apply(console,arguments)},Logger.prototype.error=function(){this.level>=this.ERROR&&console.error.apply(console,arguments)},Logger.prototype.group=function(){this.level>=this.INFO&&console.groupCollapsed.apply(console,arguments)},Logger.prototype.groupEnd=function(){this.level>=this.INFO&&console.groupEnd.apply(console,arguments)},Logger.prototype.profile=function(){this.level>=this.INFO&&console.profile.apply(console,arguments)},Logger.prototype.profileEnd=function(){this.level>=this.INFO&&console.profileEnd.apply(console,arguments)},Logger.prototype.time=function(){this.level>=this.INFO&&console.time.apply(console,arguments)},Logger.prototype.timeEnd=function(){this.level>=this.INFO&&console.timeEnd.apply(console,arguments)};var loggerSingleton=new Logger(level);return{setLevel:function(l){level=l},$get:function(){return loggerSingleton}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:MassmailingFactory",["$http",function($http){var service={};return service.sendMail=function(template,crits,users){return $http({method:"POST",url:"/massmailing/send",data:{crits:crits,template:template,users:users}})},service}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:NavigationService",["$location",function($location){var service={navigationStack:[]},top=function(){return service.navigationStack.length>0?service.navigationStack[service.navigationStack.length-1]:null};return service.navigate=function(context){service.navigationStack.push({path:$location.path(),context:context}),service.navigationStack.length>10&&service.navigationStack.splice(0,1)},service.navigateToPath=function(path,context){service.navigationStack.push({path:path,context:context}),service.navigationStack.length>10&&service.navigationStack.splice(0,1)},service.restore=function(){if(service.navigationStack.length<=0)return null;var topItem=top();return topItem.path==$location.path()?(service.navigationStack.pop(),topItem.context):null},service.back=function(){if(service.navigationStack.length<=0)return!1;var last=service.navigationStack.pop();return $location.path(last.path),!0},service.clear=function(){service.navigationStack=[]},service}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:NotificationFactory",["$rootScope",function($rootScope){$rootScope.psuiNotification=$rootScope.psuiNotification||{},$rootScope.psuiNotification.message=$rootScope.psuiNotification.message||[];var defaultMessage={type:"info",text:"error",deletable:!0,time:-1,timeout:null},factory={};return factory.info=function(message){var finalMessage={};angular.copy(defaultMessage,finalMessage),"string"==typeof message?finalMessage.text=message:message.text||message.translationCode?angular.extend(finalMessage,message):finalMessage.text="!Nestrukturovana sprava!"+JSON.stringify(message),finalMessage.type="info",$rootScope.psuiNotification.message.push(finalMessage)},factory.warn=function(message){var finalMessage={};angular.copy(defaultMessage,finalMessage),"string"==typeof message?finalMessage.text=message:message.text||message.translationCode?angular.extend(finalMessage,message):finalMessage.text="!Nestrukturovana sprava!"+JSON.stringify(message),finalMessage.type="warn",$rootScope.psuiNotification.message.push(finalMessage)},factory.error=function(message){var finalMessage={};angular.copy(defaultMessage,finalMessage),"string"==typeof message?finalMessage.text=message:message.text||message.translationCode?angular.extend(finalMessage,message):finalMessage.text="!Nestrukturovana sprava!"+JSON.stringify(message),finalMessage.type="error",$rootScope.psuiNotification.message.push(finalMessage)},factory.clear=function(){for(var i=0;i<$rootScope.psuiNotification.message.length;i++)$rootScope.psuiNotification.message[i].element.remove();$rootScope.psuiNotification.message=[]},factory}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:ObjectTools",[function(){function ObjectTools(){}
return ObjectTools.prototype.getSchemaFragmentByObjectPath=function(schema,path){if(schema&&path&&path.length&&!(path.length<1)){var propertiesFragment;if(propertiesFragment="array"===schema.type?schema.items:schema.properties){var dotPosition=path.indexOf(".");if(dotPosition>-1){var pathPropName=path.substring(0,dotPosition);return this.getSchemaFragmentByObjectPath(propertiesFragment[pathPropName],path.substring(dotPosition+1))}return propertiesFragment[path]}}},new ObjectTools}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:Objectlink2Factory",["xpsui:logging","$timeout","$translate","xpsui:SelectboxFactory","xpsui:DateUtil","$parse",function(log,$timeout,$translate,selectbox,dateUtil,$parse){function Objectlink2(element,options){selectbox.controller.call(this,element,options)}return Objectlink2.prototype=Object.create(selectbox.controller.prototype),Objectlink2.prototype.controller=Objectlink2,Objectlink2.prototype.generateElement=function(data){var $item=angular.element("<div></div>");return Objectlink2.renderElement($item,this.getDataset().getFieldsSchema(),data),$item},Objectlink2.renderElement=function(wrapperElement,fieldsSchema,data){if(fieldsSchema){var field;for(field in fieldsSchema)if(fieldsSchema[field]){var type=fieldsSchema[field].type,label=fieldsSchema[field].title,value=data.refData[field];fieldsSchema[field].render&&"psui-datepicker"==fieldsSchema[field].render.component&&(type="date"),wrapperElement.append(angular.element('<span title="'+label+'">'+Objectlink2.getFormatedValue(type,value)+"</span>"))}}},Objectlink2.getFormatedValue=function(type,value){return value?(value="object"==typeof value&&value.v?value.v:value,"date"===type&&(value=dateUtil.formatter(value)),value):""},{controller:Objectlink2,create:function(element,options){return new Objectlink2(element,options)},renderElement:Objectlink2.renderElement}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:RemoveButtonFactory",["xpsui:logging","$translate",function(log,$translate){function RemoveButton($element,options){this.$element=$element,this.options=angular.extend({},RemoveButton.DEFAULTS,options||{})}var keys={backspace:8,del:46};return RemoveButton.DEFAULTS={input:null,enabled:!0,onClear:function(){}},RemoveButton.prototype.show=function(){this.render(),this.$actionEl&&this.$actionEl.addClass("x-show")},RemoveButton.prototype.hide=function(){this.$actionEl&&this.$actionEl.removeClass("x-show")},RemoveButton.prototype._handleKeyDown=function(){var self=this;this.options.input&&this.options.input.on("keydown",function(event){switch(event.keyCode){case keys.backspace:event.preventDefault(),self._onClear(),event.stopPropagation()}})},RemoveButton.prototype._onClear=function(){this.options.onClear(),this.hide()},RemoveButton.prototype.renderInit=function(){var self=this;!this.$actionEl&&this.options.enabled&&(this.$actionEl=angular.element('<div class="x-remove-button-action"><span>'+$translate.instant("RemoveButton.remove")+"</span></div>"),this.$actionEl.on("click",function(){self._onClear()}),self._handleKeyDown(),this.$element.append(this.$actionEl),this.$element.addClass("x-remove-button"))},RemoveButton.prototype.render=function(){this.renderInit()},{controller:RemoveButton,create:function(element,options){return new RemoveButton(element,options)}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:SchemaEditorService",["$http","$rootScope",function($http,$rootScope){var service={};return service.getSchemaList=function(){return $http({method:"GET",url:"/schema/ls/"})},service.getFileContent=function(path){var pathContext="schema/get/"+path;return $http({method:"GET",url:pathContext,responseType:"text"})},service.getPostContent=function(path,bytes){var pathContext="schema/replace/"+path;return $http({method:"PUT",url:pathContext,data:bytes,headers:{"Content-Type":"application/octet-stream"}})},service}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:SchemaUtil",["$http","$parse","xpsui:safeUrlEncoder",function($http,$parse,urlEncoder){var service={};return service.getCompiledSchema=function(schemaUri,suffix){var _schemaUri=schemaUri;return suffix&&(_schemaUri=this.concatUri(schemaUri,suffix)),$http({method:"GET",cache:!0,url:"/schema/compiled/"+this.encodeUri(_schemaUri)})},service.listBySchema=function(schemaUri){return $http({method:"POST",url:"/search/"+service.encodeUri(schemaUri)})},service.getFieldsSchemaFragment=function(schema,fields,callback){this.getCompiledSchema(schema).success(function(data){var field,outFields={};for(field in fields){var fieldProp=fields[field].split("."),path=["properties",fieldProp[0],"properties",fieldProp[1]],getter=$parse(path.join("."));outFields[field]=getter(data)}callback(outFields)}).error(function(err){callback(null)})},service.generateObjectFromSchema=function generateObjectFromSchema(schema,obj){var _obj=obj;angular.forEach(schema.properties,function(value,key){"object"===value.type?(_obj[key]={},generateObjectFromSchema(value,_obj[key])):"array"===value.type?_obj[key]=[]:value["default"]?_obj[key]=value["default"]:_obj[key]=""})},service.fillObj=function(scopeToFill,values){angular.forEach(values,function(value,key){$parse(value.path).assign(scopeToFill,value.value)})},service.concatUri=function(schemaUri,suffix){console.log(schemaUri,suffix);var _schemaUri=schemaUri||"";return/\/$/.test(_schemaUri)||(/#/.test(_schemaUri)?/#$/.test(_schemaUri)||(_schemaUri+="/"):_schemaUri+="#"),_schemaUri+(suffix||"")},service.encodeUri=function(schemaUri){return urlEncoder.encode(schemaUri)},service.decodeUri=function(schemaUri){return urlEncoder.decode(schemaUri)},service}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:SecurityService",["$http","$rootScope","xpsui:SchemaUtil",function($http,$rootScope,schemaUtilFactory){var service={};return service.getLogin=function(user,password){return $http({method:"POST",url:"/login/",data:{login:user,password:password}})},service.selectProfile=function(profileId){return $http({method:"POST",url:"/user/profile/",data:{profileId:profileId}})},service.getCurrentUser=function(){return $http({method:"GET",url:"/user/current"})},service.getResetPassword=function(userId){return $http({method:"POST",url:"/resetPassword/",data:{userId:userId}})},service.getChangePassword=function(currentPassword,newPassword){return $http({method:"POST",url:"/changePassword",data:{currentPassword:currentPassword,newPassword:newPassword}})},service.getSecurityGroups=function(){var entityUri="uri://registries/security#groupmaster/new";return $http({method:"POST",url:"/search/"+schemaUtilFactory.encodeUri(entityUri)})},service.getForgotenToken=function(email,captcha){return $http({method:"POST",url:"/forgotten/token/",data:{email:email,captcha:captcha}})},service.getForgotenPasswordReset=function(token){return $http({method:"GET",url:"/forgotten/reset/"+token})},service.getCaptchaKey=function(token){return $http({method:"GET",url:"/captcha/sitekey/"})},service.getLogout=function(){return $http({method:"GET",url:"/logout/"})},service.getSecurityPermissions=function(){return $http({method:"GET",url:"/security/permissions"})},service.getSecurityProfiles=function(){return $http({method:"GET",url:"/security/profiles"})},service.getSecuritySearchSchemas=function(){return $http({method:"GET",url:"/security/search/schemas"})},service.getUserPermissions=function(userId){return $http({method:"GET",url:"/user/permissions/"+userId})},service.updateUserSecurity=function(userId,loginName,email,profiles){return $http({method:"POST",url:"/user/security/update",data:{userId:userId,loginName:loginName,email:email,profiles:profiles}})},service.updateProfileSecurity=function(profileId,profileName,permissions,groups,crits){return $http({method:"POST",url:"/security/profile/update",data:{profileId:profileId,profileName:profileName,permissions:permissions,groups:groups,crits:crits}})},service.updateSecurityGroup=function(oid,groupName,groupId,permissions,parent){return $http({method:"POST",url:"/group/security/update",data:{oid:oid,permissions:permissions,groupName:groupName,groupId:groupId,parent:parent}})},service.hasPermissions=function(requiredPermissions){if(!requiredPermissions||requiredPermissions.length<1)return!0;if($rootScope.security.currentUser&&$rootScope.security.currentUser.systemCredentials&&$rootScope.security.currentUser.systemCredentials.login&&$rootScope.security.currentUser.systemCredentials.permissions){for(var i in requiredPermissions)if($rootScope.security.currentUser.systemCredentials.permissions[requiredPermissions[i]]!==!0)return!1;return!0}return!1},service}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:SelectboxFactory",["xpsui:logging","$timeout","$translate","xpsui:SelectDataFactory",function(log,$timeout,$translate,datafactory){function Selectbox($element,options){this.$element=$element,this.$inputElement=null,this.dataset=null,this.isRendered=!1,this.$searchInput=null,this._startPaging=!1,this.selected=null,this.options=angular.extend({},Selectbox.DEFAULTS,options||{})}var keys={tab:9,backspace:8,enter:13,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,del:46,asterisk:106};return Selectbox.DEFAULTS={useSearchInput:!0,filterTimeout:300,showInfo:!0,onSelected:function(value){},closeOnBlur:!0,pagingScrollBuffer:40,pagingItemsBuffer:10,freeTextMode:!1},Selectbox.prototype.getElement=function(){return this.$element},Selectbox.prototype.setOptions=function(options){angular.extend(this.options,options||{})},Selectbox.prototype.setInput=function(element){return this.$inputElement=element,this._bindInputEventHandlers(),this},Selectbox.prototype._bindInputEventHandlers=function(){var self=this;this.$inputElement.on("keypress",function(event){if(self.options.freeTextMode||event.preventDefault(),self.options.useSearchInput&&event.keyCode>=48&&(self.dropdown&&self.dropdown.open(),self.$searchInput)){var keychar=self.getKeyChar(event);keychar&&self.$searchInput.val(keychar),self.actionFilter(self.$searchInput.val()),self.$searchInput[0].blur(),self.$searchInput[0].focus()}}),this.$inputElement.on("keydown",function(event){!self.options.useSearchInput||event.keyCode!==keys.backspace&&event.keyCode!==keys.del||event.preventDefault()})},Selectbox.prototype.getKeyChar=function(event){return null==event.which?String.fromCharCode(event.keyCode):0!=event.which&&0!=event.charCode?String.fromCharCode(event.which):null},Selectbox.prototype.getInput=function(){return this.$inputElement},Selectbox.prototype.setDataset=function(dataset){var self=this;return this.dataset=dataset,this.dataset.setOptions({beforeLoad:function(dataSet){self.onBeforeLoad()},loaded:function(dataSet,newData){self.onLoaded(newData)},reset:function(){self.onReset()}}),this},Selectbox.prototype.getDataset=function(dataset){return this.dataset},Selectbox.prototype.setDropdown=function(dropdown){var self=this;this.dropdown=dropdown,dropdown.afterOpen=function(){self.open()}},Selectbox.prototype.open=function(){this.isRendered;this.renderTo(this.dropdown.getContentElement()),this.options.useSearchInput&&this.$searchInput.val()&&(this.$searchInput.val(""),this.doReset(),this.doLoad()),this.options.useSearchInput?this.$searchInput[0].focus():this.options.freeTextMode||this.$selectboxElement[0].focus(),this.$itemsElement[0].scrollTop=0,this.$itemsElement[0].scrollLeft=0,this.unselectItem()},Selectbox.prototype.loading=function(){this.dataset.getData()},Selectbox.prototype.unselectItem=function(){angular.element(this.$element[0].querySelector(".x-selected")).removeClass("x-selected")},Selectbox.prototype.selectItem=function($el){this.unselectItem(),this.selected=$el.data("index"),$el.addClass("x-selected"),console.log("selected: "+this.selected),console.log("item min =<"+(this.dataset.data.length-this.options.pagingItemsBuffer)),this.selected>=this.dataset.data.length-this.options.pagingItemsBuffer&&this.doPaging()},Selectbox.prototype.setRootElement=function(element){return this.$rootElement=element},Selectbox.prototype.getRootElement=function(element){return this.$rootElement},Selectbox.prototype.renderInit=function(){this.isRendered||(this.isRendered=!0,this.$selectboxElement=angular.element('<div class="x-selectbox"></div>'),this.$selectboxElement.attr("tabindex",-1),this._bindEventHandlers(this.$selectboxElement),this.renderSearch(),this.$itemsElement=angular.element('<div class="x-selectbox-items"></section>'),this.$selectboxElement.append(this.$itemsElement),this._handleScrollEvent(),this.renderInfo(),this.getRootElement().append(this.$selectboxElement),this.doLoad())},Selectbox.prototype._handleScrollEvent=function(){var self=this;this.$itemsElement.on("scroll",function(){this.scrollHeight-this.scrollTop<=this.offsetHeight+self.options.pagingScrollBuffer&&self.doPaging()})},Selectbox.prototype.doPaging=function(){this._startPaging||(this._startPaging=!0,this.doLoad())},Selectbox.prototype.doLoad=function(){this.dataset.load()},Selectbox.prototype.doReset=function(){this.dataset.reset()},Selectbox.prototype.onBeforeLoad=function(){this.setInfoText($translate.instant("psui.selectbox.loading")),this.setInfoNumFromText(""),this.$element.addClass("x-loading")},Selectbox.prototype.onLoaded=function(newData){this.renderItems(newData),this.$element.removeClass("x-loading"),this.setInfoNum(),this._startPaging=!1},Selectbox.prototype.onReset=function(){this.selected=null,this._startPaging=!1,this.$itemsElement.length&&this.$itemsElement.empty()},Selectbox.prototype.renderSearch=function(){if(this.options.useSearchInput){this.$element.addClass("x-selectobx-search-enabled");var $header=angular.element("<header></header>");this.$searchInput=angular.element("<input></input>"),this.$searchInput.attr("tabindex",-1),this._bindEventHandlers(this.$searchInput),$header.append(this.$searchInput),this.$selectboxElement.append($header)}},Selectbox.prototype.renderInfo=function(){if(this.options.showInfo){var $footer=angular.element("<footer></footer>");this.$infoTextElement=angular.element("<span></span>"),$footer.append(this.$infoTextElement),this.$infoElement=angular.element("<span></span>"),$footer.append(this.$infoElement),this.$selectboxElement.append($footer)}},Selectbox.prototype.setInfoText=function(text){this.$infoTextElement&&this.$infoTextElement.text(text)},Selectbox.prototype.setInfoNumFromText=function(value){this.$infoElement&&this.$infoElement.text(value)},Selectbox.prototype.setInfoNum=function(){this.$infoElement&&(this.setInfoText($translate.instant("psui.selectbox.rows")),this.$infoElement.text(this.dataset.data.length+(this.dataset.loadDone?"":"+")))},Selectbox.prototype.renderItems=function(data){for(var offset=this.dataset.getOffset(),i=0;i<data.length;i++){var $item=this.generateElement(data[i]);$item.addClass("x-item"),$item.data("index",offset++),$item.attr("tabindex",-1),this.$itemsElement.append($item),this._bindEventHandlers($item)}},Selectbox.prototype.generateElement=function(item){return"string"==typeof item?angular.element("<div>"+item+"</div>"):"object"==typeof item&&"undefined"!=typeof item.k&&"undefined"!=typeof item.v?angular.element("<div>"+item.v+"</div>"):void 0},Selectbox.prototype._bindEventHandlers=function($items){var self=this;$items.on("mouseover",function(e){return self._handleMouseover(angular.element(this),e)}),$items.on("click",function(e){return self._handleClick(angular.element(this),e)}),$items.on("keydown",function(e){return self._handleKeyDown(angular.element(this),e)}),$items.on("focus",function(e){return self._handleFocus(angular.element(this),e)}),$items.on("blur",function(e){return self._handleBlur(angular.element(this),e)})},Selectbox.prototype._handleFocus=function($el,event){this.dropdown&&this.dropdown.cancelClosing(),$el.hasClass("x-item")&&this.selectItem($el)},Selectbox.prototype._handleBlur=function($el,event){this.options.closeOnBlur&&this.dropdown&&this.dropdown.close()},Selectbox.prototype._handleMouseover=function($el,event){$el.hasClass("x-item")&&$el[0].focus()},Selectbox.prototype._handleClick=function($el,event){$el.hasClass("x-item")&&(this.selectItem($el),this.actionSelected()),event.stopPropagation()},Selectbox.prototype._fixScroller=function($el){var selectedItem=$el[0],itemsElement=this.$itemsElement[0];if(selectedItem.offsetTop<itemsElement.scrollTop)return void(itemsElement.scrollTop=selectedItem.offsetTop);var bottomBorderSelectedItem=selectedItem.offsetTop+selectedItem.offsetHeight,bottomBorderItemsEl=itemsElement.scrollTop+itemsElement.clientHeight;bottomBorderSelectedItem>bottomBorderItemsEl&&(itemsElement.scrollTop+=bottomBorderSelectedItem-bottomBorderItemsEl)},Selectbox.prototype._handleKeyDown=function($el,event){var self=this;switch(event.keyCode){case keys.up:if(event.preventDefault(),null===this.selected)this.selected=this.dataset.data.length;else if(this.selected<=0)return"";var $selectedItem=angular.element(this.$itemsElement.children()[this.selected-1]);this.selectItem($selectedItem),this._fixScroller($selectedItem),event.stopPropagation();break;case keys.down:if(event.preventDefault(),null===this.selected)this.selected=-1;else if(this.selected+1>=this.dataset.data.length)return"";var $selectedItem=angular.element(this.$itemsElement.children()[this.selected+1]);this.selectItem($selectedItem),this._fixScroller($selectedItem),event.stopPropagation();break;case keys.enter:this.actionSelected(),event.stopPropagation();break;case keys.escape:this.getInput()[0].focus(),event.stopPropagation();break;default:this.$searchInput&&$el[0]===this.$searchInput[0]&&(this.__filterTimeout&&$timeout.cancel(this.__filterTimeout),this.__filterTimeout=$timeout(function(){self.actionFilter(self.$searchInput.val())},this.options.filterTimeout),event.stopPropagation())}},Selectbox.prototype.actionFilter=function(value){this.dataset.setSearchValue(value),this.doLoad()},Selectbox.prototype.actionSelected=function(){if(null!==this.selected){var val=this.dataset.data[this.selected];this.options.onSelected(val)}this.$inputElement[0].focus()},Selectbox.prototype.renderTo=function(element){this.setRootElement(element),this.render()},Selectbox.prototype.render=function(){this.renderInit()},{controller:Selectbox,create:function(element,options){return new Selectbox(element,options)}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:SelectDataFactory",["xpsui:logging","$timeout","$translate","$http","$parse","xpsui:SchemaUtil","xpsui:HttpHandlerFactory",function(log,$timeout,$translate,$http,$parse,schemaUtil,httpHandlerFactory){function DataSet(store,options){this.store=store,this.options=angular.extend({},DataSet.DEFAULTS,options||{}),this.data=[],this.offset=0,this.serachValue=null,this.loadDone=!1}function ArrayStore(){this.data=[]}function ObjectDataSet(store,options){DataSet.call(this,store,options)}function ObjectLinkStore(options){this.options=angular.extend({},ObjectLinkStore.DEFAULTS,options||{}),this.schema={},this.crits=null,this.fields=null,this.http=null}function HttpStoreTest(){this.data=[],this.fields={},this.fieldsIndex=[],this._fieldsSchemaFragment={},this._lables={}}return DataSet.DEFAULTS={limit:16,beforeLoad:function(dataSet){},loaded:function(dataSet,newData){},reset:function(){}},DataSet.prototype.setOptions=function(options){return this.options=angular.extend({},this.options,options||{}),this},DataSet.prototype.getLimit=function(value){return this.options.limit+1},DataSet.prototype.getOffset=function(value){return this.offset*this.options.limit},DataSet.prototype.getSearchValue=function(){return this.serachValue},DataSet.prototype.setSearchValue=function(value){return this.reset(),this.serachValue=value,this},DataSet.prototype.reset=function(){return this.data=[],this.loadDone=!1,this.offset=0,this.serachValue=null,this.options.reset(),this},DataSet.prototype.load=function(){var self=this;this.loadDone||(this.options.beforeLoad(this),this.store.load(this,function(data){self.loaded(data)}))},DataSet.prototype.loaded=function(data){data.length<=this.options.limit?this.loadDone=!0:data.pop(),this.data=this.data.concat(data),this.options.loaded(this,data),this.offset++},ArrayStore.prototype.setData=function(data,translateCode){if(translateCode)for(var i=0;i<data.length;i++)this.data.push({v:$translate.instant(translateCode[i]),k:data[i]});else for(var i=0;i<data.length;i++)this.data.push({v:data[i],k:data[i]})},ArrayStore.prototype.getValueByKey=function(key){for(var i=0;i<this.data.length;i++)if(this.data[i].k===key)return this.data[i].v;return!1},ArrayStore.prototype.load=function(dataset,callback){var self=this;this.timeout&&$timeout.cancel(this.timeout),this.timeout=$timeout(function(){for(var data=[],regExp=new RegExp("^"+(dataset.getSearchValue()||""),"i"),i=0;i<self.data.length;++i)regExp.test(self.data[i].v)&&data.push(self.data[i]);callback(data.slice(dataset.getOffset(),dataset.getLimit()+dataset.getOffset()))},0)},ObjectDataSet.prototype=Object.create(DataSet.prototype),ObjectDataSet.prototype.loaded=function(data){data.length<=this.options.limit?this.loadDone=!0:data.pop(),this.data=this.data.concat(data),this.options.loaded(this,data),this.offset++},ObjectDataSet.prototype.getFieldsSchema=function(index){return this.store.fields},ObjectLinkStore.DEFAULTS={searchCondition:"starts",orderBySort:"asc"},ObjectLinkStore.prototype.initFieldsSchema=function(callback){var self=this;return this.fields?void callback():void schemaUtil.getFieldsSchemaFragment(this.schema.schema,this.schema.fields,function(fields){self.fields=fields,callback()})},ObjectLinkStore.prototype.getHttp=function(){return this.http||(this.http=httpHandlerFactory.newHandler()),this.http},ObjectLinkStore.prototype.setForcedCriteria=function(crits){return this.crits=crits,this},ObjectLinkStore.prototype.setSchema=function(schema){return this.schema=schema,this},ObjectLinkStore.prototype.getHttpConfing=function(dataset){var config={method:"POST",url:"/search/"+schemaUtil.encodeUri(this.schema.schema),data:{crits:[],limit:dataset.getLimit(),skip:dataset.getOffset(),sorts:[]}};if(!this._orderByName)for(var field in this.schema.fields){this._orderByName=this.schema.fields[field];break}config.data.sorts.push({f:this._orderByName,o:this.options.orderBySort}),this.crits&&angular.isArray(this.crits)&&config.data.crits.concat(this.crits);var _searchVal=dataset.getSearchValue();if(_searchVal&&angular.isString(_searchVal)&&_searchVal.length>0)for(field in this.schema.fields){config.data.crits.push({f:this.schema.fields[field],v:_searchVal,op:this.options.searchCondition});break}return config},ObjectLinkStore.prototype.load=function(dataset,callback){var self=this;this.initFieldsSchema(function(){var promise=self.getHttp().http(self.getHttpConfing(dataset));promise.then(function(args){var data=[];if(args.data&&args.data instanceof Array)for(var i=0;i<args.data.length;i++)data.push(ObjectLinkStore.getData(self.schema,args.data[i]));callback(data)},function(){arguments})})},ObjectLinkStore.getData=function(objectLink,data){if(data&&"object"==typeof data){if(data.refData)return data;var field,outData={schema:objectLink.schema,oid:data.id,refData:{}};for(field in objectLink.fields){var getter=$parse(objectLink.fields[field]);outData.refData[field]=getter(data)}return outData}return null},HttpStoreTest.DEFAULTS={},HttpStoreTest.prototype.setFields=function(fields){var field;this.fields=fields;for(field in this.fields)this.fieldsIndex.push(field);return this},HttpStoreTest.prototype.setScope=function(scope){return this.scope=scope,this},HttpStoreTest.prototype.setSchema=function(schema){return this.schema=schema,this},HttpStoreTest.prototype.getFieldSchemaFragment=function(index){var fieldName="string"==typeof index?index:this.fieldsIndex[index];return this._fieldsSchemaFragment[fieldName]||(this._fieldsSchemaFragment[fieldName]=HttpStoreTest.getFieldSchemaFragment(this.schema,this.fields[fieldName],this.scope)),this._fieldsSchemaFragment[fieldName]},HttpStoreTest.getFieldSchemaFragment=function(schema,field,scope){var fieldProp=field.split("."),path=[schema,"properties",fieldProp[0],"properties",fieldProp[1]],getter=$parse(path.join("."));return getter(scope)},HttpStoreTest.prototype.getLabel=function(index){var fieldName="string"==typeof index?index:this.fieldsIndex[index];return this._lables[fieldName]||(this._lables[fieldName]=this.getFieldSchemaFragment(fieldName).title),this._lables[fieldName]},HttpStoreTest.prototype.setTestData=function(count){function randomString(length,chars){var mask="";chars.indexOf("a")>-1&&(mask+="abcdefghijklmnopqrstuvwxyz"),chars.indexOf("A")>-1&&(mask+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),chars.indexOf("#")>-1&&(mask+="0123456789"),chars.indexOf("D")>-1&&(mask+="123456789"),chars.indexOf("!")>-1&&(mask+="~`!@#$%^&*()_+-={}[]:\";'<>?,./|\\");for(var result="",i=length;i>0;--i)result+=mask[Math.round(Math.random()*(mask.length-1))];return result}for(var i=0;count>i;i++){for(var item={schema:"uri://",oid:i,refdata:{}},j=0;j<this.fieldsIndex.length;j++)switch(this.getFieldSchemaFragment(j).type){case"date":item.refdata[this.fieldsIndex[j]]="20140"+randomString(1,"D")+"1"+randomString(1,"D");break;default:item.refdata[this.fieldsIndex[j]]=randomString(10,"#aA")}this.data.push(item)}},HttpStoreTest.prototype.load=function(dataset,callback){var self=this;this.timeout&&$timeout.cancel(this.timeout),this.timeout=$timeout(function(){var data=[];data=self.data,callback(data.slice(dataset.getOffset(),dataset.getLimit()+dataset.getOffset()))},3e3),console.log("HttpStoreTest::load")},{dataSetController:DataSet,arrayStoreController:DataSet,createArrayDataset:function(key,values){var store=new ArrayStore;return store.setData(key,values),new DataSet(store)},createObjectDataset:function(schemaFragment){var store=new ObjectLinkStore;return store.setSchema(schemaFragment.objectLink2).setForcedCriteria(schemaFragment.objectLink2ForcedCriteria),new ObjectDataSet(store)},createTestDataset:function(scope,schemaFragment,itemLenght){var store=new HttpStoreTest;return store.setFields(schemaFragment.objectLink2.fields).setScope(scope).setSchema(schemaFragment.objectLink2.schema).setTestData(itemLenght?itemLenght:4e3),new ObjectDataSet(store)},getFieldSchemaFragment:HttpStoreTest.getFieldSchemaFragment,getObjectLinkData:ObjectLinkStore.getData}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:StatisticsServiceFactory",["$http","$rootScope","xpsui:SchemaUtil",function($http,$rootScope,schemaUtilFactory){var service={};return service.getStatisticsData=function(){return $http({method:"get",url:"/statistics/"})},service}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives",[])}(angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiFormActionLink",["xpsui:SchemaUtil",function(schemaUtilFactory){return{restrict:"A",link:function(scope,elm,attrs,ctrls){var options=scope.$eval(attrs.psuiOptions);scope.$eval(attrs.psuiModel);elm.append("<span>"+options.title+"</span>"),scope.$watch(attrs.psuiModel+".id",function(nv,ov){nv&&attrs.$set("href","/#/registry/custom/"+options.template+"/"+schemaUtilFactory.encodeUri(options.schema)+"/"+nv)})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiArrayControlEdit",["$compile",function($compile){function getTemplate(renderComponent){return"xpsui-uploadable-file"===renderComponent?uploadablefileTemplate:objectLinkTemplate}var objectLinkTemplate='<div ng-repeat="ae in ngModel track by $id(ae)"> <div class="x-array-control-item">  <div  xpsui-objectlink2-edit xpsui-validity-mark xpsui-schema="xpsuiSchema.items" ng-model="ngModel[$index]"></div>  <button ng-click="removeByIndex($index);" class="btn-clear floating">   <i class="icon-minus"></i> {{\'generic.search.remove\' | translate}}  </button> </div></div><div class="pull-right"><button ng-click="appendNew();" class="btn-clear"><i class="icon-add"></i> {{"generic.search.add" | translate}}</button></div>',uploadablefileTemplate='<div ng-repeat="ae in ngModel track by $id(ae)" class="xpsui-uploadable-file-edit"> <div class="psui-attachment-remove">  <button ng-click="removeByIndex($index);" class="btn-clear">   <i class="icon-remove"></i> {{\'generic.search.remove\' | translate}}  </button> </div><div xpsui-uploadable-file xpsui-validity-mark class="xpsui-uploadable-file-edit-item"     xpsui-schema="xpsuiSchema.items" ng-model="ngModel[$index]"> </div></div><div class="pull-right clear"><button ng-click="appendNew();" class="btn-clear"><i class="icon-add"></i> {{"generic.search.add"| translate}}</button></div>';return{restrict:"A",scope:{ngModel:"=",xpsuiSchema:"="},link:function(scope,element,attrs,controller){function isEmptyObj(obj){if(!obj)return!0;for(var key in obj)if(key&&0!=key.indexOf("$")&&obj.hasOwnProperty(key))return!1;return!0}console.log(scope.psuiModel),console.log(scope.xpsuiSchema),element.html(getTemplate(attrs.xpsuiArrayControlEdit)),$compile(element.contents())(scope);var modelChanged=function(){console.log("model changed",scope.ngModel)};scope.$watchCollection("ngModel",modelChanged),scope.removeByIndex=function(idx){scope.ngModel.splice(idx,1)},scope.appendNew=function(){scope.ngModel instanceof Array||(scope.ngModel=[]),scope.ngModel instanceof Array&&(0==scope.ngModel.length||!isEmptyObj(scope.ngModel[scope.ngModel.length-1]))&&scope.ngModel.push({})}}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiArrayControlView",["$compile",function($compile){function getTemplate(renderComponent){return"xpsui-uploadable-file"===renderComponent?uploadablefileTemplate:objectLinkTemplate}var objectLinkTemplate='<div ng-repeat="ae in ngModel track by $id(ae)"><div  xpsui-objectlink2-view xpsui-validity-mark xpsui-schema="xpsuiSchema.items" ng-model="ngModel[$index]"></div></div>',uploadablefileTemplate='<div ng-repeat="ae in ngModel track by $id(ae)" class="xpsui-uploadable-file-view"><div  xpsui-uploadable-file xpsui-validity-mark    xpsui-schema="xpsuiSchema.items"    ng-model="ngModel[$index]"></div></div><div class="xpsui-uploadable-file-nofiles" ng-show="!ngModel || ngModel.length==0">{{"generic.nofiles.label" | translate}}</div>';return{restrict:"A",scope:{ngModel:"=",xpsuiSchema:"="},link:function(scope,element,attrs,controller){console.log(scope.psuiModel),console.log(scope.xpsuiSchema),element.html(getTemplate(attrs.xpsuiArrayControlView)),$compile(element.contents())(scope);var modelChanged=function(){console.log("model changed",scope.ngModel)};scope.$watchCollection("ngModel",modelChanged)}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiArray",["xpsui:log","xpsui:ComponentGenerator","$compile",function(log,componentGenerator,$compile){return{restrict:"E",link:function(scope,elm,attrs,ctrls){function generateArrayElements(){itemsHolder.empty();var schema=scope.$eval(schemaPath.concat(".items"));angular.forEach(scope.$eval(modelPath),function(val,key){var arrayItem=angular.element("<div></div>");angular.forEach(schema.properties,function(v,k){var component=componentGenerator.generate(schema.properties[k],schemaPath.concat(".items.properties.",k),modelPath.concat(".",key,".",k));arrayItem.append(component)}),itemsHolder.append(arrayItem),$compile(arrayItem)(scope)})}log.group("xpsui-array Link");var modelPath=attrs.xpsuiModel,schemaPath=attrs.xpsuiSchema;if(!modelPath||!schemaPath)return log.warn("Attributes xpsui-model and xpsui-schema have to be set, skipping fieldset generation"),void log.groupEnd();var itemsHolder=angular.element("<div></div>");elm.append(itemsHolder),generateArrayElements(),log.groupEnd()}}}])}(window.angular),function(angular){
"use strict";angular.module("xpsui:directives").directive("xpsuiBySchemaFieldEdit",["xpsui:logging","xpsui:FormGenerator","$compile","$parse",function(log,formGenerator,$compile,$parse){return{restrict:"A",require:[],link:function(scope,elm,attrs,ctrls){function regenerateField(){var schemaPath=attrs.xpsuiSchema,schemaFragment=scope.$eval(schemaPath),modelPath=attrs.xpsuiModel,field=formGenerator.generateField(schemaFragment,schemaPath,modelPath,formGenerator.MODE.EDIT);elm.empty(),$parse(modelPath).assign(scope,null),elm.append(field),$compile(field)(scope)}log.group("By Schema Field edit Link");attrs.xpsuiModel;attrs.$observe("xpsuiSchema",function(v){console.log(v),v&&regenerateField()}),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiBySchemaFieldView",["xpsui:logging","xpsui:FormGenerator","$compile",function(log,formGenerator,$compile){return{restrict:"A",require:[],link:function(scope,elm,attrs,ctrls){function regenerateField(){var schemaPath=attrs.xpsuiSchema,schemaFragment=scope.$eval(schemaPath),modelPath=attrs.xpsuiModel,field=formGenerator.generateField(schemaFragment,schemaPath,modelPath,formGenerator.MODE.VIEW);elm.empty(),elm.append(field),$compile(field)(scope)}log.group("By Schema Field view Link");attrs.xpsuiModel;attrs.$observe("xpsuiSchema",function(v){console.log(v),v&&regenerateField()}),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiCalendar",["xpsui:logging","xpsui:DateUtil","$translate","xpsui:DropdownFactory",function(log,dateUtil,$translate,dropdownFactory){var keys={tab:9,enter:13,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,asterisk:106},component=function(){this.options=angular.extend({},component.DEFAULTS),this.value,this.date,this.isRendered=!1,this.dropdown=!1};return component.DEFAULT={onSelected:function(date){}},component.prototype.setOptions=function(options){angular.extend(this.options,options||{})},component.prototype.setInput=function(element){var self=this;return this.$inputElement=element,this.$inputElement.on("change",function(){var value=dateUtil.parser(angular.element(this).val());value&&(self.setValue(value),self.render())}),this},component.prototype.getInput=function(){return this.$inputElement},component.prototype.setDate=function(value){this.date=new Date(value.getTime())},component.prototype.getDate=function(value){return(null===this.date||void 0===this.date)&&this.setDate(this.value?this.value:new Date),this.date},component.prototype.setValue=function(value){return angular.isUndefined(value)?this:("string"==typeof value&&(value=dateUtil.getDateFromYYYYMMDD(value)),this.value=new Date(value.getTime()),this)},component.prototype.setRootElement=function(element){return this.$rootElement=element,this},component.prototype.getRootElement=function(){return this.$rootElement},component.prototype.setDropdown=function(dropdown){var self=this;this.dropdown=dropdown,dropdown.afterOpen=function(){self.renderTo(dropdown.getContentElement()),self.setFocus(self.$element)}},component.prototype.setFocus=function($el){$el[0].focus(),this.$element[0]===$el[0]?this.$focusElement=null:this.$focusElement=$el},component.prototype.getValue=function(){return this.value},component.prototype._bindHandlers=function($items){var self=this;$items.on("mouseover",function(e){return self._handleMouseover(angular.element(this),e)}),$items.on("click",function(e){return self._handleClick(angular.element(this),e)}),$items.on("keydown",function(e){return self._handleKeyDown(angular.element(this),e)}),$items.on("focus",function(e){return self._handleFocus(angular.element(this),e)}),$items.on("blur",function(e){return self._handleBlur(angular.element(this),e)}),this.resetTabElemens()},component.prototype._handleMouseover=function($el,event){this.setFocus($el),event.stopPropagation()},component.prototype._handleClick=function($el,event){this._handleActions($el),event.stopPropagation()},component.prototype._handleKeyDown=function($el,event){switch(event.keyCode){case keys.up:this.previousAction(),this.setFocus(this.$element),event.stopPropagation();break;case keys.down:this.nextAction(),this.setFocus(this.$element),event.stopPropagation();break;case keys.right:if(this.$focusElement){var index=this.indexOfTabElements(this.$focusElement[0]);index===this.getTabElements().length-1?index=0:index++,this.setFocus(angular.element(this.getTabElements()[index]))}else this.setFocus(angular.element(this.getTabElements()[0]));event.stopPropagation();break;case keys.left:if(this.$focusElement){var index=this.indexOfTabElements(this.$focusElement[0]);index?index--:index=this.getTabElements().length-1,this.setFocus(angular.element(this.getTabElements()[index]))}else this.setFocus(angular.element(this.getTabElements()[0]));event.stopPropagation();break;case keys.enter:this._handleActions($el),event.stopPropagation();break;case keys.escape:this.getInput()[0].focus(),event.stopPropagation()}},component.prototype._handleFocus=function($el,event){this.dropdown&&this.dropdown.cancelClosing()},component.prototype._handleBlur=function($el,event){this.dropdown&&this.dropdown.close()},component.prototype._handleActions=function($el){switch($el[0]){case this.$previousActionElement[0]:this.previousAction();break;case this.$nextActionElement[0]:this.nextAction();break;case this.$currentDayActionElement[0]:this.currentDayAction();break;case this.$headerActionElement[0]:this.headerAction(),this.doLayout===this.yearlyLayout&&this.setFocus(this.getFirstTabElement());break;default:$el.hasClass("x-year")?(this.date.setFullYear($el.data("date").getFullYear()),this.monthlyLayout(),this.setFocus(this.getFirstTabElement())):$el.hasClass("x-month")?(this.date.setMonth($el.data("date").getMonth()),this.dailyLayout(),this.setFocus(this.getFirstTabElement())):$el.hasClass("x-day")&&$el.data("date")&&(this.setValue($el.data("date")),this.options.onSelected($el.data("date")),this.getInput()[0].focus())}},component.prototype._renderInit=function(){this.isRendered||(this.isRendered=!0,this.$element=angular.element('<div class="x-calendar"></div>'),this.$element.attr("tabindex","0"),this.dropdown&&this.$element.attr("tabindex","-1"),this.getRootElement().append(this.$element),this._bindHandlers(this.$element),this._controllsInit(),this.$contentElement=angular.element("<table></table>"),this.$element.append(this.$contentElement))},component.prototype.resetTabElemens=function(){this.$tabElements=angular.element(this.$element[0].querySelectorAll("[tabindex]"))},component.prototype.indexOfTabElements=function(value){var index=0;return angular.forEach(this.getTabElements(),function(val,key){return val===value?(index=key,!1):void 0}),index},component.prototype.getTabElements=function(){return this.$tabElements},component.prototype.getFirstTabElement=function(){return angular.element(this.$contentElement[0].querySelector("[tabindex]"))},component.prototype._controllsInit=function(){this.$controllElement=angular.element('<div class="x-controlls"></div>'),this.$element.append(this.$controllElement);var $container=angular.element('<div class="x-controlls-header"></div>');this.$controllElement.append($container),this.$previousActionElement=angular.element('<div class="x-action-previous" tabindex="-1"><span>'+$translate.instant("date.previous.day")+"</span></div>"),$container.append(this.$previousActionElement),this.$headerActionElement=angular.element('<div class="x-action-header"  tabindex="-1"></td>'),$container.append(this.$headerActionElement),this.$nextActionElement=angular.element('<div  class="x-action-next" tabindex="-1"><span>'+$translate.instant("date.next.day")+"</span></div>"),$container.append(this.$nextActionElement),this.$currentDayActionElement=angular.element('<div class="x-action-current-day" tabindex="-1"><span>'+$translate.instant("date.current.day")+"</span></div>"),this.$controllElement.append(this.$currentDayActionElement),this._bindHandlers(angular.element(this.$controllElement[0].querySelectorAll("[tabindex]")))},component.prototype.setHeaderText=function(text){this.$headerActionElement.html(text)},component.prototype.nextAction=function(){if(this.doLayout===this.dailyLayout){var month=this.getDate().getMonth()+1;this.date.setMonth(month)}else this.doLayout===this.monthlyLayout?this.date.setFullYear(this.date.getFullYear()+1):this.doLayout===this.yearlyLayout&&this.date.setFullYear(this.date.getFullYear()+9);this.doLayout()},component.prototype.previousAction=function(){this.doLayout===this.dailyLayout?this.date.setMonth(this.getDate().getMonth()-1):this.doLayout===this.monthlyLayout?this.date.setFullYear(this.date.getFullYear()-1):this.doLayout===this.yearlyLayout&&this.date.setFullYear(this.date.getFullYear()-9),this.doLayout()},component.prototype.currentDayAction=function(){this.setDate(new Date),this.doLayout=this.dailyLayout,this.doLayout()},component.prototype.headerAction=function(){this.doLayout===this.dailyLayout?this.monthlyLayout():this.doLayout===this.monthlyLayout&&this.yearlyLayout()},component.prototype.doLayout=function(){},component.prototype.yearlyLayout=function(){var tr,td,currentDate=new Date,selectedDate=this.getValue(),date=new Date(this.getDate().getTime());this.setHeaderText(""),this.$contentElement.empty(),this.$headerActionElement.addClass("x-deactive");for(var year=date.getFullYear()-4,i=0;3>i;i++){tr=angular.element("<tr></tr>");for(var j=0;3>j;j++)td=angular.element("<td>"+year+"</td>"),td.attr("tabindex","-1"),date.setFullYear(year++),td.addClass("x-year"),currentDate.getFullYear()===date.getFullYear()&&td.addClass("x-current"),selectedDate&&date.getFullYear()===selectedDate.getFullYear()&&td.addClass("x-selected"),td.data("date",new Date(date.getTime())),tr.append(td);this.$contentElement.append(tr)}this._bindHandlers(angular.element(this.$contentElement[0].querySelectorAll("[tabindex]"))),this.doLayout=this.yearlyLayout},component.prototype.monthlyLayout=function(){var tr,td,currentDate=new Date,selectedDate=this.getValue(),date=new Date(this.getDate().getTime());this.setHeaderText(date.getFullYear()),this.$contentElement.empty(),this.$headerActionElement.removeClass("x-deactive");for(var month=0,i=0;3>i;i++){tr=angular.element("<tr></tr>");for(var j=0;4>j;j++)td=angular.element("<td>"+dateUtil.getNameOfMonth(month)+"</td>"),td.attr("tabindex","-1"),date.setMonth(month++),td.addClass("x-month"),currentDate.getMonth()===date.getMonth()&&currentDate.getFullYear()===date.getFullYear()&&td.addClass("x-current"),selectedDate&&date.getMonth()===selectedDate.getMonth()&&date.getFullYear()===selectedDate.getFullYear()&&td.addClass("x-selected"),td.data("date",new Date(date.getTime())),tr.append(td);this.$contentElement.append(tr)}this._bindHandlers(angular.element(this.$contentElement[0].querySelectorAll("[tabindex]"))),this.doLayout=this.monthlyLayout},component.prototype.dailyLayout=function(){var whichDay,tr,td,currentDate=new Date,selectedDate=this.getValue(),date=new Date(this.getDate().getTime()),month=date.getMonth();this.setHeaderText(dateUtil.getNameOfMonth(date.getMonth())+" "+date.getFullYear()),this.$contentElement.empty(),this.$headerActionElement.removeClass("x-deactive"),date.setDate(1),whichDay=date.getDay()-1,-1===whichDay&&(whichDay=6),0===whichDay?date.setDate(date.getDate()-7):date.setDate(date.getDate()-whichDay),tr=angular.element('<tr class="x-labels"></tr>'),td=angular.element("<th>"+$translate.instant("date.monday")+"</th>"),tr.append(td),td=angular.element("<th>"+$translate.instant("date.tuesday")+"</th>"),tr.append(td),td=angular.element("<th>"+$translate.instant("date.wednesday")+"</th>"),tr.append(td),td=angular.element("<th>"+$translate.instant("date.thursday")+"</th>"),tr.append(td),td=angular.element("<th>"+$translate.instant("date.friday")+"</th>"),tr.append(td),td=angular.element("<th>"+$translate.instant("date.saturday")+"</th>"),tr.append(td),td=angular.element("<th>"+$translate.instant("date.sunday")+"</th>"),tr.append(td),this.$contentElement.append(tr);for(var i=0;6>i;i++){tr=angular.element("<tr></tr>");for(var j=0;7>j;j++)td=angular.element("<td>"+date.getDate()+"</td>"),td.addClass("x-day"),month==date.getMonth()?(td.attr("tabindex","-1"),date.getDate()===currentDate.getDate()&&currentDate.getMonth()===date.getMonth()&&currentDate.getFullYear()===date.getFullYear()&&td.addClass("x-current"),selectedDate&&date.getDate()===selectedDate.getDate()&&date.getMonth()===selectedDate.getMonth()&&date.getFullYear()===selectedDate.getFullYear()&&td.addClass("x-selected"),td.data("date",new Date(date.getTime()))):td.addClass("x-other"),tr.append(td),date.setDate(date.getDate()+1);this.$contentElement.append(tr)}this._bindHandlers(angular.element(this.$contentElement[0].querySelectorAll("[tabindex]"))),this.doLayout=this.dailyLayout},component.prototype.renderTo=function(element){this.setRootElement(element),this.render()},component.prototype.render=function(){this.reset(),this._renderInit(),this.doLayout()},component.prototype.reset=function(){this.value?this.setDate(this.value):this.setDate(new Date),this.doLayout=this.dailyLayout},{restrict:"A",require:["?ngModel","xpsuiCalendar","xpsuiDateEdit"],controller:component,link:function(scope,elm,attrs,ctrls){var ngModel=ctrls[0],xpsuiDatapickerCtrl=ctrls[1],xpsuiTextInputCtrl=ctrls[2],schemaFragment=scope.$eval(attrs.xpsuiSchema),dropdown=dropdownFactory.create(elm,{titleTransCode:schemaFragment?schemaFragment.transCode:"label.date"});dropdown.setInput(xpsuiTextInputCtrl.getInput()).render(),elm.addClass("x-calendar-wrapper"),xpsuiDatapickerCtrl.setRootElement(elm),xpsuiDatapickerCtrl.setInput(xpsuiTextInputCtrl.getInput()),dropdown?xpsuiDatapickerCtrl.setDropdown(dropdown):xpsuiDatapickerCtrl.render(),ngModel&&(xpsuiDatapickerCtrl.setOptions({onSelected:function(date){xpsuiTextInputCtrl.getInput().val(dateUtil.formatter(date)),scope.$apply(function(){ngModel.$setViewValue(dateUtil.formatter(date))})}}),ngModel.$render=function(){xpsuiDatapickerCtrl.setValue(dateUtil.parser(ngModel.$viewValue)),xpsuiDatapickerCtrl.isRendered&&xpsuiDatapickerCtrl.render(),xpsuiTextInputCtrl.getInput().val(ngModel.$viewValue||"")},ngModel.$formatters.push(dateUtil.formatter),ngModel.$parsers.push(dateUtil.parser))}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiConfirmClick",[function(){return{link:function(scope,element,attr){var msg=attr.xpsuiConfirmClick||"Are you sure?",clickAction=attr.xpsuiConfirmedClick;element.bind("click",function(event){window.confirm(msg)&&scope.$eval(clickAction)})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiContenteditable",["xpsui:logging","$compile","$animate","$timeout",function(log,$compile,$animate,$timeout){return{restrict:"A",require:["ngModel"],link:function(scope,elm,attrs,ctrls){function pasteHtmlAtCaret(html,selectPastedContent){var sel,range;if(window.getSelection){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount){range=sel.getRangeAt(0),range.deleteContents();var el=document.createElement("div");el.innerHTML=html;for(var node,lastNode,frag=document.createDocumentFragment();node=el.firstChild;)lastNode=frag.appendChild(node);var firstNode=frag.firstChild;range.insertNode(frag),lastNode&&(range=range.cloneRange(),range.setStartAfter(lastNode),selectPastedContent?range.setStartBefore(firstNode):range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))}}else if((sel=document.selection)&&"Control"!=sel.type){var originalRange=sel.createRange();originalRange.collapse(!0),sel.createRange().pasteHTML(html),selectPastedContent&&(range=sel.createRange(),range.setEndPoint("StartToStart",originalRange),range.select())}}log.group("contenteditable Link");var ngModel=ctrls[0];elm.addClass("x-contenteditable");var buttonsHolder=angular.element('<div class="x-contenteditable-buttons-holder x-zero-height"></div>'),content=angular.element('<div class="x-contenteditable-content" contenteditable="true"><div>');ngModel.$render=function(){"string"==typeof ngModel.$viewValue?content.html(ngModel.$viewValue||""):content.html("")};var commitData=function(){ngModel.$setViewValue(content.html())};elm.append(buttonsHolder),elm.append(content);var buttonLeft=angular.element('<button class="x-contenteditable-left"></button>'),buttonCenter=angular.element('<button class="x-contenteditable-center"></button>'),buttonRight=angular.element('<button class="x-contenteditable-right"></button>'),buttonJustify=angular.element('<button class="x-contenteditable-justify"></button>'),buttonBold=angular.element('<button class="x-contenteditable-bold"></button>'),buttonItalic=angular.element('<button class="x-contenteditable-italic"></button>'),buttonRemoveFormat=angular.element('<button class="x-contenteditable-remove-format"></button>'),buttonLink=angular.element('<button class="x-contenteditable-link"></button>'),buttonImage=angular.element('<button class="x-contenteditable-image"></button>'),buttonUndo=angular.element('<button class="x-contenteditable-undo"></button>'),buttonRedo=angular.element('<button class="x-contenteditable-redo"></button>'),buttonRemoveHeading=angular.element('<button class="x-contenteditable-h">0</button>'),buttonH1=angular.element('<button class="x-contenteditable-h">1</button>'),buttonH2=angular.element('<button class="x-contenteditable-h">2</button>'),buttonH3=angular.element('<button class="x-contenteditable-h">3</button>'),buttonOL=angular.element('<button class="x-contenteditable-ol"></button>'),buttonUL=angular.element('<button class="x-contenteditable-ul"></button>'),buttonOutdent=angular.element('<button class="x-contenteditable-outdent"></button>'),buttonIndent=angular.element('<button class="x-contenteditable-indent"></button>'),buttonTable=angular.element('<button class="x-contenteditable-table"></button>');buttonsHolder.append(buttonLeft),buttonsHolder.append(buttonCenter),buttonsHolder.append(buttonRight),buttonsHolder.append(buttonJustify),buttonsHolder.append(buttonBold),buttonsHolder.append(buttonItalic),buttonsHolder.append(buttonRemoveFormat),buttonsHolder.append(buttonLink),buttonsHolder.append(buttonImage),buttonsHolder.append(buttonUndo),buttonsHolder.append(buttonRedo),buttonsHolder.append(buttonRemoveHeading),buttonsHolder.append(buttonH1),buttonsHolder.append(buttonH2),buttonsHolder.append(buttonH3),buttonsHolder.append(buttonOL),buttonsHolder.append(buttonUL),buttonsHolder.append(buttonOutdent),buttonsHolder.append(buttonIndent),buttonsHolder.append(buttonTable),buttonCenter.on("click",function(evt){document.execCommand("justifyCenter",!1,null)}),buttonLeft.on("click",function(evt){document.execCommand("justifyLeft",!1,null)}),buttonRight.on("click",function(evt){document.execCommand("justifyRight",!1,null)}),buttonJustify.on("click",function(evt){document.execCommand("justifyFull",!1,null)}),buttonBold.on("click",function(evt){document.execCommand("bold",!1,null)}),buttonItalic.on("click",function(evt){document.execCommand("italic",!1,null)}),buttonRemoveFormat.on("click",function(evt){document.execCommand("removeFormat",!1,null)}),buttonRemoveHeading.on("click",function(evt){document.execCommand("formatBlock",!1,"div")}),buttonImage.on("click",function(evt){var url=prompt("Please enter URL");url&&document.execCommand("insertHTML",!1,"<img xpsui-contenteditable/>")}),buttonLink.on("click",function(evt){var url=prompt("Please enter URL");url&&document.execCommand("createLink",!1,url)}),buttonUndo.on("click",function(evt){document.execCommand("undo",!1,null)}),buttonRedo.on("click",function(evt){document.execCommand("redo",!1,null)}),buttonH1.on("click",function(evt){document.execCommand("formatBlock",!1,"H1")}),buttonH2.on("click",function(evt){document.execCommand("formatBlock",!1,"H2")}),buttonH3.on("click",function(evt){document.execCommand("formatBlock",!1,"H3")}),buttonOL.on("click",function(evt){document.execCommand("insertOrderedList",!1,null)}),buttonUL.on("click",function(evt){document.execCommand("insertUnorderedList",!1,null)}),buttonOutdent.on("click",function(evt){document.execCommand("outdent",!1,null)}),buttonIndent.on("click",function(evt){document.execCommand("indent",!1,null)}),buttonTable.on("click",function(evt){var table,tbody,tr,td,br,rowstext=prompt("enter rows"),colstext=prompt("enter cols"),rows=parseInt(rowstext),cols=parseInt(colstext);if(rows>0&&cols>0){table=angular.element("<table></table>"),tbody=angular.element("<tbody></tbody>");for(var i=0;rows>i;i++){tr=angular.element("<tr></tr>");for(var j=0;cols>j;j++)td=angular.element("<td></td>"),br=angular.element("</br>"),td.append(br),tr.append(td);tbody.append(tr)}table.append(tbody),pasteHtmlAtCaret(table[0].outerHTML,content)}});var buttonsHide=function(){buttonsHolder.addClass("x-zero-height"),console.log("dddd")},buttonsHideTimeout=$timeout(buttonsHide,5e3,!1);elm.on("mousemove",function(evt){$timeout.cancel(buttonsHideTimeout),buttonsHideTimeout=null,buttonsHolder.removeClass("x-zero-height"),buttonsHideTimeout=$timeout(buttonsHide,5e3,!1)}),content.on("blur keyup",function(evt){scope.$apply(commitData)}),content.on("mouseup keyup",function(evt){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE "),trident=ua.indexOf("Trident/");if(!(msie>0||trident>0)){var htmlNodes=rangy.getSelection(),htmlElements=[];if(!htmlNodes.containsNode(content[0],!1)){if(htmlNodes=htmlNodes.getAllRanges(),htmlNodes.length>0)for(htmlNodes=htmlNodes[0].startContainer;htmlNodes!=content[0]&&htmlNodes.parentElement!=content[0];)htmlNodes=htmlNodes.parentElement,htmlNodes.getAttribute("align")?htmlElements.push(htmlNodes.getAttribute("align")):htmlElements.push(htmlNodes.nodeName);htmlNodes=rangy.getSelection().getAllRanges();var htmlElements2=[];if(htmlNodes.length>0)for(htmlNodes=htmlNodes[0].endContainer;htmlNodes!=content[0]&&htmlNodes.parentElement!=content[0];)htmlNodes=htmlNodes.parentElement,getComputedStyle(htmlNodes).getPropertyValue("font-weight")&&htmlElements.push(getComputedStyle(htmlNodes).getPropertyValue("font-weight")),getComputedStyle(htmlNodes).getPropertyValue("font-style")&&htmlElements.push(getComputedStyle(htmlNodes).getPropertyValue("font-style")),htmlNodes.getAttribute("align")?htmlElements.push(htmlNodes.getAttribute("align")):getComputedStyle(htmlNodes).getPropertyValue("text-align")?htmlElements.push(getComputedStyle(htmlNodes).getPropertyValue("text-align")):htmlElements2.push(htmlNodes.nodeName);htmlElements=htmlElements.concat(htmlElements2)}for(var isBold=!1,isItalic=!1,isH1=!1,isH2=!1,isH3=!1,align=0,isOL=!1,isUL=!1,isTable=!1,i=0;i<htmlElements.length;i++)"B"==htmlElements[i]&&(isBold=!0),"I"==htmlElements[i]&&(isItalic=!0),"H1"==htmlElements[i]&&(isH1=!0),"H2"==htmlElements[i]&&(isH2=!0),"H3"==htmlElements[i]&&(isH3=!0),"left"==htmlElements[i]&&(align=0),"right"==htmlElements[i]&&(align=1),"center"==htmlElements[i]&&(align=2),"justify"==htmlElements[i]&&(align=3),"OL"==htmlElements[i]&&(isOL=!0),"UL"==htmlElements[i]&&(isUL=!0),"TABLE"==htmlElements[i]&&(isTable=!0);isBold?buttonBold.addClass("chosen"):buttonBold.removeClass("chosen"),isItalic?buttonItalic.addClass("chosen"):buttonItalic.removeClass("chosen"),isH1?buttonH1.addClass("chosen"):buttonH1.removeClass("chosen"),isH2?buttonH2.addClass("chosen"):buttonH2.removeClass("chosen"),isH3?buttonH3.addClass("chosen"):buttonH3.removeClass("chosen"),0===align?buttonLeft.addClass("chosen"):buttonLeft.removeClass("chosen"),1===align?buttonRight.addClass("chosen"):buttonRight.removeClass("chosen"),2===align?buttonCenter.addClass("chosen"):buttonCenter.removeClass("chosen"),3===align?buttonJustify.addClass("chosen"):buttonJustify.removeClass("chosen"),isOL?buttonOL.addClass("chosen"):buttonOL.removeClass("chosen"),isUL?buttonUL.addClass("chosen"):buttonUL.removeClass("chosen"),isTable?buttonTable.addClass("chosen"):buttonTable.removeClass("chosen")}}),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiDashboardWidgetEmpty",["xpsui:logging","$compile",function(log,$compile){return{link:function(scope,elm,attrs,ctrls){log.group("xpsui-dashboard-widget-empty Widget"),console.log("hello!"),elm.empty(),elm.addClass("dashboard-widget-container");var titleBar=angular.element('<div class="dashboard-widget-title">Empty widget</div>'),content=angular.element('<div class="dashboard-widget-content">Empty widget content.<br/></div>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";function createWidgetBlock(title,content){var block=angular.element('<div class="dashboard-widget-block"><div class="dashboard-widget-block-title">'+title+"<div></div>"),contentDiv=angular.element('<div class="dashboard-widget-block-content"><div>');return contentDiv.append(content),block.append(contentDiv),block}angular.module("xpsui:directives").directive("xpsuiDashboardWidgetRequests",["xpsui:logging","$compile","$translate","$http","$location","xpsui:SchemaUtil","xpsui:NotificationFactory","xpsui:NavigationService",function(log,$compile,$translate,$http,$location,schemaUtilFactory,notificationFactory,navigationService){return{controller:function($scope,$element,$attrs){},link:function(scope,elm,attrs,ctrls){scope.showRegistrations=function(){navigationService.navigateToPath("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FpeopleRegistrationApplicant~2Fsearch","search"),$location.path("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FpeopleRegistrationApplicant~2Fsearch")},scope.showDataChanges=function(){navigationService.navigateToPath("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FdataChangeApplicant~2Fsearch","search"),$location.path("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FdataChangeApplicant~2Fsearch")},scope.showTransfers=function(){navigationService.navigateToPath("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FtransferApplicant~2Fsearch","search"),$location.path("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FtransferApplicant~2Fsearch")},scope.showRegistrationsSolver=function(){navigationService.navigateToPath("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FpeopleRegistrationSolver~2Fsearch","search"),$location.path("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FpeopleRegistrationSolver~2Fsearch")},scope.showDataChangesSolver=function(){navigationService.navigateToPath("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FdataChangeSolver~2Fsearch","search"),$location.path("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FdataChangeSolver~2Fsearch")},scope.showTransfersSolver=function(){navigationService.navigateToPath("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FtransferSolver~2Fsearch","search"),$location.path("/registry/search/uri~3A~2F~2Fregistries~2Frequests~23views~2FtransferSolver~2Fsearch")};var getCount=function(uri,block,onClick){$http({method:"POST",url:"/search/"+schemaUtilFactory.encodeUri(uri)}).success(function(data,status,headers,config){if(block.empty(),data)return block.html("<span>"+data.length+'</span><br/> <a ng-click=" '+onClick+' ">'+$translate.instant("generic.more")+"</a>"),void $compile(block)(scope);var label_noOpenRequests=$translate.instant("dashboard.widget.members.noOpenRequests");block.text(label_noOpenRequests)}).error(function(err){notificationFactory.error(err)})};log.group("xpsui-dashboard-widget-requests Widget"),elm.empty(),elm.addClass("dashboard-widget-container");var title=$translate.instant("dashboard.widget.notifications.title"),titleBar=angular.element('<div class="dashboard-widget-title">'+title+"</div>"),content=angular.element('<div class="dashboard-widget-content"></div>'),blocks=angular.element('<div class="dashboard-widget-blocks"></div>');content.append(blocks);var label_loading=$translate.instant("generic.loading"),contentBlock1Elm=angular.element("<div>"+label_loading+"</div>"),contentBlock2Elm=angular.element("<div>"+label_loading+"</div>"),contentBlock3Elm=angular.element("<div>"+label_loading+"</div>");if(scope.hasPermissions(["Registry - read"])){var contentBlock1Title=$translate.instant("dashboard.widget.members.openRequests"),contentBlock2Title=$translate.instant("dashboard.widget.data.openRequests"),contentBlock3Title=$translate.instant("dashboard.widget.transfer.openRequests");getCount("uri://registries/requests#views/peopleRegistrationSolver/search",contentBlock1Elm,"showRegistrationsSolver()"),getCount("uri://registries/requests#views/dataChangeSolver/search",contentBlock2Elm,"showDataChangesSolver()"),getCount("uri://registries/requests#views/transferSolver/search",contentBlock3Elm,"showTransfersSolver()")}else if(scope.hasPermissions(["Registry Requests"])){var contentBlock1Title=$translate.instant("dashboard.widget.members.openRequests"),contentBlock2Title=$translate.instant("dashboard.widget.data.openRequests"),contentBlock3Title=$translate.instant("dashboard.widget.transfer.openRequests");getCount("uri://registries/requests#views/peopleRegistrationApplicant/search",contentBlock1Elm,"showRegistrations()"),getCount("uri://registries/requests#views/dataChangeApplicant/search",contentBlock2Elm,"showDataChanges()"),getCount("uri://registries/requests#views/transferApplicant/search",contentBlock3Elm,"showTransfers()")}var block1=createWidgetBlock(contentBlock1Title,contentBlock1Elm);blocks.append(block1);var block2=createWidgetBlock(contentBlock2Title,contentBlock2Elm);blocks.append(block2);var block3=createWidgetBlock(contentBlock3Title,contentBlock3Elm);blocks.append(block3),elm.append(titleBar),elm.append(content),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiDateEdit",["xpsui:logging",function(log){return{restrict:"A",require:["ngModel","?^xpsuiFormControl","xpsuiDateEdit"],controller:function($scope,$element,$attrs){this.setup=function(){this.$input=angular.element("<input></input>")},this.getInput=function(){return this.$input},this.$input=null,this.setup()},link:function(scope,elm,attrs,ctrls){log.group("String edit Link");var ngModel=ctrls[0],formControl=ctrls[1]||{},selfControl=ctrls[2],input=selfControl.getInput();elm.addClass("x-control"),elm.addClass("x-date-edit"),ngModel.$render=function(){input.val(ngModel.$viewValue||""),formControl.oldValue=ngModel.$modelValue},elm.append(input),input.on("change",function(evt){scope.$apply(function(){ngModel.$setViewValue(input.val())})}),elm.bind("focus",function(evt){input[0].focus()}),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiDateView",["xpsui:logging","xpsui:DateUtil",function(log,dateUtil){return{restrict:"A",require:["ngModel"],link:function(scope,elm,attrs,ctrls){log.group("String view Link");var ngModel=ctrls[0],view=angular.element("<div></div>");elm.addClass("x-control"),elm.addClass("x-date-view"),ngModel.$render=function(){view.text(dateUtil.formatter(ngModel.$viewValue)||" ")},elm.append(view),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiDefaultSrc",["xpsui:logging",function(log){return{restrict:"A",link:function(scope,elm,attrs){attrs.ngSrc?scope.$watch(function(){return attrs.ngSrc},function(newVal){console.log(newVal+attrs.ngSrc),(null===newVal||newVal.length<1)&&elm.attr("src",attrs.xpsuiDefaultSrc)}):elm.attr("src",attrs.xpsuiDefaultSrc),elm.bind("error",function(){elm.attr("src",attrs.xpsuiDefaultSrc)})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiFieldset",["xpsui:logging","xpsui:FormGenerator","$translate",function(log,formGenerator,$translate){return{restrict:"A",link:function(scope,elm,attrs,ctrls){log.group("FieldSet Link");
var modelPath=attrs.xpsuiModel,options=attrs.xpsuiOptions;if(elm.addClass("x-fieldset"),!modelPath||!options)return log.warn("Attributes xpsui-model and xpsui-options have to be set, skipping fieldset generation"),void log.groupEnd();var schema=scope.$eval(options),mode=attrs.xpsuiFieldset;if(schema&&schema.render&&schema.render.width)switch(schema.render.width){case"full":elm.addClass("x-fieldset-full")}schema&&(schema.title||schema.transCode)?elm.append('<div class="x-fieldset-title">'+(schema.transCode?$translate.instant(schema.transCode):schema.title)+"</div>"):elm.append('<div class="x-fieldset-title"></div>');var content=angular.element('<div class="x-fieldset-content"></div>');elm.append(content),formGenerator.generateForm(scope,content,schema,options,modelPath,mode||formGenerator.MODE.VIEW),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiFormControl",["xpsui:logging",function(log){return{restrict:"A",controller:function(){this.form=null,this.focusedElm=null,this.oldValue=null,this.acquireFocus=function(e){return this.form.acquireFocus(e)},this.releaseFocus=function(e){this.form.releaseFocus(e)},this.commit=function(){},this.rollback=function(){}},require:["xpsuiFormControl","^xpsuiForm","?ngModel"],link:function(scope,elm,attrs,ctrls){var formControl=ctrls[0],form=ctrls[1];ctrls[2];formControl.form=form;var schema=scope.$eval(attrs.xpsuiSchema);if(schema.calculation&&form){log.debug("Registering calculation");var unregister=form.registerCalculation(attrs.xpsuiModel,schema.calculation);scope.$on("destroy",unregister)}}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiForm",["$compile","$parse","xpsui:logging","xpsui:FormGenerator","xpsui:Calculator","$translate",function($compile,$parse,log,formGenerator,calculator,$translate){return{restrict:"A",require:"^form",controller:["$scope","$element","$attrs",function($scope,$element,$attrs){this.focusedElm=null,this.acquireFocus=function(e){return null===this.focusedElm||this.focusedElm===e?(this.focusedElm=e,!0):!1},this.releaseFocus=function(e){return this.focusedElm===e?(this.focusedElm=null,!0):!1},this.registerCalculation=function(model,schema){function calculate(){var modelValue=modelGetter($scope);schema.onlyEmpty&&void 0!==modelValue&&""!==modelValue||property.getter(formModel).then(function(result){modelGetter.assign($scope,result)})}var property=calculator.createProperty(schema),formModelGetter=$parse($attrs.xpsuiModel),modelGetter=$parse(model),formModel=formModelGetter($scope);return calculate(),$scope.$watch(property.watcher(formModel),function(newValue,oldValue){newValue!=oldValue&&calculate()},!0)}}],link:function(scope,elm,attrs,ctrls){log.group("xpsuiForm Link"),log.time("xpsuiForm Link");var formCtrl=ctrls;return formCtrl.xpsui=formCtrl.xpsui||{submitPrepare:!1,prepareForSubmit:function(){formCtrl.xpsui.submitPrepare=!0}},elm.addClass("x-form"),attrs.xpsuiModel&&attrs.xpsuiSchema?(scope.$watchCollection(attrs.xpsuiSchema,function(){log.info("xpsuiForm generate");var schema=scope.$eval(attrs.xpsuiSchema),mode=attrs.xpsuiForm;if("viewedit"===mode&&schema.clientActions){var contentActionsHolder=angular.element('<div class="content-actions pull-right"></div>');elm.append(contentActionsHolder);for(var actionIndex in schema.clientActions){var actionElm,action=schema.clientActions[actionIndex];switch(console.log("xxxxxxx"+action.__DIRECTIVE__),action.__DIRECTIVE__){case"action-link":actionElm=angular.element('<a xpsui-form-action-link psui-options="schemaFormOptions.schema.clientActions['+actionIndex+']" psui-model="'+attrs.xpsuiModel+'" class="btn-primary"></a>'),$compile(actionElm)(scope),contentActionsHolder.append(actionElm);break;case"generate-action-link":actionElm=angular.element('<a xpsui-form-generate-action-link psui-options="schemaFormOptions.schema.clientActions['+actionIndex+']" psui-model="'+attrs.xpsuiModel+'" class="btn-primary"></a>'),$compile(actionElm)(scope),contentActionsHolder.append(actionElm);break;default:console.error("Unknown directive value",action.__DIRECTIVE__)}}}schema.properties?(elm.append('<div class="x-form-title">'+(schema.transCode?$translate.instant(schema.transCode):schema.title)+"</div>"),formGenerator.generateForm(scope,elm,schema,attrs.xpsuiSchema,attrs.xpsuiModel,mode||formGenerator.MODE.VIEW)):log.info("xpsuiForm schema does not exist")}),log.timeEnd("xpsuiForm Link"),void log.groupEnd()):(log.warn("Attributes xpsui-model and xpsui-schema have to be set, skipping form generation"),log.timeEnd("xpsuiForm Link"),void log.groupEnd())}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiFormGenerateActionLink",["xpsui:SchemaUtil",function(schemaUtilFactory){return{restrict:"A",link:function(scope,elm,attrs,ctrls){var options=scope.$eval(attrs.psuiOptions);scope.$eval(attrs.psuiModel);elm.append("<span>"+options.title+"</span>"),scope.$watch(attrs.psuiModel+".id",function(nv,ov){nv&&attrs.$set("href","/#/registry/generated/"+schemaUtilFactory.encodeUri(options.schemaFrom)+"/"+nv+"/"+options.generateBy+"/"+options.template)})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:services").factory("xpsui:GenericSearchFactory",["$http","xpsui:SchemaUtil","$translate",function($http,schemaUtilFactory,$translate){var service={};return service.getSearch=function(searchSchema,crits,sortBy,skip,limit){return $http({method:"POST",url:"/search/"+schemaUtilFactory.encodeUri(schemaUtilFactory.concatUri(searchSchema,"search")),data:{crits:crits,sorts:sortBy,limit:limit,skip:skip}})},service.getSearchCount=function(searchSchema,crits){return $http({method:"POST",url:"/search/count/"+schemaUtilFactory.encodeUri(schemaUtilFactory.concatUri(searchSchema,"search")),data:{crits:crits}})},service.parseSearchDef=function(schema){function collectProperties(pathPrefix,objectDef,group,resultArr){for(var pr in objectDef.properties)objectDef.properties[pr].objectLink2?resultArr.push({path:pathPrefix+pr+".oid",type:objectDef.properties[pr].type,render:{objectLink2:objectDef.properties[pr].objectLink2},schemaFragment:objectDef.properties[pr],group:group,title:objectDef.properties[pr].transCode?$translate.instant(objectDef.properties[pr].transCode):objectDef.properties[pr].title}):"render"in objectDef.properties[pr]&&"psui-datepicker"===objectDef.properties[pr].render.component?resultArr.push({path:pathPrefix+pr,type:objectDef.properties[pr].type,render:{datepicker:!0},schemaFragment:objectDef.properties[pr],group:group,title:objectDef.properties[pr].transCode?$translate.instant(objectDef.properties[pr].transCode):objectDef.properties[pr].title}):"object"===objectDef.properties[pr].type?collectProperties(pr+".",objectDef.properties[pr],objectDef.properties[pr].transCode?$translate.instant(objectDef.properties[pr].transCode):objectDef.properties[pr].title,resultArr):resultArr.push({path:pathPrefix+pr,type:objectDef.properties[pr].type,group:group,title:objectDef.properties[pr].transCode?$translate.instant(objectDef.properties[pr].transCode):objectDef.properties[pr].title})}var retval={};return retval.schema=schema.url,retval.attributes=[],retval.operators=[{title:"=",value:"eq"},{title:">",value:"gt"},{title:">=",value:"gte"},{title:"<",value:"lt"},{title:"<=",value:"lte"},{title:"je iné ako",value:"neq"},{title:"začína s",value:"starts"},{title:"obsahuje",value:"contains"},{title:"má vyplnené",value:"ex"}],collectProperties("",schema,null,retval.attributes),retval},service}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiImageresizor",["$compile","$translate",function($compile,$translate){return{restrict:"A",require:["?xpsuiUploadableImage"],link:function(scope,elm,attrs,ctrls){function moveImg(clientX,clientY){1==state&&(0==numberOfRot?(difX=difX+clientX-x,difY=difY+clientY-y):1==numberOfRot?(difX=difX+clientY-y,difY=difY-clientX+x):2==numberOfRot?(difX=difX-clientX+x,difY=difY-clientY+y):3==numberOfRot&&(difX=difX-clientY+y,difY=difY+clientX-x),draw(context,context2)),x=clientX,y=clientY}function getVector(vec){return{x:vec.clientX,y:vec.clientY}}function vectorLength(vec1,vec2){var x=Math.abs(vec1.x-vec2.x),y=Math.abs(vec1.y-vec2.y);return Math.sqrt(x*x+y*y)}var wrapper=elm;elm.addClass("xpsui-imageresizor");var pomer,x,y,tmp,originImgWidth,originImgHeight,imgCtrl=ctrls[0],resultImgWidth=attrs.psuiWidth||0,resultImgHeight=attrs.psuiHeight||0,imgWidth=attrs.psuiWidth||0,imgHeight=attrs.psuiHeight||0,resize=1,width=2*imgWidth,height=2*imgHeight,state=0,difX=0,difY=0;if(window.innerWidth<width){var resizeRatio=window.innerWidth/width;height=Math.round(height*resizeRatio),width=window.innerWidth,imgWidth=(attrs.psuiWidth||0)*resizeRatio,imgHeight=(attrs.psuiHeight||0)*resizeRatio}console.log("Imageresizor width: "+width+" height: "+height);var modalEl=angular.element('<div class="xpsui-imageresizor-resizor" ></div>');modalEl.addClass("x-modalview"),wrapper.append(modalEl);var modalContentWrapperEl=angular.element("<div></div>");modalContentWrapperEl.addClass("x-modalview-window"),modalEl.append(modalContentWrapperEl);var modalWidth=width+40;window.innerWidth<modalWidth&&(modalWidth=width,height*=(width-40)/width,width-=40),modalContentWrapperEl.css("width",""+modalWidth+"px");var labelTranslated="";attrs.xpsuiSchema&&$translate.instant(scope.$eval(attrs.xpsuiSchema.concat(".transCode")));var modalHeader=$compile(angular.element('<div class="x-modalview-header"><span>'+labelTranslated+"</span></div>"))(scope);modalContentWrapperEl.append(modalHeader);var modalContentEl=angular.element("<div></div>");modalContentEl.addClass("x-modalview-body"),modalContentWrapperEl.append(modalContentEl);var canvasContainer=angular.element('<div class="xpsui-uploadable-canvas-container"></div>'),resizorCanvas=angular.element("<canvas ></canvas>");resizorCanvas.attr("width",width),resizorCanvas.attr("height",height),canvasContainer.append(resizorCanvas),modalContentEl.append(canvasContainer);var canvasResult=angular.element('<canvas class="xpsui-imageresizor-result" width="'+resultImgWidth+'" height="'+resultImgHeight+'"></canvas>');canvasResult.addClass("x-hidden"),wrapper.append(canvasResult);var buttonsHolder=angular.element('<div class="xpsui-buttons-holder"></div>');modalContentEl.append(buttonsHolder);var buttonRotate=$compile(angular.element('<button type="button" class="btn btn-edit xpsui-icon-rotate"><icon class="icon-rotate"></icon> <span>{{\'psui.imageresizor.rotate\' | translate}}</span></button>'))(scope);buttonsHolder.append(buttonRotate);var buttonOk=$compile(angular.element('<button type="button" class="btn btn-edit xpsui-icon-ok"><icon class="icon-check"></icon> <span>{{\'psui.imageresizor.ok\' | translate}}</span></button>'))(scope);buttonsHolder.append(buttonOk);var buttonClose=angular.element('<div class="x-modalview-close"></div>');modalHeader.append(buttonClose);var numberOfRot=0;buttonRotate.on("click",function(evt){return numberOfRot+=1,numberOfRot%=4,tmp=originImgHeight,originImgHeight=originImgWidth,originImgWidth=tmp,difX=0,difY=0,resize=1,draw(context,context2),evt.stopPropagation(),!1});var context=resizorCanvas[0].getContext("2d"),context2=canvasResult[0].getContext("2d");context.translate(width/2,height/2);var img=new Image,draw=function(ctx,ctx2){ctx.fillStyle="rgba(0,0,0,1)",ctx.fillRect(-width/2,-height/2,width,height),ctx.rotate(Math.PI/2*numberOfRot),pomer=originImgHeight/originImgWidth>height/width?height/originImgHeight:width/originImgWidth,(imgHeight>=originImgHeight*pomer*resize||imgWidth>=originImgWidth*pomer*resize)&&(resize=originImgHeight/originImgWidth>height/width?imgWidth/(originImgWidth*pomer):imgHeight/(originImgHeight*pomer)),numberOfRot%2===1&&(tmp=difX,difX=difY,difY=tmp),difX>(originImgWidth*resize*pomer-imgWidth)/2&&(difX=(originImgWidth*resize*pomer-imgWidth)/2),-difX>(originImgWidth*resize*pomer-imgWidth)/2&&(difX=-(originImgWidth*resize*pomer-imgWidth)/2),difY>(originImgHeight*resize*pomer-imgHeight)/2&&(difY=(originImgHeight*resize*pomer-imgHeight)/2),-difY>(originImgHeight*resize*pomer-imgHeight)/2&&(difY=-(originImgHeight*resize*pomer-imgHeight)/2),numberOfRot%2===1&&(tmp=difX,difX=difY,difY=tmp),ctx.drawImage(img,-(img.width*resize*pomer)/2+difX,-(img.height*resize*pomer)/2+difY,img.width*pomer*resize,img.height*pomer*resize),ctx.rotate(-(Math.PI/2)*numberOfRot),ctx2.drawImage(resizorCanvas[0],(width-imgWidth)/2,(height-imgHeight)/2,imgWidth,imgHeight,0,0,resultImgWidth,resultImgHeight),ctx.fillStyle="rgba(1,1,1,0.7)",ctx.fillRect(-width/2,-height/2,(width-imgWidth)/2,height),ctx.fillRect(-width/2+(width-imgWidth)/2,-height/2,imgWidth,(height-imgHeight)/2),ctx.fillRect(imgWidth/2,-height/2,(width-imgWidth)/2,height),ctx.fillRect(-width/2+(width-imgWidth)/2,imgHeight/2,imgWidth,(height-imgHeight)/2)};img.onload=function(){console.log("loaded"),originImgWidth=img.width,originImgHeight=img.height,canvasResult.removeClass("x-hidden"),document.querySelector("body").classList.add("x-dropdown-open"),modalEl.addClass("x-open"),draw(context,context2)},imgCtrl&&(imgCtrl.srcElm=img),modalEl.on("click",function(evt){return evt.stopPropagation(),!1}),buttonOk.on("click",function(evt){if(canvasResult[0].toBlob)canvasResult[0].toBlob(imgCtrl.imageProcessed,"image/jpeg");else{for(var parts=canvasResult[0].toDataURL().match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),binStr=atob(parts[3]),buf=new ArrayBuffer(binStr.length),view=new Uint8Array(buf),i=0;i<view.length;i++)view[i]=binStr.charCodeAt(i);var blob=new Blob([view],{type:parts[1]});imgCtrl.imageProcessed(blob)}return canvasResult.addClass("x-hidden"),document.querySelector("body").classList.remove("x-dropdown-open"),modalEl.removeClass("x-open"),evt.stopPropagation(),!1}),buttonClose.on("click",function(evt){return canvasResult.addClass("x-hidden"),document.querySelector("body").classList.remove("x-dropdown-open"),modalEl.removeClass("x-open"),evt.stopPropagation(),!1}),resizorCanvas.on("mousewheel",function(evt){evt.preventDefault(),evt.wheelDelta>0?resize+=.1:resize-=.1,draw(context,context2)}),resizorCanvas.on("DOMMouseScroll",function(evt){evt.preventDefault(),evt.detail<0?resize+=.1:resize-=.1,draw(context,context2)}),resizorCanvas.on("click",function(evt){return evt.stopPropagation(),!1}),resizorCanvas.on("mousedown",function(evt){return state=1,evt.stopPropagation(),!1}),resizorCanvas.on("mouseup mouseleave",function(evt){return state=0,evt.stopPropagation(),!1}),resizorCanvas.on("mousemove",function(evt){return moveImg(evt.clientX,evt.clientY),evt.stopPropagation(),!1});var zoomTouch=[];resizorCanvas.on("touchstart",function(evt){state=1,1===evt.targetTouches.length?(x=evt.targetTouches[0].clientX,y=evt.targetTouches[0].clientY):2===evt.targetTouches.length&&(zoomTouch=[getVector(evt.targetTouches[0]),getVector(evt.targetTouches[1])]),evt.preventDefault()}),resizorCanvas.on("touchend",function(evt){state=0,evt.preventDefault()}),resizorCanvas.on("touchmove",function(evt){if(1===evt.targetTouches.length)moveImg(evt.targetTouches[0].clientX,evt.targetTouches[0].clientY);else if(2===evt.targetTouches.length){var currentZoomTouch=[getVector(evt.targetTouches[0]),getVector(evt.targetTouches[1])];resize+=(vectorLength(currentZoomTouch[0],currentZoomTouch[1])-vectorLength(zoomTouch[0],zoomTouch[1]))/100,draw(context,context2),zoomTouch=currentZoomTouch}evt.preventDefault()})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiInlineedit",["xpsui:logging","xpsui:FormGenerator","$compile","$timeout","$parse",function(log,formGenerator,$compile,$timeout,$parse){return{restrict:"A",require:["^xpsuiFormControl","xpsuiInlineedit"],controller:function(){this.setCommitButton=function(button){this.comitButton=button},this.showCommitButton=function(){this.comitButton.removeClass("x-hidden")},this.hideCommitButton=function(){this.comitButton.addClass("x-hidden")}},link:function(scope,elm,attrs,ctrls){function enterEditMode(){if(mode=formGenerator.MODE.EDIT,viewElm.addClass("x-hidden"),editElm.removeClass("x-hidden"),buttonsElm.removeClass("x-hidden"),elm.addClass("x-inlineedit-edit-mode"),elm.removeClass("x-inlineedit-view-mode"),editElm.triggerHandler("focus"),elm.removeClass("x-inlineedit-active"),elm.off("click",viewModeClickHandler),oldValue=scope.$eval(modelPath),oldValue&&oldValue.constructor==Array){for(var copy=[],i=0;i<oldValue.length;i++)copy[i]=oldValue[i];oldValue=copy}}function enterViewMode(){mode=formGenerator.MODE.VIEW,viewElm.removeClass("x-hidden"),editElm.addClass("x-hidden"),buttonsElm.addClass("x-hidden"),elm.addClass("x-inlineedit-view-mode"),elm.removeClass("x-inlineedit-edit-mode"),elm.on("click",viewModeClickHandler)}function commit(){return enterViewMode(),scope.$emit("xpsui:model_changed"),formControl.releaseFocus(elm),!0}function rollback(){enterViewMode(),scope.$apply(function(){$parse(modelPath).assign(scope,oldValue)}),formControl.releaseFocus(elm)}log.group("Inlineedit Link");var formControl=ctrls[0],selfCtrl=ctrls[1],modelPath=attrs.xpsuiModel,schemaPath=attrs.xpsuiSchema,oldValue=null;if(elm.addClass("x-inlineedit"),!modelPath||!schemaPath)return log.warn("Attributes xpsui-model and xpsui-schema have to be set, skipping inlineedit generation"),void log.groupEnd();var schema=scope.$eval(schemaPath),mode=attrs.xpsuiInlineedit||formGenerator.MODE.VIEW,viewElm=formGenerator.generateField(schema,schemaPath,modelPath,formGenerator.MODE.VIEW),editElm=formGenerator.generateField(schema,schemaPath,modelPath,formGenerator.MODE.EDIT);formGenerator.generateValidations(editElm,schema,schemaPath,modelPath,formGenerator.MODE.EDIT);var contentElm=angular.element('<div class="x-inlineedit-content"></div>');contentElm.append(viewElm),contentElm.append(editElm),elm.append(contentElm),$compile(viewElm)(scope),$compile(editElm)(scope);var buttonsElm=angular.element('<div class="x-inlineedit-buttons x-hidden"></div>'),commitButton=angular.element('<button class="x-component-button x-inlineedit-commit-button"><i class="fa fa-check"></i><span>Uložiť</span></button>'),rollbackButton=angular.element('<button class="x-component-button x-inlineedit-rollback-button"><i class="fa fa-remove"></i><span>Zrušiť</span></button>');selfCtrl.setCommitButton(commitButton),buttonsElm.append(commitButton).append(rollbackButton),elm.append(buttonsElm);var viewModeClickHandler=function(evt){mode===formGenerator.MODE.VIEW&&formControl.acquireFocus(elm)&&enterEditMode()},commitClickHandler=function(evt){return evt.stopPropagation(),commit(),!1};commitButton.on("click",commitClickHandler);var rollbackClickHandler=function(evt){return rollback(),evt.stopPropagation(),!1};rollbackButton.on("click",rollbackClickHandler),elm.on("mouseover",function(evt){mode!==formGenerator.MODE.EDIT&&formControl.acquireFocus(elm)&&(elm.addClass("x-inlineedit-active"),elm.one("mouseout",function(){elm.removeClass("x-inlineedit-active"),mode!==formGenerator.MODE.EDIT&&formControl.releaseFocus(elm)}))}),mode===formGenerator.MODE.EDIT?enterEditMode():enterViewMode(),elm.on("keypress keydown",function(evt){27===evt.which?(rollback(),evt.preventDefault()):13===evt.which?(commit(),evt.preventDefault()):9===evt.which&&commit()}),mode!==formGenerator.MODE.EDIT&&(elm.attr("tabindex","0"),elm.on("focus",function(e){formControl.acquireFocus(elm)&&enterEditMode()})),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiMenuItems",["xpsui:logging",function(log){return{restrict:"A",require:["^xpsuiMenu"],controller:function($scope,$element){},link:function(scope,elm,attrs,ctrls){var submenu=angular.element(elm[0].querySelectorAll(".x-submenu-toggle"));submenu.on("click",function(event){var $this=angular.element(this);$this.parent().toggleClass("x-active"),event.preventDefault()});var links=angular.element(elm[0].querySelectorAll("ul ul a"));links.on("click",function(event){for(var $this=angular.element(this),$open=$this.parent();!$open.hasClass("x-active");)$open=$open.parent();ctrls[0].close(),angular.element(elm[0].querySelectorAll("li.x-active")).removeClass("x-active"),$open.addClass("x-active"),angular.element(elm[0].querySelectorAll("a.x-active-link")).removeClass("x-active-link"),$this.addClass("x-active-link")})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiMenu",["xpsui:logging",function(log){return{restrict:"A",require:["xpsuiMenu"],controller:function(){this.setElement=function(el){this.el=el},this.close=function(){this.el.removeClass("x-open")}},link:function(scope,elm,attrs,ctrls){var button=angular.element(elm[0].querySelectorAll(".x-main-menu-toggle"));ctrls[0].setElement(elm),button.on("click",function(){elm.toggleClass("x-open")}),elm.on("click",function(event){this===event.target&&ctrls[0].close()})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiMultistringEdit",["xpsui:logging","xpsui:DropdownFactory","xpsui:SelectboxFactory","xpsui:SelectDataFactory","$timeout","$http",function(log,dropdownFactory,selectboxFactory,datafactory,$timeout,$http){return{restrict:"A",require:["ngModel","xpsuiMultistringEdit"],controller:function($scope,$element,$attrs){this.setup=function(){this.$input=angular.element("<input></input>")},this.getInput=function(){return this.$input},this.$input=null,this.setup()},link:function(scope,elm,attrs,ctrls){log.group("Multistring edit Link");var ngModel=ctrls[0],selfControl=ctrls[1];elm.addClass("x-multistring-edit");var container=angular.element("<div></div>"),inputWrapper=angular.element('<div class="x-select-edit"></div>'),input=selfControl.getInput(),addButton=angular.element('<button class="btn btn-primary">Pridať</button>');inputWrapper.append(input),elm.addClass("x-control"),elm.addClass("x-multistring-edit"),ngModel.$render=function(){var i,xButton,stringElm;container.empty();for(i in ngModel.$modelValue)stringElm=angular.element('<div class="portal-multistring-element"><span>'+ngModel.$modelValue[i]+"</span></div>"),xButton=angular.element('<i class="icon-remove"></i>'),xButton.data("idx",i),xButton.on("click",function(evt){scope.$apply(function(){ngModel.$modelValue.splice(angular.element(evt.target).data("idx"),1),ngModel.$render()})}),stringElm.append(xButton),container.append(stringElm)},elm.append(container),elm.append(inputWrapper),elm.append(addButton),input.on("change",function(evt){scope.$apply(function(){})}),addButton.on("click",function(e){var newVal=selfControl.getInput().val();newVal&&""!=newVal.trim()&&(ngModel.$modelValue.push(newVal),ngModel.$render(),selfControl.getInput().val(""))}),inputWrapper.bind("focus",function(evt){input[0].focus()});var dropdown=dropdownFactory.create(inputWrapper,{showDropdownAction:!1});dropdown.setInput(selfControl.getInput()).render();var selectbox=selectboxFactory.create(inputWrapper,{useSearchInput:!1,freeTextMode:!0,showInfo:!1,onSelected:function(value){ngModel.$render(),selfControl.getInput().val(value.v),console.log("onSelected"),console.log(arguments)}});selectbox.setInput(selfControl.getInput()),selectbox.setDropdown(dropdown),$http({url:"/portalapi/articleTagsDistinct",method:"GET",headers:{"Content-Type":"application/json"}}).success(function(data,status,headers,config){var dataset=datafactory.createArrayDataset(data);selectbox.setDataset(dataset)}),input.on("keypress",function(){$timeout(function(){dropdown.open(),selectbox.actionFilter(input.val())},300)}),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiNotification",["$rootScope","$timeout","$compile",function($rootScope,$timeout,$compile){return{restrict:"AE",link:function(scope,elm,attrs,ctrls){elm.addClass("x-notification"),$rootScope.psuiNotification=$rootScope.psuiNotification||{},$rootScope.psuiNotification.message=$rootScope.psuiNotification.message||[],scope.$watchCollection("psuiNotification.message",function(newNames,oldNames){for(var i=0;i<$rootScope.psuiNotification.message.length;i++)if(!$rootScope.psuiNotification.message[i].element){if($rootScope.psuiNotification.message[i].translationCode?$rootScope.psuiNotification.message[i].element=$compile(angular.element('<div class="x-notification-'+$rootScope.psuiNotification.message[i].type+"\">{{'"+$rootScope.psuiNotification.message[i].translationCode+"' | translate:'{data:\""+$rootScope.psuiNotification.message[i].translationData+"\"}'}}</div>"))(scope):$rootScope.psuiNotification.message[i].element=angular.element('<div class="x-notification-'+$rootScope.psuiNotification.message[i].type+'">'+$rootScope.psuiNotification.message[i].text+"</div>"),elm.append($rootScope.psuiNotification.message[i].element),$rootScope.psuiNotification.message[i].deletable){var buttonDelete=angular.element('<button type="button"></button>');$rootScope.psuiNotification.message[i].element.append(buttonDelete),$rootScope.psuiNotification.message[i].button=buttonDelete;$rootScope.psuiNotification.message[i];buttonDelete.on("click",function(evt){for(var j=0;j<$rootScope.psuiNotification.message.length;j++)$rootScope.psuiNotification.message[j].button[0]==this&&($rootScope.psuiNotification.message[j].element.remove(),$rootScope.psuiNotification.message.splice(j,1))})}if($rootScope.psuiNotification.message[i].time>0){var searchedMsg=$rootScope.psuiNotification.message[i],messageHide=function(){for(var z=0;z<$rootScope.psuiNotification.message.length;z++)$rootScope.psuiNotification.message[z]==searchedMsg&&($rootScope.psuiNotification.message[z].element.remove(),$rootScope.psuiNotification.message.splice(z,1))};$rootScope.psuiNotification.message[i].timeout=$timeout(messageHide,searchedMsg.time,!1)}}})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiObjectlink2Edit",["xpsui:logging","$parse","xpsui:DropdownFactory","xpsui:Objectlink2Factory","xpsui:SelectDataFactory","xpsui:SchemaUtil","xpsui:RemoveButtonFactory",function(log,$parse,dropdownFactory,objectlink2Factory,dataFactory,schemaUtil,removeButtonFactory){return{restrict:"A",require:["ngModel","?^xpsuiFormControl","xpsuiObjectlink2Edit"],controller:function($scope,$element,$attrs){this.setup=function(){this.$input=angular.element('<div tabindex="0"></div>'),this.$input.addClass("x-input")},this.getInput=function(){return this.$input},this.$input=null,this.setup()},link:function(scope,elm,attrs,ctrls){function render(data){input.empty(),data&&(removeButton.show(),schemaUtil.getFieldsSchemaFragment(schemaFragment.objectLink2.schema,schemaFragment.objectLink2.fields,function(fields){objectlink2Factory.renderElement(input,fields,data)}))}log.group("ObjectLink2 edit Link");var ngModel=ctrls[0],selfControl=(ctrls[1]||{},ctrls[2]),input=selfControl.getInput(),parseSchemaFragment=$parse(attrs.xpsuiSchema),schemaFragment=parseSchemaFragment(scope),removeButton=removeButtonFactory.create(elm,{enabled:!schemaFragment.required,input:input,onClear:function(){input.empty(),scope.$apply(function(){ngModel.$modelValue={}})}});elm.addClass("x-control"),elm.addClass("x-select-edit x-objectlink2-edit"),ngModel.$render=function(){angular.equals({},ngModel.$viewValue)?input.empty():render(dataFactory.getObjectLinkData(schemaFragment.objectLink2,ngModel.$modelValue))},elm.append(input),elm.bind("focus",function(evt){input[0].focus()});var dropdown=dropdownFactory.create(elm,{titleTransCode:schemaFragment.transCode});dropdown.setInput(selfControl.getInput()).render();var selectbox=objectlink2Factory.create(elm,{onSelected:function(value){scope.$apply(function(){ngModel.$setViewValue(value)}),render(value),console.log("onSelected"),console.log(arguments)}});selectbox.setInput(selfControl.getInput()),selectbox.setDropdown(dropdown);var dataset=dataFactory.createObjectDataset(schemaFragment);selectbox.setDataset(dataset),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiObjectlink2View",["xpsui:logging","xpsui:Objectlink2Factory","xpsui:SelectDataFactory","xpsui:SchemaUtil","$parse","$compile","xpsuiuriescapeFilter",function(log,objectlink2Factory,dataFactory,schemaUtil,$parse,$compile,xpsuiuriescape){return{restrict:"A",require:["ngModel"],link:function(scope,elm,attrs,ctrls){log.group("String view Link");var ngModel=ctrls[0],view=angular.element("<div></div>"),parseSchemaFragment=$parse(attrs.xpsuiSchema),schemaFragment=parseSchemaFragment(scope);elm.addClass("x-control"),elm.addClass("x-objectlink2-view"),elm.append(view),ngModel.$render=function(){view.empty(),ngModel.$viewValue&&(ngModel.$viewValue.id||ngModel.$viewValue.oid)&&schemaUtil.getFieldsSchemaFragment(schemaFragment.objectLink2.schema,schemaFragment.objectLink2.fields,function(fields){var data=dataFactory.getObjectLinkData(schemaFragment.objectLink2,ngModel.$viewValue),schemaUri=schemaFragment.objectLink2.schema;schemaUri=schemaUri.substring(0,schemaUri.length-"/view".length),view.append('<a href="#/registry/view/'+xpsuiuriescape(schemaUri)+"/"+data.oid+'" ><i class="icon-external-link fa-1"></i></a>&nbsp;&nbsp;'),objectlink2Factory.renderElement(view,fields,data,scope)})}}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalArticleContentEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",require:["ngModel"],controller:["$scope","$element","$attrs","$parse","$timeout",function($scope,$element,$attrs,$parse,$timeout){this.moveUp=function(idx){if(idx>0){var parsedModel=$parse($attrs.ngModel),array=parsedModel($scope),tmp=array[idx];array[idx]=array[idx-1],array[idx-1]=tmp,parsedModel.assign($scope,array),$scope.$broadcast("modechange")}},this.moveDown=function(idx){var parsedModel=$parse($attrs.ngModel),array=parsedModel($scope);if(idx<array.length-1){var tmp=array[idx];array.splice(idx,1),array.splice(idx+1,0,tmp),parsedModel.assign($scope,array),$scope.$broadcast("modechange")}},this.remove=function(idx){var parsedModel=$parse($attrs.ngModel),array=parsedModel($scope);array.splice(idx,1),parsedModel.assign($scope,array),$scope.$broadcast("modechange")}}],link:function(scope,elm,attrs,ctrls){log.group("portal-article-content-edit Link");var ngModel=ctrls[0];angular.element("<div></div>");ngModel.$render=function(){var i,block;elm.empty();var content=angular.element("<div></div>");for(i=0;i<ngModel.$modelValue.length;++i)block=angular.element("<div >x</div>"),"edit"===scope.mode?block.attr("xpsui-portal-widget-"+ngModel.$modelValue[i].meta.type+"-edit",attrs.ngModel+"["+i+"]"):block.attr("xpsui-portal-widget-"+ngModel.$modelValue[i].meta.type+"-view",attrs.ngModel+"["+i+"]"),ngModel.$modelValue[i].css&&block.attr("class",ngModel.$modelValue[i].css.cssClass),block.attr("index",i),content.append(block),elm.append(content),$compile(block)(scope)},scope.$on("modechange",function(){ngModel.$render()}),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalMenuEditor",["$compile",function($compile){return{restrict:"A",scope:{index:"=xpsuiPortalMenuEditor",elementIdx:"=portalMenuIndex"},controller:["$scope",function($scope){this.remove=function(idx){$scope.index&&$scope.index.subElements&&$scope.index.subElements.splice(idx,1)},this.removeParent=function(idx){$scope.$parent.removeFn(idx)},this.upInParent=function(idx){var curr=$scope.$parent.index.subElements[idx];idx>0&&($scope.$parent.index.subElements.splice(idx,1),$scope.$parent.index.subElements.splice(idx-1,0,curr))},this.downInParent=function(idx){var curr=$scope.$parent.index.subElements[idx];idx<$scope.$parent.index.subElements.length-1&&($scope.$parent.index.subElements.splice(idx,1),$scope.$parent.index.subElements.splice(idx+1,0,curr))}}],require:["^?xpsuiPortalMenuEditor"],link:function(scope,elm,attrs,ctrls){scope.mode="view",scope.opened=!1,
elm.addClass("portal-menu-editor");var header=angular.element('<div class="portal-menu-header"></div>'),openIcon=angular.element('<i class="icon-minus" style="padding-right:10px;"></i>'),children=angular.element('<div style="padding-left: 20px;"><div ng-repeat="c in index.subElements"><div xpsui-portal-menu-editor="c" portal-menu-index="$index"></div></div></div>'),actionButtons=angular.element('<span style="padding-left: 10px;" class="x-hidden"></span>'),editButton=angular.element('<i class="action-button icon-pencil"></i>'),addButton=angular.element('<i class="action-button icon-add"></i>'),removeButton=angular.element('<i class="action-button icon-minus" ng-click="removeParent()"></i>'),downButton=angular.element('<i class="action-button icon-chevron-down" ng-click="downFn()"></i>'),upButton=angular.element('<i class="action-button icon-chevron-up" ng-click="upFn()"></i>'),editPanel=angular.element('<table class="x-hidden portal-menu-editor-edit-panel"><tr><td>Meno:</td><td><input ng-model="index.name"</td></tr><tr><td>Tagy:</td><td><span xpsui-portal-multistring-edit ng-model="index.tags"></span></td></tr><tr><td>Hash tag (#):</td><td><input ng-model="index.hash"</td></tr></table>');editButton.on("click",function(evt){editPanel.toggleClass("x-hidden"),scope.opened=!scope.opened,evt.stopPropagation()}),addButton.on("click",function(evt){scope.$apply(function(){scope.addNew()}),evt.stopPropagation()}),scope.removeParent=function(){ctrls[0]&&ctrls[0].removeParent(scope.elementIdx)},scope.removeFn=function(idx){console.log(idx),ctrls[0]&&ctrls[0].remove(idx)},scope.upFn=function(){editPanel.removeClass("x-hidden"),editPanel.addClass("x-hidden"),children.removeClass("x-hidden"),children.addClass("x-hidden"),ctrls[0]&&ctrls[0].upInParent(scope.elementIdx)},scope.downFn=function(){editPanel.removeClass("x-hidden"),editPanel.addClass("x-hidden"),children.removeClass("x-hidden"),children.addClass("x-hidden"),ctrls[0]&&ctrls[0].downInParent(scope.elementIdx)},ctrls[0]&&actionButtons.append(editButton),actionButtons.append(addButton),ctrls[0]&&(actionButtons.append(removeButton),actionButtons.append(downButton),actionButtons.append(upButton)),header.on("click",function(evt){scope.index&&scope.index.subElements&&scope.index.subElements.length>0&&(openIcon.toggleClass("icon-add"),openIcon.toggleClass("icon-minus"),children.toggleClass("x-hidden")),evt.stopPropagation()}),header.on("mouseover",function(){actionButtons.removeClass("x-hidden")}),header.on("mouseleave",function(){actionButtons.addClass("x-hidden")});var name=angular.element("<span>{{index.name}}</span>");header.append(openIcon),header.append(name),header.append(actionButtons),scope.index&&scope.index.subElements&&scope.index.subElements.length<1&&(openIcon.removeClass("icon-minus"),openIcon.removeClass("icon-add"),openIcon.addClass("glyphicon-record")),elm.append(header),elm.append(editPanel),elm.append(children),$compile(editPanel)(scope),$compile(children)(scope),$compile(header)(scope),scope.addNew=function(){scope.index.subElements.push({name:"...Nový...",transCode:null,tags:[],subElements:[]}),openIcon.addClass("glyphicon-minus-sign"),openIcon.removeClass("glyphicon-record"),openIcon.removeClass("glyphicon-plus-sign"),children.removeClass("x-hidden")}}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalMenuRender",["$http","$route","$compile","$location",function($http,$route,$compile,$location){return{restrict:"A",link:function(scope,elm,attrs,ctrls){function renderMenuEntry(data,element){var menuEntry=angular.element('<div class="portal-menu-entry"><a ng-click="navigate('+counter++ +');">'+data.name+"</a></div>");menuHash.push(data.tags);for(var subMenu=angular.element('<div class="portal-sub-menu"></div>'),i=0;i<data.subElements.length;++i)subMenu.append(angular.element('<div ng-click="navigate('+counter++ +')">'+data.subElements[i].name+"</div>")),menuHash.push(data.subElements[i].tags);return menuEntry.append(subMenu),menuEntry}var loadingDiv=angular.element("<div>Nahrávam...</div>");elm.append(loadingDiv);var menuHash=[],counter=0;$http({method:"GET",url:"/udao/list/portalMenu",data:{}}).success(function(data,status,headers,config){if(elm.empty(),data&&data.length>0&&data[0].index)for(var i=0;i<data[0].index.subElements.length;++i){var menuEntry=renderMenuEntry(data[0].index.subElements[i]);elm.append(menuEntry),$compile(menuEntry)(scope)}}).error(function(err){notificationFactory.error(err)}),scope.navigate=function(i){$http({method:"POST",url:"/portalapi/getByTags",data:{tags:menuHash[i]}}).success(function(data,status,headers,config){data&&data.length>0&&data[0].id&&$location.path("/portal/edit/"+data[0].id)}).error(function(err){notificationFactory.error(err)})}}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("portalMultistringEdit",["xpsui:logging","$parse","xpsui:DropdownFactory","xpsui:SelectboxFactory","xpsui:SelectDataFactory",function(log,$parse,dropdownFactory,selectboxFactory,datafactory){return{restrict:"A",require:["ngModel"],link:function(scope,elm,attrs,ctrls){var ngModel=ctrls[0];elm.addClass("portal-multistring-edit");var container=angular.element("<div></div>"),input=angular.element("<input></input>"),addButton=angular.element('<button class="btn btn-primary">Pridať</button>');elm.addClass("portal-multistring-edit"),ngModel.$render=function(){var i,xButton,stringElm;container.empty();for(i in ngModel.$modelValue)stringElm=angular.element('<div class="portal-multistring-element"><span>'+ngModel.$modelValue[i]+"</span></div>"),xButton=angular.element('<i class="glyphicon-remove"></i>'),xButton.data("idx",i),xButton.on("click",function(evt){scope.$apply(function(){ngModel.$modelValue.splice(angular.element(evt.target).data("idx"),1),ngModel.$render()})}),stringElm.append(xButton),container.append(stringElm)},elm.append(container),elm.append(input),elm.append(addButton),input.on("change",function(evt){scope.$apply(function(){ngModel.$modelValue.push(input.val()),ngModel.$render(),input.val("")})}),elm.bind("focus",function(evt){input[0].focus()})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetCategoryEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetCategoryEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-category-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<form class="form"><fieldset class="form-group" style="background-color: black; padding: 10px;" ng-show="mode !== \'edit\'"><div style="background-color: white; padding-top: 10px; padding-bottom: 10px;"><div class="form-group row"> <label class="col-sm-2 control-label">Tagy:</label> <div class="col-sm-4"><div class="input-group"><div xpsui-portal-multistring-edit ng-model="data.data.tags"></div></div></div></div><div class="form-group row"> <label class="col-sm-2 control-label">Veľkosť stránky:</label> <div class="col-sm-4"><div class="input-group"><input ng-model="data.data.pageSize"/></div></div></div></div></fieldset></form>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetCategoryView",["xpsui:logging","$compile","$http","$sce","$route","$location",function(log,$compile,$http,$sce,$route,$location){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetCategoryView"},template:'<article ng-repeat="c in model" style="overflow: auto;">			<div><a ng-click="navigate(c.id)" ng-bind-html="makeSafe(c.title)"></a></div>			<img ng-show="c.img.img" ng-src="{{c.img.img}}" style="width: 164px !important; height: 123px !important;float: left;"></img>			<div ng-bind-html="makeSafe(c.abstract)" class="x-portal-widget-category-inner"></div></article><div style=" text-align: right; clear: both;" class="x-portal-widget-category-navigation">	<a ng-click="prevPage()" style=" color: #CB2225; "><i class="fa fa-chevron-left x-portal-widget-gallery-prev-btn"></i></a>	&nbsp;&nbsp;<a ng-click="nextPage()" style=" color: #CB2225; "><i class="fa fa-chevron-right x-portal-widget-gallery-next-btn"></i></a></div>',link:function(scope,elm,attrs,ctrls){function findFirstOfType(obj,type){for(var j=0;j<obj.length;++j)if(obj[j].meta.name===type)return obj[j].data}log.group("portal-widget-category-view Link"),elm.addClass("x-portal-widget-category"),scope.model=[],scope.page=0,scope.numberPerPage=scope.data.data.pageSize,console.log("dsa"),("undefined"==typeof scope.numberPerPage||""==scope.numberPerPage)&&(scope.numberPerPage=20),scope.prevPage=function(){scope.page--,scope.page<0&&(scope.page=0),scope.refreshPage()},scope.nextPage=function(){scope.page++;var totalPages=Math.ceil(1*scope.modelAll.length/(1*scope.numberPerPage));scope.page>=totalPages&&(scope.page=totalPages-1),scope.refreshPage()},scope.refreshPage=function(){scope.model=[];for(var iterateFrom=scope.page*scope.numberPerPage,iterateTo=(scope.page+1)*scope.numberPerPage,iterateTo=iterateTo<scope.modelAll.length?iterateTo:scope.modelAll.length,i=iterateFrom;iterateTo>i;++i)scope.model.push(scope.modelAll[i])},scope.makeSafe=function(str){return"string"==typeof str?$sce.trustAsHtml(str):""},console.log("querying with page size: "+scope.numberPerPage),$http({method:"POST",url:"/portalapi/getByTags",data:{tags:scope.data.data.tags,skip:0,limit:null}}).success(function(data,status,headers,config){if(data&&data.length>0){scope.modelAll=[];for(var i=0;i<data.length;++i)scope.modelAll.push({id:data[i].id,title:findFirstOfType(data[i].data,"title"),"abstract":findFirstOfType(data[i].data,"abstract"),img:findFirstOfType(data[i].data,"image"),img1170:findFirstOfType(data[i].data,"image1170"),video:findFirstOfType(data[i].data,"video"),content:findFirstOfType(data[i].data,"content")});scope.refreshPage(),console.log(scope.modelAll)}}).error(function(err){notificationFactory.error(err)}),scope.navigate=function(aid){$location.path("/portal/edit/"+aid)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetFileListEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetFileListEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-file-list-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-add" ng-click="add();"></i><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<div style="padding-left: 1px;"><div ng-repeat="file in data.data.files" class="psui-wrapper" style="padding: 10px; position: relative;"><div style="position: absolute; right: 5px; top: 10px;"><i class="action-button icon-chevron-left" ng-click="photoLeft($index);"></i><i class="action-button icon-trash" ng-click="photoRemove($index);"></i><i class="action-button icon-chevron-right" ng-click="photoRight($index);"></i></div><div><div xpsui-uploadable-file ng-model="data.data.files[$index]"></div></div></div></div>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},scope.add=function(){scope.data.data.files.push({})},scope.photoLeft=function(idx){if(idx>0){var tmp=scope.data.data.files[idx];scope.data.data.files.splice(idx,1),scope.data.data.files.splice(idx-1,0,tmp)}},scope.photoRight=function(idx){if(idx<scope.data.data.files.length-1){var tmp=scope.data.data.files[idx];scope.data.data.files.splice(idx,1),scope.data.data.files.splice(idx+1,0,tmp)}},scope.photoRemove=function(idx){scope.data.data.files.splice(idx,1)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetFileListView",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetFileListView",index:"="},link:function(scope,elm,attrs,ctrls){log.group("portal-widget-file-list-view Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var content=angular.element('<div style="padding-left: 2px;"><div ng-repeat="file in data.data.files" style="padding: 6px 6px;"><a href="/uploads/get/{{file.fileId}}" target="_blank" ng-click="$event.stopPropagation();" download="{{file.fileName}}">{{file.fileName}}</a></div></div>');elm.append(content),$compile(content)(scope),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetGalleryEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetGalleryEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-gallery-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-add" ng-click="add();"></i><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<div style="padding-left: 1px;"><div ng-repeat="photo in data.data.images" class="psui-wrapper" style="display: inline-block; padding: 0px; position: relative;"><div style="position: absolute; left: 5px; top: 5px;"><i class="action-button icon-chevron-left" ng-click="photoLeft($index);"></i><i class="action-button icon-trash" ng-click="photoRemove($index);"></i><i class="action-button icon-chevron-right" ng-click="photoRight($index);"></i></div><div xpsui-uploadable-image xpsui-imageresizor psui-width="656" psui-height="492" ng-model="photo.img" style="width: 162px !important; height: 123px !important; background-image: url(/img/no_image.jpg); margin:0;"></div></div></div>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},scope.add=function(){scope.data.data.images.push({})},scope.photoLeft=function(idx){if(idx>0){var tmp=scope.data.data.images[idx];scope.data.data.images.splice(idx,1),scope.data.data.images.splice(idx-1,0,tmp)}},scope.photoRight=function(idx){if(idx<scope.data.data.images.length-1){var tmp=scope.data.data.images[idx];scope.data.data.images.splice(idx,1),scope.data.data.images.splice(idx+1,0,tmp)}},scope.photoRemove=function(idx){scope.data.data.images.splice(idx,1)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetGalleryView",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetGalleryView",index:"="},link:function(scope,elm,attrs,ctrls){log.group("portal-widget-gallery-view Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var content=angular.element('<div style="padding-left: 2px;"><div ng-repeat="photo in data.data.images" style="display: inline-block; padding-left: 1px;"><img ng-src="{{photo.img}}" style="width: 162px !important; height: 123px !important; margin:0;" ng-click="show($index);"></img></div></div>'),viewer=angular.element('<div ng-show="viewerVisible" style="z-index: 100; position: fixed; top: 0; height:100%; left:0; width: 100%; display: table;"><div style="display: table-cell; vertical-align: middle; width: 625px; margin-left: auto; margin-right: auto;"><div style="display: block; vertical-align: middle; width: 676px; min-height: 535px; margin-left: auto; margin-right: auto; position: relative; background-color: white; box-shadow: 0 3px 3px gray;"><div ng-repeat="photo in data.data.images" ng-show="visibleIndex == $index" style="display: inline-block; padding-left: 1px; position: absolute; top: 10px; bottom: 10px; left: 10px; right: 10px;"><img ng-src="{{photo.img}}" style="width: 656px !important; height: 492px !important; margin:0;"></img><div style="position: absolute; bottom: 0; left: 0;"><i class="icon-chevron-left" ng-click="photoLeft();"></i> <i class="icon-chevron-right" ng-click="photoRight();"></i></div><div style="position: absolute; bottom: 0; right: 0; font-size: 18px;"><i class="icon-remove" ng-click="close();"></i></div></div></div></div></div>');scope.viewerVisible=!1,scope.visibleIndex=0,scope.show=function(idx){scope.viewerVisible=!0,scope.visibleIndex=idx},scope.close=function(idx){scope.viewerVisible=!1},scope.photoLeft=function(){--scope.visibleIndex,scope.visibleIndex<0&&(scope.visibleIndex=scope.data.data.images.length-1)},scope.photoRight=function(){++scope.visibleIndex,scope.visibleIndex>scope.data.data.images.length-1&&(scope.visibleIndex=0)},elm.append(content),elm.append(viewer),$compile(content)(scope),$compile(viewer)(scope),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetImageEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetImageEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-image-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<div class="psui-wrapper" style="text-align: center;"><div xpsui-uploadable-image="" xpsui-imageresizor="" psui-width="656" psui-height="492" ng-model="data.data.img" style="width: 100% !important; height: 492px !important; background-image: url(https://localhost:3443/img/no_image.jpg); margin:0;" class="xpsui-uploadable-image xpsui-imageresizor"></div></div>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetImageView",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetImageView"},link:function(scope,elm,attrs,ctrls){log.group("portal-widget-image-view Link"),elm.empty(),elm.addClass("x-portal-widget-view");var content=angular.element('<div class="psui-wrapper" style="text-align: center;"><img ng-src="{{data.data.img}}" style="margin:0;"></img></div>');elm.append(content),$compile(content)(scope),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetImage1170Edit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetImage1170Edit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-image1170-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<div class="psui-wrapper" style="text-align: center;"><div xpsui-uploadable-image="" xpsui-imageresizor="" psui-width="1170" psui-height="570" ng-model="data.data.img" style="width: 100% !important; height: 492px !important; background-image: url(https://localhost:3443/img/no_image.jpg); margin:0;" class="xpsui-uploadable-image xpsui-imageresizor"></div></div>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetImage1170View",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetImage1170View"},link:function(scope,elm,attrs,ctrls){log.group("portal-widget-image1170-view Link"),elm.empty(),elm.addClass("x-portal-widget-view");var content=angular.element('<div class="psui-wrapper" style="text-align: center;"><img ng-src="{{data.data.img}}" style="margin:0;"></img></div>');elm.append(content),$compile(content)(scope),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetLinkEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetLinkEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-link-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<form class="form"><fieldset class="form-group" style="background-color: black; padding: 10px;" ng-show="mode !== \'edit\'"><div style="background-color: white; padding-top: 10px; padding-bottom: 10px;"> <div class="form-group row">  <label class="col-sm-2 control-label">URL:</label>  <div class="col-sm-4"><div class="input-group"><input ng-model="data.data.href"/></div></div> </div> <div class="form-group row">  <label class="col-sm-2 control-label">Title:</label>  <div class="col-sm-4"><div class="input-group"><input ng-model="data.data.title"/></div></div> </div> <div class="form-group row">  <label class="col-sm-2 control-label">Otvoriť v novom okne:</label>  <div class="col-sm-4"><div class="input-group"><input ng-model="data.data.newWindow" type="checkbox" /></div></div> </div></div></fieldset></form>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetLinkView",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetLinkView"},link:function(scope,elm,attrs,ctrls){log.group("portal-widget-link-view Link"),elm.empty(),elm.addClass("x-portal-widget-view");var target=scope.data.data.newWindow?' target="_blank" ':" ",content=angular.element('<div class="psui-wrapper" style="text-align: left; padding: 10px;"><a href="{{data.data.href|httpPrefixed}}" '+target+" >{{data.data.title}}</a></div>");elm.append(content),$compile(content)(scope),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetMatchResultsEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetMatchResultsEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-match-results-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element(scope.data.meta.element);content.attr("ng-model","data.data"),content.attr("xpsui-contenteditable","false"),elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetMatchResultsView",["xpsui:logging","$compile","$sce",function(log,$compile,$sce){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetMatchResultsView"},link:function(scope,elm,attrs,ctrls){log.group("portal-widget-match-results-view Link"),elm.empty(),elm.addClass("x-portal-widget-view");var content=angular.element(scope.data.meta.element);content.attr("ng-bind-html","makeSafe(data.data);"),elm.append(content),$compile(content)(scope),log.groupEnd(),scope.makeSafe=function(str){return"string"==typeof str?$sce.trustAsHtml(str):""}}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetMatchStandingsEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetMatchStandingsEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-match-standings-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element(scope.data.meta.element);content.attr("ng-model","data.data"),content.attr("xpsui-contenteditable","false"),elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetMatchStandingsView",["xpsui:logging","$compile","$sce",function(log,$compile,$sce){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetMatchStandingsView"},link:function(scope,elm,attrs,ctrls){log.group("portal-widget-match-standings-view Link"),elm.empty(),elm.addClass("x-portal-widget-view");var content=angular.element(scope.data.meta.element);content.attr("ng-bind-html","makeSafe(data.data);"),elm.append(content),$compile(content)(scope),log.groupEnd(),scope.makeSafe=function(str){return"string"==typeof str?$sce.trustAsHtml(str):""}}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetOverviewEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetOverviewEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-Overview-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<form class="form"><fieldset class="form-group" style="background-color: black; padding: 10px;" ng-show="mode !== \'edit\'"><div style="background-color: white; padding-top: 10px; padding-bottom: 10px;"><div class="form-group row"> <label class="col-sm-2 control-label">Tagy:</label> <div class="col-sm-4"><div class="input-group"><div xpsui-portal-multistring-edit ng-model="data.data.tags"></div></div></div></div><div class="form-group row"> <label class="col-sm-2 control-label">Veľkosť stránky:</label> <div class="col-sm-4"><div class="input-group"><input ng-model="data.data.pageSize"/></div></div></div></div></fieldset></form>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetOverviewView",["xpsui:logging","$compile","$http","$sce","$route","$location",function(log,$compile,$http,$sce,$route,$location){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetOverviewView"},template:'<article ng-repeat="c in model" style="overflow: auto;">			<div><a ng-click="navigate(c.id)" ng-bind-html="makeSafe(c.title)"></a></div>			<img ng-show="c.img.img" ng-src="{{c.img.img}}" style="width: 164px !important; height: 123px !important;float: left;"></img>			<div ng-bind-html="makeSafe(c.abstract)" class="x-portal-widget-overview-inner"></div></article><div style=" text-align: right; clear: both;" class="x-portal-widget-overview-navigation">	<a ng-click="prevPage()" style=" color: #CB2225; "><i class="fa fa-chevron-left x-portal-widget-gallery-prev-btn"></i></a>	&nbsp;&nbsp;<a ng-click="nextPage()" style=" color: #CB2225; "><i class="fa fa-chevron-right x-portal-widget-gallery-next-btn"></i></a></div>',link:function(scope,elm,attrs,ctrls){function findFirstOfType(obj,type){for(var j=0;j<obj.length;++j)if(obj[j].meta.name===type)return obj[j].data}log.group("portal-widget-overview-view Link"),elm.addClass("x-portal-widget-overview"),scope.model=[],scope.page=0,scope.numberPerPage=scope.data.data.pageSize,console.log("dsa"),("undefined"==typeof scope.numberPerPage||""==scope.numberPerPage)&&(scope.numberPerPage=20),scope.prevPage=function(){scope.page--,scope.page<0&&(scope.page=0),scope.refreshPage()},scope.nextPage=function(){scope.page++;var totalPages=Math.ceil(1*scope.modelAll.length/(1*scope.numberPerPage));scope.page>=totalPages&&(scope.page=totalPages-1),scope.refreshPage()},scope.refreshPage=function(){scope.model=[];for(var iterateFrom=scope.page*scope.numberPerPage,iterateTo=(scope.page+1)*scope.numberPerPage,iterateTo=iterateTo<scope.modelAll.length?iterateTo:scope.modelAll.length,i=iterateFrom;iterateTo>i;++i)scope.model.push(scope.modelAll[i]);
},scope.makeSafe=function(str){return"string"==typeof str?$sce.trustAsHtml(str):""},console.log("querying with page size: "+scope.numberPerPage),$http({method:"POST",url:"/portalapi/getByTags",data:{tags:scope.data.data.tags,skip:0,limit:null}}).success(function(data,status,headers,config){if(data&&data.length>0){scope.modelAll=[];for(var i=0;i<data.length;++i)scope.modelAll.push({id:data[i].id,title:findFirstOfType(data[i].data,"title"),"abstract":findFirstOfType(data[i].data,"abstract"),img:findFirstOfType(data[i].data,"image"),img1170:findFirstOfType(data[i].data,"image1170"),video:findFirstOfType(data[i].data,"video"),content:findFirstOfType(data[i].data,"content")});scope.refreshPage(),console.log(scope.modelAll)}}).error(function(err){notificationFactory.error(err)}),scope.navigate=function(aid){$location.path("/portal/edit/"+aid)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetPureHtmlEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetPureHtmlEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-pure-html-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<div style="background-color: black; padding: 10px;"></div>'),contentInner=angular.element(scope.data.meta.element);contentInner.attr("ng-model","data.data"),contentInner.attr("xpsui-contenteditable","true"),content.append(contentInner),content.append('<div style="background-color: white; padding: 2px;">CSS Class: <input ng-model="data.css.cssClass"/></div>'),elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetPureHtmlView",["xpsui:logging","$compile","$sce",function(log,$compile,$sce){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetPureHtmlView"},link:function(scope,elm,attrs,ctrls){log.group("portal-widget-pure-html-view Link"),elm.empty(),elm.addClass("x-portal-widget-view");var content=angular.element(scope.data.meta.element);content.attr("ng-bind-html","makeSafe(data.data);"),elm.append(content),$compile(content)(scope),log.groupEnd(),scope.makeSafe=function(str){return"string"==typeof str?$sce.trustAsHtml(str):""}}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetRankingEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetRankingEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-file-list-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-add" ng-click="add();"></i><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<div style="padding-left: 1px;"><div ng-repeat="file in data.data.results" class="psui-wrapper" style="padding: 10px; position: relative;"><div style="position: absolute; right: 5px; top: 10px;"><i class="action-button icon-chevron-left" ng-click="photoLeft($index);"></i><i class="action-button icon-trash" ng-click="photoRemove($index);"></i><i class="action-button icon-chevron-right" ng-click="photoRight($index);"></i></div><div>Meno: <input ng-model="data.data.results[$index].name"/>	Krajina: <input ng-model="data.data.results[$index].country"/><br/>	Body: <input ng-model="data.data.results[$index].points"/>	Percenta: <input ng-model="data.data.results[$index].percent"/></div></div></div>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},scope.add=function(){scope.data.data.results.push({})},scope.photoLeft=function(idx){if(idx>0){var tmp=scope.data.data.results[idx];scope.data.data.results.splice(idx,1),scope.data.data.results.splice(idx-1,0,tmp)}},scope.photoRight=function(idx){if(idx<scope.data.data.results.length-1){var tmp=scope.data.data.results[idx];scope.data.data.results.splice(idx,1),scope.data.data.results.splice(idx+1,0,tmp)}},scope.photoRemove=function(idx){scope.data.data.results.splice(idx,1)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetRankingView",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetRankingView",index:"="},link:function(scope,elm,attrs,ctrls){log.group("portal-widget-file-list-view Link"),elm.empty(),elm.addClass("x-portal-widget-edit"),elm.addClass("portal-article-ranking");var content=angular.element('<div class="portal-content-title"></div><div style="padding-left: 2px;" class="ranking"><div class="portal-content-actual-ranking"><div ng-repeat="result in data.data.results" class="actual-ranking-riders-items"><div class="rider-name">{{$index+1}}. {{result.name}}</div><div class="rider-country">({{result.country}})</div><div class="rider-points">({{result.points}})</div><div class="rider-graph" style=" width: {{result.percent}}%; "></div></div></div></div>');elm.append(content),$compile(content)(scope),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetShowcaseEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetShowcaseEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-category-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<form class="form"><fieldset class="form-group" style="background-color: black; padding: 10px;" ng-show="mode !== \'edit\'"><div style="background-color: white; padding-top: 10px; padding-bottom: 10px;"><div class="form-group row"> <label class="col-sm-2 control-label">Tagy:</label> <div class="col-sm-4"><div class="input-group"><div xpsui-portal-multistring-edit ng-model="data.data.tags"></div></div></div></div><div class="form-group row"> <label class="col-sm-2 control-label">CSS Classes:</label> <div class="col-sm-4"><input ng-model="data.css.cssClass"/></div></div></div></fieldset></form>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetShowcaseView",["xpsui:logging","$compile","$http","$sce","$route","$interval","$location",function(log,$compile,$http,$sce,$route,$interval,$location){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetShowcaseView"},template:'<div class="portal-content-title"></div><div class="portal-content-container" style=" margin-left: {{marginLeft}}px; "><article ng-repeat="c in model" ng-show="visibleIndex == $index || visibleIndex == \'no\'"><div class="x-portal-widget-showcase-diamond only-location"><div class="x-portal-widget-showcase-diamond-inner"></div></div><div class="only-riderszone" style="background: #b9b9b9; -webkit-clip-path: polygon(0px 110px, 110px 0px, 220px 110px, 110px 220px); position: absolute; width: 220px; height: 220px; margin-left: -15px; margin-top: -15px;"></div><div class="only-riderszone" style="background: url(\'{{ c.img.img }}\'); background-size: cover; background-repeat: no-repeat; ; -webkit-clip-path: polygon(0px 95px, 95px 0px, 190px 95px, 95px 190px); width: 190px; height: 190px; "></div><div ng-show="c.img.img" class="x-portal-widget-showcase-image" style="background: url(\'{{c.img.img}}\'); background-repeat: no-repeat; background-size: cover; height: 492px; width: 100%;"></div><div ng-show="c.img.img" class="x-portal-widget-showcase-textblock"><a ng-click="navigate(c.id)" ng-bind-html="makeSafe(c.title)"></a><div ng-bind-html="makeSafe(c.abstract)"></div></div><div ng-show="c.img1170.img" style="background: url(\'{{c.img1170.img}}\'); background-repeat: no-repeat; background-size: cover; height: 570px; width: 100%;"></div><div ng-show="c.img1170.img" class="x-portal-widget-showcase-textblock"><a ng-click="navigate(c.id)" ng-bind-html="makeSafe(c.title)"></a></div></article></div><div class="portal-content-navigation"><i class="fa fa-caret-left fa-2x" ng-click="moveLeft()"></i> <i class="fa fa-caret-right fa-2x" ng-click="moveRight()"></i></div>',link:function(scope,elm,attrs,ctrls){function findFirstOfType(obj,type){for(var j=0;j<obj.length;++j)if(obj[j].meta.name===type)return obj[j].data}log.group("portal-widget-category-view Link"),elm.addClass("x-portal-widget-showcase"),scope.model=[],scope.visibleIndex=0,scope.marginLeft=0,scope.moveLeft=function(){scope.marginLeft=scope.marginLeft+100},scope.moveRight=function(){scope.marginLeft=scope.marginLeft-100},elm.css("height","492px"),attrs["class"].indexOf("portal-content-location")<0&&attrs["class"].indexOf("portal-content-riderszone")<0&&attrs["class"].indexOf("portal-content-mediazone")<0?$interval(function(){++scope.visibleIndex,scope.visibleIndex>=scope.model.length&&(scope.visibleIndex=0)},5e3):scope.visibleIndex="no",scope.makeSafe=function(str){return"string"==typeof str?$sce.trustAsHtml(str):""},$http({method:"POST",url:"/portalapi/getByTags",data:{tags:scope.data.data.tags}}).success(function(data,status,headers,config){if(data&&data.length>0){scope.model=[];for(var i=0;i<data.length;++i)scope.model.push({id:data[i].id,title:findFirstOfType(data[i].data,"title"),"abstract":findFirstOfType(data[i].data,"abstract"),img:findFirstOfType(data[i].data,"image"),img1170:findFirstOfType(data[i].data,"image1170"),video:findFirstOfType(data[i].data,"video"),content:findFirstOfType(data[i].data,"content")}),findFirstOfType(data[i].data,"image1170")&&elm.css("height","570px");console.log(scope.model)}}).error(function(err){notificationFactory.error(err)}),scope.navigate=function(aid){$location.path("/portal/edit/"+aid)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetShowcasevideoEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetShowcasevideoEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-category-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<form class="form"><fieldset class="form-group" style="background-color: black; padding: 10px;" ng-show="mode !== \'edit\'"><div style="background-color: white; padding-top: 10px; padding-bottom: 10px;"><div class="form-group row"> <label class="col-sm-2 control-label">Tagy:</label> <div class="col-sm-4"><div class="input-group"><div xpsui-portal-multistring-edit ng-model="data.data.tags"></div></div></div></div><div class="form-group row"> <label class="col-sm-2 control-label">CSS Classes:</label> <div class="col-sm-4"><input ng-model="data.css.cssClass"/></div></div></div></fieldset></form>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetShowcasevideoView",["xpsui:logging","$compile","$http","$sce","$route","$interval","$location",function(log,$compile,$http,$sce,$route,$interval,$location){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetShowcasevideoView"},link:function(scope,elm,attrs,ctrls){function findFirstOfType(obj,type){for(var j=0;j<obj.length;++j)if(obj[j].meta.name===type)return obj[j].data}log.group("portal-widget-category-view Link"),elm.addClass("x-portal-widget-showcasevideo"),scope.model=[],scope.visibleIndex=0,elm.css("height","492px"),$interval(function(){++scope.visibleIndex,scope.visibleIndex>=scope.model.length&&(scope.visibleIndex=0)},5e3),scope.makeSafe=function(str){return"string"==typeof str?$sce.trustAsHtml(str):""},$http({method:"POST",url:"/portalapi/getByTags",data:{tags:scope.data.data.tags}}).success(function(data,status,headers,config){if(data&&data.length>0){scope.model=[];for(var i=0;i<data.length;++i)scope.model.push({id:data[i].id,title:findFirstOfType(data[i].data,"title"),"abstract":findFirstOfType(data[i].data,"abstract"),img:findFirstOfType(data[i].data,"image"),video:findFirstOfType(data[i].data,"video"),img1170:findFirstOfType(data[i].data,"image1170"),content:findFirstOfType(data[i].data,"content")});elm.empty(),elm.append('<div class="portal-content-title"></div>');for(var i=0;i<scope.model.length;i++){var article=angular.element('<article ng-show="visibleIndex == '+i+'"></article>'),item=angular.element('<iframe width="560" height="315" src="'+scope.model[i].video.src+'" frameborder="0" allowfullscreen></iframe><div class="x-portal-widget-showcasevideo-textblock"><a ng-click="aler(10);navigate(\''+scope.model[i].id+"')\" >"+scope.model[i].video.title+"</a><div >"+scope.model[i].video.subTitle+"</div></div>");article.append(item),elm.append(article),$compile(article)(scope)}console.log(scope.model)}}).error(function(err){notificationFactory.error(err)}),scope.navigate=function(aid){$location.path("/portal/edit/"+aid)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetVideoEdit",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetVideoEdit",index:"="},require:["^xpsuiPortalArticleContentEdit"],link:function(scope,elm,attrs,ctrls){log.group("portal-widget-video-edit Link"),elm.empty(),elm.addClass("x-portal-widget-edit");var titleBar=angular.element('<div class="xpsui-portal-widget-title-bar">{{data.meta.type}}:{{data.meta.name}}<div class="pull-right"><i class="action-button icon-chevron-up" ng-click="moveUp();"></i><i class="action-button icon-chevron-down" ng-click="moveDown();"></i><i class="action-button icon-trash" ng-click="remove();"></i></div></div>'),content=angular.element('<form class="form"><fieldset class="form-group" style="background-color: black; padding: 10px;" ng-show="mode !== \'edit\'"><div style="background-color: white; padding-top: 10px; padding-bottom: 10px;"> <div class="form-group row">  <label class="col-sm-2 control-label">Video embed URL:</label>  <div class="col-sm-4"><div class="input-group"><input ng-model="data.data.src"/></div></div> </div> <div class="form-group row">  <label class="col-sm-2 control-label">Title:</label>  <div class="col-sm-4"><div class="input-group"><input ng-model="data.data.title"/></div></div> </div> <div class="form-group row">  <label class="col-sm-2 control-label">Subtitle:</label>  <div class="col-sm-4"><div class="input-group"><input ng-model="data.data.subTitle" /></div></div> </div> <div class="form-group row">  <label class="col-sm-2 control-label">Text:</label>  <div class="col-sm-4"><div class="input-group"><section class="content" xpsui-contenteditable="true" ng-model="data.data.text"></section></div></div> </div></div></fieldset></form>');elm.append(titleBar),elm.append(content),$compile(titleBar)(scope),$compile(content)(scope),scope.moveUp=function(){ctrls[0].moveUp(scope.index)},scope.moveDown=function(){ctrls[0].moveDown(scope.index)},scope.remove=function(){ctrls[0].remove(scope.index)},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalWidgetVideoView",["xpsui:logging","$compile",function(log,$compile){return{restrict:"A",scope:{data:"=xpsuiPortalWidgetVideoView"},link:function(scope,elm,attrs,ctrls){log.group("portal-widget-video-view Link"),elm.empty(),elm.addClass("x-portal-widget-view");var content=angular.element('<div class="psui-wrapper" style="text-align: center;">  <iframe width="560" height="315" src="'+scope.data.data.src+'" frameborder="0" allowfullscreen></iframe>  <h3>{{data.data.title}}</h3>  <h3>{{data.data.subTitle}}</h3>'+scope.data.data.text+"</div>");elm.append(content),$compile(content)(scope),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiRecordAction",["xpsui:logging","xpsui:SchemaUtil","$parse","$injector","xpsui:NavigationService",function(log,schemaUtil,$parse,$injector,navS){return{restrict:"A",link:function(scope,elm,attrs,ctrls){log.group("Record Action");var schemaParser=$parse(attrs.xpsuiSchema),modelParser=$parse(attrs.xpsuiModel);elm.addClass("x-control"),elm.addClass("x-record-action"),elm.on("click",function(evt){var schemaFragment=schemaParser(scope),modelFragment=modelParser(scope),ctx={schema:schemaFragment,model:modelFragment};$injector.invoke(["xpsui:NavigationService","$interpolate","$location",function(navS,$interpolate,$location){return function(ctx){var navPath=$interpolate(ctx.schema.params.path)(ctx);navS.navigateToPath(navPath),attrs.$set("href","/#"+navPath)}}])(ctx),scope.$apply()}),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiRequired",["xpsui:logging","xpsui:FormGenerator","$compile",function(log,formGenerator,$compile){return{restrict:"A",link:function(scope,elm,attrs,ctrls){log.group("Required Link");var modelPath=attrs.xpsuiModel,schemaPath=attrs.xpsuiSchema;if(elm.addClass("x-inlineedit"),!modelPath||!schemaPath)return log.warn("Attributes xpsui-model and xpsui-schema have to be set, skipping inlineedit generation"),void log.groupEnd();var schema=scope.$eval(schemaPath),viewElm=(attrs.xpsuiInlineedit,formGenerator.generateField(schema,schemaPath,modelPath,formGenerator.MODE.VIEW)),editElm=formGenerator.generateField(schema,schemaPath,modelPath,formGenerator.MODE.EDIT);$compile(viewElm)(scope),$compile(editElm)(scope),elm.append(viewElm),elm.append(editElm),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiSelectEdit",["xpsui:logging","$parse","xpsui:DropdownFactory","xpsui:SelectboxFactory","xpsui:SelectDataFactory","$timeout","xpsui:RemoveButtonFactory",function(log,$parse,dropdownFactory,selectboxFactory,datafactory,$timeout,removeButtonFactory){return{restrict:"A",require:["ngModel","?^xpsuiFormControl","xpsuiSelectEdit"],controller:function($scope,$element,$attrs){this.setup=function(){this.$input=angular.element("<input></input>"),this.$input.addClass("x-input")},this.getInput=function(){return this.$input},this.$input=null,this.setup()},link:function(scope,elm,attrs,ctrls){log.group("Select edit Link");var ngModel=ctrls[0],formControl=ctrls[1]||{},selfControl=ctrls[2],input=selfControl.getInput(),parseSchemaFragment=$parse(attrs.xpsuiSchema),schemaFragment=parseSchemaFragment(scope);elm.addClass("x-control"),elm.addClass("x-select-edit"),elm.append(input),input.on("change",function(evt){scope.$apply(function(){ngModel.$setViewValue(input.val())})}),elm.bind("focus",function(evt){input[0].focus()});var dropdown=dropdownFactory.create(elm,{titleTransCode:schemaFragment.transCode});dropdown.setInput(selfControl.getInput()).render();var removeButton=removeButtonFactory.create(elm,{enabled:!schemaFragment.required,input:input,onClear:function(){input.val(""),scope.$apply(function(){ngModel.$setViewValue("")})}}),selectbox=selectboxFactory.create(elm,{onSelected:function(value){input.val(value.v),scope.$apply(function(){ngModel.$setViewValue(value.k?value.k:value.v),removeButton.show()})}});selectbox.setInput(selfControl.getInput()),selectbox.setDropdown(dropdown);var dataset=datafactory.createArrayDataset(schemaFragment["enum"],schemaFragment.enumTransCodes);selectbox.setDataset(dataset),ngModel.$render=function(){input.val(dataset.store.getValueByKey(ngModel.$viewValue)||ngModel.$viewValue||""),formControl.oldValue=ngModel.$modelValue},log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiSelectView",["xpsui:logging","$translate","xpsui:SelectDataFactory",function(log,$translate,datafactory){return{restrict:"A",require:["^ngModel"],link:function(scope,elm,attrs,ctrls){var schemaFragment=null;if(elm.addClass("x-select-view"),attrs.xpsuiSchema){schemaFragment=scope.$eval(attrs.xpsuiSchema);var dataset=datafactory.createArrayDataset(schemaFragment["enum"],schemaFragment.enumTransCodes);if(!schemaFragment["enum"])throw"Schema fragment does not contain enum field"}var ngModel=ctrls[0];ngModel.$render=function(){ngModel.$viewValue?elm.text(dataset.store.getValueByKey(ngModel.$viewValue)||ngModel.$viewValue||""):elm.text("")}}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiStringEdit",["xpsui:logging",function(log){return{restrict:"A",require:["ngModel","?^xpsuiFormControl","xpsuiStringEdit"],controller:function($scope,$element,$attrs){this.setup=function(){this.$input=angular.element("<input></input>")},this.getInput=function(){return this.$input},this.$input=null,this.setup()},link:function(scope,elm,attrs,ctrls){log.group("String edit Link");var ngModel=ctrls[0],formControl=ctrls[1]||{},selfControl=ctrls[2]||{},input=selfControl.getInput();elm.addClass("x-control"),elm.addClass("x-string-edit"),ngModel.$render=function(){input.val(ngModel.$viewValue||""),formControl.oldValue=ngModel.$modelValue},elm.append(input),input.on("keyup",function(evt){scope.$apply(function(){ngModel.$setViewValue(input.val())})}),elm.bind("focus",function(evt){input[0].focus()}),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiStringView",["xpsui:logging",function(log){return{restrict:"A",require:["ngModel"],link:function(scope,elm,attrs,ctrls){log.group("String view Link");var ngModel=ctrls[0],view=angular.element("<div></div>");elm.addClass("x-control"),elm.addClass("x-string-view"),ngModel.$render=function(){ngModel&&ngModel.$viewValue||0===ngModel.$viewValue?isNaN(ngModel.$viewValue)&&ngModel.$viewValue.replace?view.html(ngModel.$viewValue.replace(/(?:\r\n|\r|\n)/g,"<br />")):view.html(ngModel.$viewValue):view.text(" ")},elm.append(view),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiTextareaEdit",["xpsui:logging",function(log){return{restrict:"A",require:["ngModel","?^xpsuiFormControl","xpsuiTextareaEdit"],controller:function($scope,$element,$attrs){this.setup=function(){this.$input=angular.element("<textarea></textarea>")},this.getInput=function(){return this.$input},this.$input=null,this.setup()},link:function(scope,elm,attrs,ctrls){log.group("String edit Link");var ngModel=ctrls[0],formControl=ctrls[1]||{},selfControl=ctrls[2]||{},input=selfControl.getInput();elm.addClass("x-control"),elm.addClass("x-string-edit"),ngModel.$render=function(){input.val(ngModel.$viewValue||""),formControl.oldValue=ngModel.$modelValue},elm.append(input),input.on("change",function(evt){scope.$apply(function(){ngModel.$setViewValue(input.val())})}),elm.bind("focus",function(evt){input[0].focus()}),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiTextareaEdit",["xpsui:logging",function(log){return{restrict:"A",require:["ngModel"],link:function(scope,elm,attrs,ctrls){log.group("String view Link");var ngModel=ctrls[0],view=angular.element("<div></div>");elm.addClass("x-control"),elm.addClass("x-string-view"),ngModel.$render=function(){ngModel.$viewValue?view.html(ngModel.$viewValue.replace(/(?:\r\n|\r|\n)/g,"<br />")):view.text(" ")},elm.append(view),log.groupEnd()}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiUnique",["$http","xpsui:SchemaUtil","xpsui:QueryFilter",function($http,schemaUtilFactory,QueryFilter){var latestId=0;return{restrict:"A",require:["?ngModel"],link:function(scope,element,attrs,controllers){var ngModel=controllers[0],options=scope.$eval(attrs.xpsuiUnique);ngModel&&ngModel.$parsers.push(function(value){function containEqualId(ngModelStr,id){var model=scope.$eval(ngModelStr);if("object"==typeof model&&model.id&&id===model.id)return!0;var pos=ngModelStr.lastIndexOf(".");return-1!==pos?containEqualId(ngModelStr.substr(0,pos),id):!1}function factory(ver){return function(data){ver===latestId&&(data.data&&data.data.length&&data.data.length>0&&!containEqualId(attrs.ngModel,data.data[0].id)?ngModel.$setValidity("psuiUnique",!1):ngModel.$setValidity("psuiUnique",!0))}}var qf=QueryFilter.create().addCriterium(options.field,QueryFilter.operation.EQUAL,value).setLimit(1),conf={method:"POST",url:"/search/"+schemaUtilFactory.encodeUri(schemaUtilFactory.concatUri(options.schema,"search")),data:qf};return $http(conf).then(factory(++latestId)),value})}}}])}(window.angular),function(angular){"use strict";function getContentType(fileName){var ext=fileName.substring(fileName.lastIndexOf("."));return contentTypes[ext?ext.toLowerCase():"application/binary"]}var contentTypes={".pdf":"application/pdf",".xls":"application/vnd.ms-excel",".doc":"application/msword",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".ppt":"application/vnd.ms-powerpoint",".odt":"application/vnd.oasis.opendocument.text",".bin":"application/octet-stream",".bmp":"image/bmp",".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".csv":"text/csv",".zip":"application/zip"};angular.module("xpsui:directives").directive("xpsuiUploadableFile",["xpsui:FileUploadFactory","xpsui:NotificationFactory","$compile","$translate",function(psFileUploadFactory,notificationFactory,$compile,$translate){return{restrict:"A",require:["?ngModel","xpsuiUploadableFile"],scope:!0,controller:function(){this.srcElm=null,this.imageProcessed=function(blob){}},link:function(scope,elm,attrs,ctrls){function getReadableFileSizeString(fileSizeInBytes){var i=-1,byteUnits=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do fileSizeInBytes/=1024,i++;while(fileSizeInBytes>1024);return Math.max(fileSizeInBytes,.1).toFixed(1)+byteUnits[i]}var fileButton=angular.element('<input type="file" style="display: none;"></input>'),chooseFileButton=angular.element('<button class="btn-primary"><icon class="icon-open"></icon> '+$translate.instant("generic.file.choose")+"</button>");elm.append(fileButton),elm.append(chooseFileButton),chooseFileButton.on("click",function(evt){fileButton[0].files[0]="",fileButton[0].value="",fileButton[0].click()});var commit=function(){},imgCtrl=ctrls[1];fileButton.on("change",function(evt){var file=fileButton[0].files[0];if(file)if(imgCtrl&&imgCtrl.srcElm){var urlObject;urlObject="undefined"!=typeof webkitURL?webkitURL:URL,imgCtrl.srcElm.src=urlObject.createObjectURL(file),imgCtrl.imageProcessed=function(blob){var uploader=new psFileUploadFactory.FileUploader(scope,blob,getContentType(file.name),"/uploads/putgetpath/");uploader.upload(function(err,path){err&&notificationFactory.error($translate.instant("generic.file.uploadFailed")),elm.css("background-image","url(/photos/get/"+path+")"),commit({fileId:path,fileName:file.name,size:file.size,contentType:getContentType(file.name)})})}}else{var uploader=new psFileUploadFactory.FileUploader(scope,file,getContentType(file.name),"/uploads/putgetpath/");uploader.upload(function(err,path){return err?(notificationFactory.error($translate.instant("generic.file.uploadFailed")),scope.$apply(function(){}),!0):void commit({fileId:path,fileName:file.name,size:file.size,contentType:getContentType(file.name)})})}});var ngModel=ctrls[0];ngModel&&(ngModel.$render=function(){ngModel.$viewValue&&ngModel.$viewValue.fileName&&(elm.html('<div class="psui-attachment-name"> <a href="/uploads/get/'+ngModel.$viewValue.fileId+'" target="_blank"         class="psui-attachment-link fa fa-save" download="'+ngModel.$viewValue.fileName+'"> '+ngModel.$viewValue.fileName+"</a> <span>"+ngModel.$viewValue.fileName+"</span> <em>("+getReadableFileSizeString(ngModel.$viewValue.size)+")</em></div>"),$compile(elm.contents())(scope),elm.find("a").on("click",function(evt){return evt.stopPropagation(),!1}))},commit=function(val){scope.$apply(function(){ngModel.$setViewValue(val)})})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiUploadableImageView",["xpsui:NotificationFactory",function(notificationFactory){return{restrict:"A",require:["?ngModel"],scope:!0,controller:function(){},link:function(scope,elm,attrs,ctrls){var imgHeight=(attrs.psuiWidth||0,attrs.psuiHeight||0);elm.attr("style",imgHeight?"height:"+imgHeight+"px !important;":""),elm.addClass("xpsui-uploadable-image-view");var ngModel=ctrls[0];ngModel&&(ngModel.$render=function(){elm.css("background-image","url("+(ngModel.$viewValue||"img/no_photo.jpg")+")")})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiUploadableImage",["xpsui:FileUploadFactory","xpsui:NotificationFactory",function(psFileUploadFactory,notificationFactory){return{restrict:"A",require:["?ngModel","xpsuiUploadableImage"],scope:!0,controller:function(){this.srcElm=null,this.imageProcessed=function(blob){}},link:function(scope,elm,attrs,ctrls){var fileButton=angular.element('<input type="file"></input>'),imgHeight=(attrs.psuiWidth||0,attrs.psuiHeight||0);attrs.hasOwnProperty("style")||elm.attr("style",imgHeight?"height:"+imgHeight+"px !important;":""),elm.addClass("xpsui-uploadable-image"),elm.append(fileButton),fileButton.addClass("xpsui-uploadable-image-fbutton"),elm.on("click",function(evt){fileButton[0].files[0]="",fileButton[0].value="",fileButton[0].click()});var commit=function(){},imgCtrl=ctrls[1];fileButton.on("change",function(evt){var file=fileButton[0].files[0];if(file)if("image/jpeg"!==file.type)notificationFactory.error({translationCode:"psui.uploadable.image.unsupported.image.type"}),scope.$apply(function(){});else if(imgCtrl&&imgCtrl.srcElm){var urlObject;urlObject="undefined"!=typeof webkitURL?webkitURL:URL,
imgCtrl.srcElm.src=urlObject.createObjectURL(file),imgCtrl.imageProcessed=function(blob){var uploader=new psFileUploadFactory.FileUploader(scope,blob,"image/jpeg","/photos/putgetpath/");uploader.upload(function(err,path){err&&notificationFactory.error(err),elm.css("background-image","url(/photos/get/"+path+")"),commit("/photos/get/"+path)})}}else{var uploader=new psFileUploadFactory.FileUploader(scope,file,file.type,"/photos/putgetpath/");uploader.upload(function(err,path){err&&notificationFactory.error(err),elm.css("background-image","url(/photos/get/"+path+")"),commit("/photos/get/"+path)})}});var ngModel=ctrls[0];ngModel&&(ngModel.$render=function(){elm.css("background-image","url("+(ngModel.$viewValue||"img/no_photo.jpg")+")")},commit=function(val){scope.$apply(function(){ngModel.$setViewValue(val)})})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiValidityMark",["$compile",function($compile){return{restrict:"A",require:["^ngModel","^form","^?xpsuiInlineedit"],link:function(scope,elm,attrs,controller){var wrapper=elm,ngModel=null;controller[0]&&(ngModel=controller[0]);var inlineEditCtrl=controller[2],validationMark=angular.element('<span class="xpsui-btn xpsui-validation-mark"><i></i><span>error</span></span>');validationMark.addClass("x-hidden"),wrapper.prepend(validationMark);var errors=angular.element('<div class="xpsui-errors"><div>');if(errors.addClass("x-hidden"),validationMark.append(errors),validationMark.on("mouseover",function(evt){errors.removeClass("x-hidden")}),validationMark.on("mouseleave",function(evt){errors.addClass("x-hidden")}),validationMark.on("touchstart",function(evt){return errors.removeClass("x-hidden"),evt.preventDefault(),!1}),validationMark.on("touchend",function(evt){return errors.addClass("x-hidden"),evt.preventDefault(),!1}),ngModel&&(scope.$watch(function(scope){return ngModel.$invalid},function(nv,ov){nv?(validationMark.addClass("ng-invalid"),validationMark.removeClass("x-hidden"),inlineEditCtrl&&inlineEditCtrl.hideCommitButton()):(validationMark.removeClass("ng-invalid"),validationMark.addClass("x-hidden"),inlineEditCtrl&&inlineEditCtrl.showCommitButton())}),scope.$watch(function(scope){return ngModel.$pristine},function(nv,ov){nv?validationMark.addClass("ng-pristine"):validationMark.removeClass("ng-pristine")}),scope.$watchCollection(function(scope){return ngModel.$error},function(nv,ov){var e;errors.empty();for(e in nv)nv[e]&&errors.append('<div class="xpsui-error">{{\'errors.validation.'+e+"'|translate}}</div>");$compile(errors)(scope)})),controller[1]){var form=controller[1];scope.$watch(function(){return form.xpsui.submitPrepare},function(newVal){if(newVal===!0){var ngVal=ngModel.$modelValue;angular.isObject(ngVal)&&0==Object.getOwnPropertyNames(ngVal).length?ngModel.$setViewValue(""):ngModel.$setViewValue(ngModel.$modelValue)}})}}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:directives").directive("xpsuiPortalMultistringEdit",["xpsui:logging","$parse","xpsui:DropdownFactory","xpsui:SelectboxFactory","xpsui:SelectDataFactory",function(log,$parse,dropdownFactory,selectboxFactory,datafactory){return{restrict:"A",require:["ngModel"],link:function(scope,elm,attrs,ctrls){var ngModel=ctrls[0];elm.addClass("portal-multistring-edit");var container=angular.element("<div></div>"),input=angular.element("<input></input>"),addButton=angular.element('<button class="btn btn-primary">Pridať</button>');elm.addClass("portal-multistring-edit"),ngModel.$render=function(){var i,xButton,stringElm;container.empty();for(i in ngModel.$modelValue)stringElm=angular.element('<div class="portal-multistring-element"><span>'+ngModel.$modelValue[i]+"</span></div>"),xButton=angular.element('<i class="icon-remove"></i>'),xButton.data("idx",i),xButton.on("click",function(evt){scope.$apply(function(){ngModel.$modelValue.splice(angular.element(evt.target).data("idx"),1),ngModel.$render()})}),stringElm.append(xButton),container.append(stringElm)},elm.append(container),elm.append(input),elm.append(addButton),input.on("change",function(evt){scope.$apply(function(){ngModel.$modelValue.push(input.val()),ngModel.$render(),input.val("")})}),elm.bind("focus",function(evt){input[0].focus()})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers",["xpsui:services"])}(angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:DashboardCtrl",["$scope","$location",function($scope,$location){}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:HelpPageCtrl",["$scope",function($scope){$scope.greeting="Help",console.log($scope.greeting)}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:MassmailingEditCtrl",["$scope","$routeParams","xpsui:SchemaUtil","xpsui:GenericSearchFactory","xpsui:NotificationFactory","xpsui:SchemaUtil","xpsui:MassmailingFactory",function($scope,$routeParams,SchemaUtilFactory,genericSearchFactory,notificationFactory,schemaUtilFactory,massmailingFactory){function convertSortBy(searchBy){return searchBy?[{f:searchBy.header.field,o:searchBy.direction}]:null}function convertCriteria(crit){var retval=[];return crit.map(function(c){c&&c.attribute&&c.attribute.path&&retval.push({f:c.attribute.path,v:c.value,op:c.operator.value})}),retval.push({f:"contactInfo.email",v:null,op:"neq"}),retval}var schemaUri="uri://registries/mailtemplates#views/mailTemplate/view",peopleSchemaUri="uri://registries/people#views/fullperson/";$scope.selectedTemplate={baseData:{name:"",textTemplate:"",htmlTemplate:""}},$scope.searchDef={},$scope.searchCrit=[],$scope.data=[],$scope.forcedCriterias=[],$scope.selectAll=!0;var pageSize=20;schemaUtilFactory.getCompiledSchema(peopleSchemaUri,"search").success(function(data){$scope.schema=data,$scope.searchDef=genericSearchFactory.parseSearchDef(data),$scope.entity=data.title,$scope.addCrit(),$scope.sortBy={header:data.listFields[0],direction:"asc"},$scope.forcedCriterias=data.forcedCriterias||[]}).error(function(err){notificationFactory.error(err)}),$scope.addCrit=function(){$scope.searchCrit.push({})},$scope.removeCrit=function(index){$scope.searchCrit.splice(index,1)},SchemaUtilFactory.listBySchema(schemaUri).success(function(data){$scope.templates=data}),$scope.search=function(){for(var c=convertCriteria($scope.searchCrit),idx=0;idx<$scope.forcedCriterias.length;idx++)c.push($scope.forcedCriterias[idx]);$scope.lastCriteria=JSON.parse(JSON.stringify(c)),genericSearchFactory.getSearch(peopleSchemaUri,c,convertSortBy($scope.sortBy),0,pageSize).success(function(data){$scope.data=data,genericSearchFactory.getSearchCount(peopleSchemaUri,c).success(function(data){$scope.dataSize=data}).error(function(err){notificationFactory.error(err)})}).error(function(err){notificationFactory.error(err)})},$scope.recipientCount=function(){if($scope.selectAll)return $scope.dataSize;var count=0;for(var index in $scope.data)$scope.data[index].selected&&count++;return count},$scope.setSortBy=function(header){$scope.sortBy&&$scope.sortBy.header===header?"asc"===$scope.sortBy.direction?$scope.sortBy={header:header,direction:"desc"}:$scope.sortBy={header:header,direction:"asc"}:$scope.sortBy={header:header,direction:"desc"},$scope.search()},$scope.searchNext=function(){for(var c=convertCriteria($scope.searchCrit),idx=0;idx<$scope.forcedCriterias.length;idx++)c.push($scope.forcedCriterias[idx]);genericSearchFactory.getSearch(peopleSchemaUri,$scope.lastCriteria,convertSortBy($scope.sortBy),$scope.data.length,pageSize).success(function(data){data.map(function(newItems){$scope.data.push(newItems)})}).error(function(err){notificationFactory.error(err)})},$scope.sendMail=function(){var userIds=null,crits=null;if($scope.selectAll)crits=$scope.lastCriteria;else{userIds=[];for(var index in $scope.data)$scope.data[index].selected&&userIds.push($scope.data[index].id)}massmailingFactory.sendMail($scope.selectedTemplate,crits,userIds).success(function(){notificationFactory.info({translationCode:"massmailing.sent",time:3e3})})}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:PersonalPageCtrl",["$scope","$location",function($scope,$location){console.log("/registry/view/uri~3A~2F~2Fregistries~2Fpeople~23views~2FpersonalProfile/"+$scope.security.currentUser.id),$location.path("/registry/view/uri~3A~2F~2Fregistries~2Fpeople~23views~2FpersonalProfile/"+$scope.security.currentUser.id)}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:PortalEditorCtrl",["$scope","$sce","$http","xpsui:NotificationFactory","$route","$routeParams","$location","xpsui:DateUtil",function($scope,$sce,$http,notificationFactory,$route,$routeParams,$location,dateUtils){function enterEditMode(){$scope.mode="edit",$scope.$broadcast("modechange")}$scope.model={},$scope.templates={index:{name:"Titulok",desc:"Nadpis článku, každý článok by mal mať aspoň jeden nadpis. Nadpis článku sa používa aj ako link v zozname článkov",icon:"img/block-headline.svg",meta:{template:"index",isIndex:!1,isMenu:!1,parentMenu:null,enabled:!0,publishFrom:dateUtils.nowToReverse(),tags:[]},data:[{meta:{type:"pure-html",name:"title",element:"<div></div>"},data:"<h1>...Titulok článku...</h1>"},{meta:{type:"pure-html",name:"abstract",element:'<section class="abstract"></section>'},data:"...Abstrakt článku, krátky popis a zhrnutie..."},{meta:{type:"pure-html",name:"contentBlock",element:'<section class="content"></section'},data:"<p>...Obsah článku...</p>"}]},article:{name:"Article",desc:"Nadpis článku, každý článok by mal mať aspoň jeden nadpis. Nadpis článku sa používa aj ako link v zozname článkov",icon:"img/block-article.svg",meta:{template:"article",enabled:!0,publishFrom:dateUtils.nowToReverse(),tags:[]},data:[{meta:{type:"pure-html",name:"title",element:"<div></div>"},data:"<h1>...Titulok článku...</h1>"},{meta:{type:"pure-html",name:"abstract",element:'<section class="abstract"></section>'},data:"...Abstrakt článku, krátky popis a zhrnutie..."},{meta:{type:"pure-html",name:"contentBlock",element:'<section class="content"></section'},data:"<p>...Obsah článku...</p>"}]},location:{name:"Location",desc:"Nadpis článku, každý článok by mal mať aspoň jeden nadpis. Nadpis článku sa používa aj ako link v zozname článkov",icon:"img/block-article.svg",meta:{template:"location",enabled:!0,publishFrom:dateUtils.nowToReverse(),tags:[]},data:[{meta:{type:"pure-html",name:"title",element:"<div></div>"},data:"<h1>...Titulok článku...</h1>"},{meta:{type:"pure-html",name:"abstract",element:'<section class="abstract"></section>'},data:"...Abstrakt článku, krátky popis a zhrnutie..."},{meta:{type:"pure-html",name:"contentBlock",element:'<section class="content"></section'},data:"<p>...Obsah článku...</p>"}]},news:{name:"News",desc:"Nadpis článku, každý článok by mal mať aspoň jeden nadpis. Nadpis článku sa používa aj ako link v zozname článkov",icon:"img/block-article.svg",meta:{template:"news",enabled:!0,publishFrom:dateUtils.nowToReverse(),tags:[]},data:[{meta:{type:"pure-html",name:"title",element:"<div></div>"},data:"<h1>...Titulok článku...</h1>"},{meta:{type:"pure-html",name:"abstract",element:'<section class="abstract"></section>'},data:"...Abstrakt článku, krátky popis a zhrnutie..."},{meta:{type:"pure-html",name:"contentBlock",element:'<section class="content"></section'},data:"<p>...Obsah článku...</p>"}]},video:{name:"Video",desc:"Nadpis článku, každý článok by mal mať aspoň jeden nadpis. Nadpis článku sa používa aj ako link v zozname článkov",icon:"img/block-article.svg",meta:{template:"video",enabled:!0,publishFrom:dateUtils.nowToReverse(),tags:[]},data:[{meta:{type:"pure-html",name:"title",element:"<div></div>"},data:"<h1>...Titulok článku...</h1>"},{meta:{type:"pure-html",name:"abstract",element:'<section class="abstract"></section>'},data:"...Abstrakt článku, krátky popis a zhrnutie..."},{meta:{type:"pure-html",name:"contentBlock",element:'<section class="content"></section'},data:"<p>...Obsah článku...</p>"}]},photo:{name:"photo",desc:"Nadpis článku, každý článok by mal mať aspoň jeden nadpis. Nadpis článku sa používa aj ako link v zozname článkov",icon:"img/block-article.svg",meta:{template:"photo",enabled:!0,publishFrom:dateUtils.nowToReverse(),tags:[]},data:[{meta:{type:"pure-html",name:"title",element:"<div></div>"},data:"<h1>...Titulok článku...</h1>"},{meta:{type:"pure-html",name:"abstract",element:'<section class="abstract"></section>'},data:"...Abstrakt článku, krátky popis a zhrnutie..."},{meta:{type:"pure-html",name:"contentBlock",element:'<section class="content"></section'},data:"<p>...Obsah článku...</p>"}]},riderszone:{name:"Riderszone",desc:"Nadpis článku, každý článok by mal mať aspoň jeden nadpis. Nadpis článku sa používa aj ako link v zozname článkov",icon:"img/block-article.svg",meta:{template:"riderszone",enabled:!0,publishFrom:dateUtils.nowToReverse(),tags:[]},data:[{meta:{type:"pure-html",name:"title",element:"<div></div>"},data:"<h1>...Titulok článku...</h1>"},{meta:{type:"pure-html",name:"abstract",element:'<section class="abstract"></section>'},data:"...Abstrakt článku, krátky popis a zhrnutie..."},{meta:{type:"pure-html",name:"contentBlock",element:'<section class="content"></section'},data:"<p>...Obsah článku...</p>"}]}},$scope.blocks={title:{meta:{name:"title",element:"<div></div>",type:"pure-html",title:"Titulok",desc:"Nadpis článku, každý článok by mal mať aspoň jeden nadpis. Nadpis článku sa používa ak ako link v zozname článkov",icon:"img/block-headline.svg"},data:"<h1>...Titulok článku...</h1>",css:{cssClass:""}},"abstract":{meta:{name:"abstract",element:'<section class="abstract"></section>',type:"pure-html",title:"Abstrakt",desc:"Krátke zhrnutie článku",icon:"img/block-abstract.svg"},data:"...Abstrakt článku..."},content:{meta:{name:"content",element:'<section class="content"></section>',type:"pure-html",title:"Obsah",desc:"Obsah článku obsahujúci hlavnú časť textu",icon:"img/block-content.svg"},data:"<p>...Obsah článku...</p>"},matchResults:{meta:{name:"match-results",element:'<section class="x-portal-competition-matches"><header>Výsledky</header></section>',type:"match-results",title:"Výsledky",desc:"Časť obsahujúa výsledky súťaží.",icon:"img/block-content.svg"},data:"<h1>Výsledky súťaží</h1>"},link:{meta:{name:"link",title:"Linka",desc:"Linka na inú stránku",icon:"img/block-link.svg",type:"link"},data:{href:"www.example.com",newWindow:!1,title:"Example link"}},image:{meta:{name:"image",element:"<div></div>",type:"image",title:"Obrázok",desc:"Veľký obrázok do článku",icon:"img/block-image.svg"},data:{img:""}},image1170:{meta:{name:"image1170",element:"<div></div>",type:"image1170",title:"Obrázok 1170px x 570px",desc:"Obrázok 1170px x 570px.",icon:"img/block-image.svg"},data:{img:""}},video:{meta:{name:"video",title:"Embedované video",desc:"Embedované video s titulkom a textom",icon:"img/block-video.svg",type:"video"},data:{src:"",title:"Embedované video",subTitle:"video",text:"text k videu"}},fileList:{meta:{name:"file-list",element:"<div></div>",type:"file-list",title:"Súbory",desc:"Zoznam súborov",icon:"img/block-filelist.svg"},data:{files:[]}},category:{meta:{name:"category",element:"<div></div>",type:"category",title:"Kategória",desc:"Zoznam článkov v danej kategórii",icon:"img/block-category.svg"},data:{tags:[]}},overview:{meta:{name:"overview",element:"<div></div>",type:"overview",title:"Prehľad",desc:"Prehľad článkov pod sebou.",icon:"img/block-overview.svg"},data:{tags:[]}},ranking:{meta:{name:"ranking",element:"<div></div>",type:"ranking",title:"Poradie",desc:"Výsledky / poradie súťažiacich.",icon:"img/block-ranking.svg"},data:{results:[]}},gallery:{meta:{name:"gallery",element:"<div></div>",type:"gallery",title:"Galéria",desc:"Galéria fotografií",icon:"img/block-gallery.svg"},data:{images:[]}},showcase:{meta:{name:"showcase",element:"<div></div>",type:"showcase",title:"Výklad",desc:"Najhorúcejšie články v prelínajúcom zobrazení výkladného okna",icon:"img/block-topics.svg"},data:{tags:[]},css:{cssClass:""}},showcasevideo:{meta:{name:"showcasevideo",element:"<div></div>",type:"showcasevideo",title:"Výklad s videami",desc:"Videá v prelínajúcom zobrazení výkladného okna",icon:"img/block-videoshowcase.svg"},data:{tags:[]},css:{cssClass:""}}},console.log($routeParams),$routeParams.id?$http({url:"/udao/get/portalArticles/"+$routeParams.id,method:"GET"}).success(function(data,status,headers,config){$scope.model=data,$scope.viewTemplate=$scope.getViewTemplate()}).error(function(err){notificationFactory.error({translationCode:"registry.unsuccesfully.saved",time:3e3})}):$http({method:"POST",url:"/portalapi/getByTags",data:{tags:["menu:index"]}}).success(function(data,status,headers,config){data&&data.length>0&&data[0].id&&$location.path("/portal/edit/"+data[0].id)}).error(function(err){notificationFactory.error(err)}),$scope.edit=function(){enterEditMode()},$scope.addNew=function(){$scope.model={},angular.copy($scope.templates.article,$scope.model),$scope.viewTemplate=$scope.getViewTemplate(),enterEditMode()},$scope.findSurrogateTitle=function(pageBlocks){if(pageBlocks)for(var i=0;i<pageBlocks.length;i++)if("title"==pageBlocks[i].meta.name)return pageBlocks[i].data.replace("<h1>","").replace("</h1>","");return""},$scope.save=function(){if($scope.model.meta&&($scope.model.meta.lastModTimestamp=(new Date).getTime(),!$scope.model.meta.title)){var surrogateTitle=$scope.findSurrogateTitle($scope.model.data);$scope.model.meta.title=surrogateTitle}$http({url:"/udao/save/portalArticles",method:"PUT",data:$scope.model}).success(function(data,status,headers,config){notificationFactory.clear(),data.id?$location.path("/portal/edit/"+data.id):$scope.model.id&&$route.reload()}).error(function(err){notificationFactory.error({translationCode:"registry.unsuccesfully.saved",time:3e3})})},$scope.cancel=function(){$route.reload()},$scope.showBlockSelector=function(){$scope.blockSelectorShown=!0,document.querySelector("body").classList.add("x-dropdown-open")},$scope.hideBlockSelector=function(){$scope.blockSelectorShown=!1,document.querySelector("body").classList.remove("x-dropdown-open")},$scope.selectBlock=function(block){$scope.blockSelectorShown=!1,document.querySelector("body").classList.remove("x-dropdown-open"),$scope.model.data.push($scope.blocks[block]),$scope.$broadcast("modechange")},$scope.makeSafe=function(str){return $sce.trustAsHtml(str)},$scope.getViewTemplate=function(){return $scope.model&&$scope.model.meta&&$scope.model.meta.template?"/portal/templates/"+$scope.model.meta.template+".html":null},$scope.hoverShowDesc=function(desc){$scope.msg=desc},$scope.hoverCloseWhite=function(){$scope.color="white"},$scope.hoverCloseBlack=function(){$scope.color="black"}}])}(angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:PortalEditorListCtrl",["$scope","$sce","$route","xpsui:SchemaUtil","xpsui:NotificationFactory","$http","$location","xpsui:DateUtil",function($scope,$sce,$route,schemaUtilFactory,notificationFactory,$http,$location,dateUtils){$scope.model=[],$scope.data=[],$scope.sort={ASC:1,DESC:0},$scope.currSort={field:"article.meta.title",order:$scope.sort.ASC},$scope.newCrit={field:"",op:"0",val:""},$scope.searchCrits=[angular.copy($scope.newCrit)],$scope.isSearching=!1,$scope.changeSort=function(newField){$scope.currSort.field==newField?$scope.currSort.order=1-$scope.currSort.order:($scope.currSort.field=newField,$scope.currSort.order=$scope.sort.ASC),$scope.search()},$http({method:"GET",url:"/udao/get/portalArticles",data:{}}).success(function(data,status,headers,config){$scope.data=data}).error(function(err){notificationFactory.error(err)}),$scope.filterFn=function(val){for(var pos=0;pos<$scope.searchCrits.length;pos++){var crit=$scope.searchCrits[pos];if("article.meta.title"==crit.field)return val.meta.title&&val.meta.title.toLowerCase().indexOf(crit.val.toLowerCase())>-1;"article.meta.lastModTimestamp"==crit.field||"article.meta.tags"==crit.field||"article.meta.template"==crit.field}return!0},$scope.search=function(){$scope.model=angular.copy($scope.data),$scope.isSearching=!0,"article.meta.title"==$scope.currSort.field?$scope.model.sort(function(val1,val2){return(2*$scope.currSort.order-1)*(val1.meta.title.toLowerCase()>val2.meta.title.toLowerCase()?1:-1)}):"article.meta.lastModTimestamp"==$scope.currSort.field?$scope.model.sort(function(val1,val2){return(2*$scope.currSort.order-1)*(new Date(val1.meta.lastModTimestamp).getTime()-new Date(val2.meta.lastModTimestamp).getTime())}):"article.meta.tags"==$scope.currSort.field?$scope.model.sort(function(val1,val2){return(2*$scope.currSort.order-1)*(val1.meta.tags.join(",").toLowerCase()>val2.meta.tags.join(",").toLowerCase()?1:-1)}):"article.meta.template"==$scope.currSort.field&&$scope.model.sort(function(val1,val2){return(2*$scope.currSort.order-1)*(val1.meta.template.toLowerCase()>val2.meta.template.toLowerCase()?1:-1)}),$scope.isSearching=!1},$scope.editArticle=function(articleId){var path="/portal/edit/"+articleId;$location.path(path)},$scope.removeCrit=function(index){$scope.searchCrits.splice(index,1)},$scope.addNewCrit=function(){$scope.searchCrits.push(angular.copy($scope.newCrit))},$scope.dateToUI=function(date){return dateUtils.formatter(new Date(date))}}])}(angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:PortalEditorMenuCtrl",["$scope","$sce","$route","xpsui:SchemaUtil","xpsui:NotificationFactory","$http","$location",function($scope,$sce,$route,schemaUtilFactory,notificationFactory,$http,$location){var emptyMenu=(schemaUtilFactory.decodeUri("uri://registries/portal#"),{index:{name:"ROOT",transCode:null,tags:[],hash:"",subElements:[]}});$scope.model=angular.copy(emptyMenu),$scope.cancel=function(){$route.reload()},$scope.save=function(){$http({url:"/udao/save/portalMenu",method:"PUT",data:$scope.model}).success(function(data,status,headers,config){notificationFactory.clear(),$route.reload()}).error(function(err){notificationFactory.error({translationCode:"registry.unsuccesfully.saved",time:3e3})})},$http({method:"GET",url:"/udao/list/portalMenu",data:{}}).success(function(data,status,headers,config){data&&data.length>0&&data[0].index&&($scope.model=data[0])}).error(function(err){notificationFactory.error(err)})}])}(angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:RegistryCustomGenerateCtrl",["$scope","$routeParams","$http","xpsui:GeneratorsGenerator","xpsui:SchemaUtil","xpsui:NotificationFactory",function($scope,$routeParams,$http,generator,schemaUtilFactory,notificationFactory){function toXlsHtml(tableHtml){var retVal='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv=Content-Type content="text/html; charset=utf-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body>';return retVal+=tableHtml,retVal+="</body></html>"}function fillClubLogos(){for(var pos=0;pos<$scope.model.listOfTeam.team.length;pos++)!function(position){var rosterId=$scope.model.listOfTeam.team[position].oid;$http({method:"GET",url:"/udao/getBySchema/uri~3A~2F~2Fregistries~2Frosters~23views~2Frosters~2Fview/"+rosterId,data:{}}).success(function(roster){fillForClub(position,roster.baseData.club.oid)}).error(function(err){callback(err)})}(pos)}function fillForClub(position,clubOid){$http({method:"GET",url:"/udao/getBySchema/uri~3A~2F~2Fregistries~2Forganizations~23views~2Fclub~2Fview/"+clubOid,data:{}}).success(function(club){$scope.model.listOfTeam.team[position].photo=club.logoInfo.photo}).error(function(err){callback(err)})}$scope.model={},$scope.save=function(){generator.save($scope.model,$routeParams.generateBy,function(err,progess){err?notificationFactory.error({translationCode:"registry.unsuccesfully.saved",time:3e3}):notificationFactory.info({translationCode:"registry.succesfully.saved",time:3e3})})},$scope.exportTable=function(id){var element=document.getElementById(id),data=toXlsHtml(element.innerHTML),blob=new Blob([data],{type:"application/vnd.ms-excel;charset=utf-8"}),url=window.webkitURL||window.URL,link=document.createElementNS("http://www.w3.org/1999/xhtml","a");link.href=url.createObjectURL(blob),link.download="export.xls";var event=document.createEvent("MouseEvents");event.initEvent("click",!0,!1),link.dispatchEvent(event)},$http({method:"GET",url:"/udao/getBySchema/"+$routeParams.schemaFrom+"/"+$routeParams.idFrom}).success(function(data,status,headers,config){$scope.model=data,generator.generate(data,$routeParams.generateBy,function(err,progess){err?notificationFactory.error({translationCode:"registry.unsuccesfully.generated",time:3e3}):notificationFactory.info({translationCode:"registry.succesfully.generated",time:3e3}),fillClubLogos()})}).error(function(err){notificationFactory.error(err),fillClubLogos()})}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:RegistryCustomTemplateCtrl",["$scope","$routeParams","$http","xpsui:SchemaUtil","xpsui:NotificationFactory","$location","xpsui:NavigationService",function($scope,$routeParams,$http,schemaUtilFactory,notificationFactory,$location,navigationService){return $scope.model={},$scope.currentSchemaUri=schemaUtilFactory.decodeUri($routeParams.schema),"playerLicenseCard.html"==$routeParams.template||"playerHostingCard.html"==$routeParams.template||"officerCard.html"==$routeParams.template?($scope.model={},$scope.currentSchemaUri=schemaUtilFactory.decodeUri($routeParams.schema),void $http({method:"GET",url:"/udao/getBySchema/"+$routeParams.schema+"/"+$routeParams.id}).success(function(data,status,headers,config){$scope.model=data}).error(function(err){notificationFactory.error(err)})):"createMember.html"==$routeParams.template?void $http({method:"GET",url:"/udao/getBySchema/uri~3A~2F~2Fregistries~2Frequests~23views~2FpeopleRegistrationApplicant~2Fview/"+$routeParams.id}).success(function(data,status,headers,config){delete data.id;var copyFields=[{path:"model.obj",value:data}],uri="/registry/new/uri~3A~2F~2Fregistries~2Fpeople~23views~2Ffullperson";navigationService.navigateToPath(uri,copyFields),$location.path(uri)}).error(function(err){notificationFactory.error(err)}):"createTransfer.html"==$routeParams.template?void $http({method:"GET",url:"/udao/getBySchema/uri~3A~2F~2Fregistries~2Frequests~23views~2FtransferApplicant~2Fview/"+$routeParams.id}).success(function(data,status,headers,config){var copyFields=[{path:"model.obj.baseData",value:data.transferData}],uri="/registry/new/uri~3A~2F~2Fregistries~2Ftransfers~23views~2Ftransfers";navigationService.navigateToPath(uri,copyFields),$location.path(uri)}).error(function(err){notificationFactory.error(err)}):"personalAccountActivation.html"==$routeParams.template?void $http({method:"GET",url:"/udao/getBySchema/uri~3A~2F~2Fregistries~2Fpeople~23views~2Ffullperson~2Fview/"+$routeParams.id}).success(function(data,status,headers,config){$http({method:"GET",url:"/security/profiles"}).success(function(dataProfiles,statusProfiles,headersProfiles,configProfiles){for(var defaultProfile={},pos=0;pos<dataProfiles.length;pos++)"default"==dataProfiles[pos].baseData.name&&(defaultProfile={},defaultProfile.oid=dataProfiles[pos].id,defaultProfile.refData={name:dataProfiles[pos].baseData.name});var email="";data&&data.contactInfo&&(email=data.contactInfo.email);var accountName="";data&&data.baseData&&(accountName=data.baseData.name);var copyFields=[{path:"model.obj.account.email",value:email},{path:"model.obj.account.name",value:accountName},{path:"model.obj.account.profiles",value:[defaultProfile]}],uri="/registry/new/uri~3A~2F~2Fregistries~2FpersonalAccount~23views~2FpersonalAccount";navigationService.navigateToPath(uri,copyFields),$location.path(uri)}).error(function(err){notificationFactory.error(err)})}).error(function(err){notificationFactory.error(err)}):void 0}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:RegistryNewCtrl",["$route","$scope","$parse","$routeParams","$http","$location","xpsui:SchemaUtil","xpsui:NotificationFactory","xpsui:NavigationService",function($route,$scope,$parse,$routeParams,$http,$location,schemaUtilFactory,notificationFactory,navigationService){$scope.currentSchemaUri=schemaUtilFactory.decodeUri($routeParams.schema),$scope.model={},$scope.model.obj={},$scope.schemaFormOptions={modelPath:"model.obj",schema:{}},$scope.save=function(){return $scope.newForm.xpsui.prepareForSubmit(),$scope.newForm.$invalid?void notificationFactory.error({translationCode:"registry.form.not.filled.correctly",time:5e3}):void $http({url:"/udao/saveBySchema/"+schemaUtilFactory.encodeUri(schemaUtilFactory.concatUri($scope.currentSchemaUri,"new")),method:"PUT",data:$scope.model.obj}).success(function(data,status,headers,config){notificationFactory.clear(),$location.path("/registry/view/"+$routeParams.schema+"/"+data.id)}).error(function(err){notificationFactory.error({translationCode:"registry.unsuccesfully.saved",time:3e3})})},$scope.cancel=function(){$route.reload()},schemaUtilFactory.getCompiledSchema($scope.currentSchemaUri,"new").success(function(data){$scope.schemaFormOptions.schema=data,schemaUtilFactory.generateObjectFromSchema($scope.schemaFormOptions.schema,$scope.model.obj);var filler=navigationService.restore();filler&&schemaUtilFactory.fillObj($scope,filler)}).error(function(err){notificationFactory.error(err)})}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:RegistrySearchCtrl",["$scope","$routeParams","xpsui:SchemaUtil","$translate","xpsui:HttpHandlerFactory","$parse","xpsui:logging","xpsui:QueryFilter",function($scope,$routeParams,schemaUtil,$translate,httpFactory,$parse,log,QueryFilter){function fetchData(){$scope.isSearching=!0;for(var qf=QueryFilter.create(),i=0;i<$scope.searchCrits.length;++i)if($scope.searchCrits[i].field){var val=$scope.searchCrits[i].val,path=$scope.searchCrits[i].field.path,fieldDef=$scope.findFieldDefinition($scope.searchCrits[i].field.path);if(fieldDef&&"number"==fieldDef.fragment.type&&val==parseInt(val)&&(val=parseInt(val)),fieldDef&&"object"==fieldDef.fragment.type&&val.oid&&(val=$scope.searchCrits[i].val.oid,path=$scope.searchCrits[i].field.path+".oid"),fieldDef&&"array"==fieldDef.fragment.type&&val&&val.length>0){path=$scope.searchCrits[i].field.path+".oid";for(var oids=[],i=0;i<val.length;i++)oids.push(val[i].oid);qf.addCriterium(path,"in",oids);continue}qf.addCriterium(path,QueryFilter.operation[$scope.searchCrits[i].op.op],val)}for(i=0;i<$scope.schema.listFields.length;++i)qf.addField($scope.schema.listFields[i].field);qf.addField("id"),qf.addSort($scope.currSort.field,$scope.currSort.order).setSkip($scope.currPage*$scope.limit).setLimit($scope.limit+1),console.log(qf),httpHandler.http({url:"/search/"+schemaUtil.encodeUri(schemaUri),method:"POST",data:qf}).then(function(data){var d=data.data;$scope.isSearching=!1,d.length>$scope.limit?($scope.moreData=!0,d=d.slice(0,$scope.limit)):$scope.moreData=!1,$scope.model=$scope.model.concat(d),$scope.data=$scope.data.concat(flattenData(d,$scope.schema.listFields))},function(err){})}function flattenSchema(schema,path,group){var result=[];if(path&&angular.isArray(path)||(path=[]),schema.properties)for(var propertyName in schema.properties)if(schema.properties.hasOwnProperty(propertyName)){var property=schema.properties[propertyName],propertyTitle=$translate.instant(property.transCode||property.title),localPath=path.concat(propertyName);property.properties?result=result.concat(flattenSchema(property,localPath,propertyTitle)):result.push({
name:propertyTitle,path:localPath.join("."),group:group,fragment:property})}return result}function flattenData(data,fields){var result=[];if(data&&angular.isArray(data))for(var d in data){var dataRow={};for(var f in fields)dataRow[fields[f].field]=$parse(fields[f].field)(data[d]);result.push(dataRow)}return result}var httpHandler=httpFactory.newHandler();$scope.objectPathToSchemaPath=function(objPath){return objPath?"properties."+objPath.replace(/\./g,".properties."):null},$scope.fieldWeigth=function(field){if(field.render&&field.render.width){if("narrow"==field.render.width)return"2 0 100px";if("wide"==field.render.width)return"50 0 150px"}return"10 0 200px"},$scope.limit=50,$scope.moreData=!1,$scope.isSearching=!1,$scope.isExporting=!1,$scope.currSort={field:null,order:QueryFilter.sort.ASC},$scope.sort=QueryFilter.sort,$scope.addNewCrit=function(){$scope.searchCrits.push({op:$scope.allOps[0]})},$scope.removeCrit=function(idx){$scope.searchCrits.splice(idx,1)},$scope.changeSort=function(field){$scope.currSort.field==field&&($scope.currSort.order==QueryFilter.sort.ASC?$scope.currSort.order=QueryFilter.sort.DESC:$scope.currSort.order=QueryFilter.sort.ASC),$scope.currSort.field=field,$scope.search()},$scope.filterKeyPressed=function(event){13===event.which&&$scope.search()},$scope.exportCsv=function(){$scope.isExporting=!0,setTimeout(function(){var data=$scope.data,htmlData=[];htmlData.push('<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv=Content-Type content="text/html; charset=utf-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table id="tblExport" style="border:1px solid black; "><thead><tr>');for(var li in $scope.schema.listFields){var lisDef=$scope.schema.listFields[li];htmlData.push("<th>"+lisDef.title+"</th>")}htmlData.push("<tr></thead><tbody>");for(var item=0;item<data.length;item++){htmlData.push("<tr>");for(var li=0;li<$scope.schema.listFields.length;li++){var field=$scope.schema.listFields[li].field,value=data[item][field];if(value&&value.refData){var text="",sep="";for(var key in value.refData)text=text+sep+value.refData[key],sep=" | ";htmlData.push("<td>"+text+"</td>")}else value||0===value?htmlData.push("<td>"+value+"</td>"):htmlData.push("<td></td>")}htmlData.push("</tr>")}htmlData.push("</tbody></table></body></html>");var blob=new Blob([htmlData.join("")],{type:"application/vnd.ms-excel;charset=utf-8"}),url=window.webkitURL||window.URL,link=document.createElementNS("http://www.w3.org/1999/xhtml","a");link.href=url.createObjectURL(blob),link.download="search-export.xls";var event=document.createEvent("MouseEvents");event.initEvent("click",!0,!1),link.dispatchEvent(event),$scope.$apply(function(){$scope.isExporting=!1})},10)},$scope.setSearch=function(field){},$scope.search=function(){$scope.model=[],$scope.data=[],$scope.moreData=!1,$scope.currPage=0,fetchData()},$scope.next=function(){++$scope.currPage,fetchData()},$scope.findFieldDefinition=function(fieldPath){for(var i=0;i<$scope.schemaFields.length;i++)if(fieldPath==$scope.schemaFields[i].path)return $scope.schemaFields[i]};var schemaUri=schemaUtil.decodeUri($routeParams.schema);$scope.schema=null,$scope.model=[],$scope.data=[],$scope.allOps=[];for(var i in QueryFilter.operation)QueryFilter.operation.hasOwnProperty(i)&&$scope.allOps.push({text:$translate.instant("queryfilter.ops."+(QueryFilter.operation[i].text||i)),op:QueryFilter.operation[i].code||i});$scope.searchCrits=[],schemaUtil.getCompiledSchema(schemaUri).success(function(data){$scope.schema=data,$scope.schemaFields=flattenSchema(data,""),$scope.currSort.field=$scope.schema.listFields[0].field,$scope.addNewCrit()}).error(function(){log.error("Failed to get schema")})}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:RegistryViewCtrl",["$scope","$routeParams","$http","$location","xpsui:SchemaUtil","xpsui:NotificationFactory",function($scope,$routeParams,$http,$location,schemaUtilFactory,notificationFactory){$scope.currentSchema=$routeParams.schema,$scope.currentId=$routeParams.id,$scope.currentSchemaUri=schemaUtilFactory.decodeUri($routeParams.schema),$scope.model={},$scope.model.obj={},$scope.schemaFormOptions={modelPath:"model.obj",schema:{}},$scope.save=function(){$http({url:"/udao/saveBySchema/"+schemaUtilFactory.encodeUri(schemaUtilFactory.concatUri($scope.currentSchemaUri,"view")),method:"PUT",data:$scope.model.obj}).success(function(data,status,headers,config){$http({method:"GET",url:"/udao/getBySchema/"+schemaUtilFactory.encodeUri(schemaUtilFactory.concatUri(schemaUri,"view"))+"/"+$scope.currentId}).success(function(data,status,headers,config){schemaUtilFactory.generateObjectFromSchema($scope.schemaFormOptions.schema,$scope.model.obj),$scope.model.obj=data}).error(function(err){notificationFactory.error(err)}),notificationFactory.info({translationCode:"registry.succesfully.saved",time:3e3})}).error(function(data,status,headers,config){if(400===status)for(var item in data.error)data.error[item].map(function(fieldError){notificationFactory.warn({translationCode:fieldError.c,translationData:fieldError.d,time:3e3})});else notificationFactory.error({translationCode:"registry.unsuccesfully.saved",time:3e3})})},$scope.$on("xpsui:model_changed",function(){$scope.save()});var schemaUri=schemaUtilFactory.decodeUri($scope.currentSchema);schemaUtilFactory.getCompiledSchema(schemaUri,"view").success(function(data){$scope.schemaFormOptions.schema=data,$http({method:"GET",url:"/udao/getBySchema/"+schemaUtilFactory.encodeUri(schemaUtilFactory.concatUri(schemaUri,"view"))+"/"+$scope.currentId}).success(function(data,status,headers,config){schemaUtilFactory.generateObjectFromSchema($scope.schemaFormOptions.schema,$scope.model.obj),$scope.model.obj=data}).error(function(err){notificationFactory.error(err)})})}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:SchemaEditorIndexCtrl",["$scope","schemas",function($scope,schemas){$scope.schemaList=schemas}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:SchemaEditorShowCtrl",["$scope","$routeParams","$location","schema","xpsui:SchemaEditorService","xpsui:NotificationFactory",function($scope,$routeParams,$location,schema,schemaService,notificationFactory){$scope.schema=JSON.stringify(schema,null,"	"),$scope.loading=!1,$scope.aceConfig={useWrapMode:!0,showGutter:!0,theme:"twilight",mode:"json",onLoad:function(_editor){_editor.setReadOnly(!1),_editor.getSession().setMode("ace/mode/json"),ace.config.set("basePath","/libs/ace-builds/src")}},$scope.postData=function(data){$scope.loading=!0;try{schemaService.getPostContent($routeParams.schema,JSON.stringify(JSON.parse(data),null,"	")).success(function(data){$location.url("/schema/edit")}).error(function(err){$scope.alert=err,$scope.loading=!1})}catch(err){$scope.loading=!1,notificationFactory.error({type:"error",text:"Nevalidná schéma: "+err.message,deletable:!0,time:-1,timeout:null})}}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:SecurityForgottenCtrl",["$scope","xpsui:SecurityService","$rootScope","$location","$timeout","xpsui:NotificationFactory","$window","reCAPTCHA",function($scope,SecurityService,$rootScope,$location,$timeout,notificationFactory,$window,reCAPTCHA){$scope.email="",$scope.capcha="",$scope.done=!1,SecurityService.getCaptchaKey().success(function(json){reCAPTCHA.destroy(),reCAPTCHA.setPublicKey(json.key),reCAPTCHA.create("captcha"),reCAPTCHA.reload()}).error(function(err,data){var mes={translationCode:err.code,translationData:err.data,time:3e3};notificationFactory.error(mes)}),$scope.submit=function(){SecurityService.getForgotenToken($scope.email,{challenge:reCAPTCHA.challenge(),response:reCAPTCHA.response()}).success(function(data){var mes={translationCode:"security.forgotten.token.generated",time:3e3};notificationFactory.info(mes),$scope.done=!0,$timeout(function(){$location.path("/")},5e3)}).error(function(err,data){var mes={translationCode:err.code,translationData:err.data,time:3e3};notificationFactory.error(mes),$window.Recaptcha.reload()})}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:SecurityForgottenResetCtrl",["$scope","xpsui:SecurityService","$routeParams","$location","$timeout","xpsui:NotificationFactory",function($scope,SecurityService,$routeParams,$location,$timeout,notificationFactory){var token=$routeParams.token;$scope.done=!1,SecurityService.getForgotenPasswordReset(token).success(function(data){var mes={translationCode:"security.forgotten.reset.done",time:3e3};notificationFactory.info(mes),$timeout(function(){$location.path("/")},5e3)}).error(function(err,data){var mes={translationCode:err.code,translationData:err.data,time:3e3};notificationFactory.error(mes)})}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:SecurityGroupEditCtrl",["$scope","xpsui:SecurityService","xpsui:SchemaUtil","xpsui:NotificationFactory","schema",function($scope,SecurityService,schemaUtilFactory,notificationFactory,schema){function fillGroupPerm(group,perms){var retval=[];group.security||(group.security={permissions:{}});var groupper=group.security.permissions;for(var p in groupper)groupper[p]&&(retval.push(p),remove(perms,p));return retval}$scope.groups=[],$scope.selectedGroup=null,$scope.group={},$scope.group.permissions=[],$scope.schemaFormOptions={modelPath:"selectedSchema",schema:{}},$scope.schemaFormOptions.schema=schema;var remove=function(arr,item){for(var i=arr.length;i--;)arr[i]===item&&arr.splice(i,1)};SecurityService.getSecurityGroups().success(function(data){$scope.groups=data}),SecurityService.getSecurityPermissions().success(function(data){$scope.permissions=data}),$scope.addPermission=function(value){$scope.group.permissions.push(value),remove($scope.permissions,value)},$scope.removePermission=function(value){$scope.permissions.push(value),remove($scope.group.permissions,value)},$scope.updateGroupPermissions=function(){SecurityService.updateSecurityGroup($scope.selectedGroup.id,$scope.selectedGroup.baseData.name,$scope.selectedGroup.baseData.id,$scope.group.permissions,$scope.selectedGroup.baseData.parent),$scope.selectedGroup=null,setTimeout(function(){SecurityService.getSecurityGroups().success(function(data){$scope.groups=data})},500)},$scope.selectGroup=function(group){$scope.selectedGroup=group,SecurityService.getSecurityPermissions().success(function(data){$scope.permissions=data,$scope.group.permissions=fillGroupPerm($scope.selectedGroup,data)}).error(function(err){notificationFactory.error(err)})}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:SecurityLoginCtrl",["$scope","xpsui:SecurityService","$rootScope","$location","xpsui:NotificationFactory","xpsui:NavigationService",function($scope,SecurityService,$rootScope,$location,notificationFactory,navigationService){$scope.user="",$scope.password="",$scope.login=function(){SecurityService.getLogin($scope.user,$scope.password).success(function(user){user.systemCredentials.profiles.length>1?$scope.profiles=user.systemCredentials.profiles:SecurityService.selectProfile(user.systemCredentials.profiles[0].id).success(function(){SecurityService.getCurrentUser().success(function(data){$rootScope.security.currentUser=data,navigationService.back()||$location.path("/personal-page")})})}).error(function(err){err&&console.log(err),delete $rootScope.security.currentUser;var mes={translationCode:"login.authentication.failed",time:5e3};notificationFactory.error(mes)})},$scope.selectProfile=function(){$scope.selectedProfile&&SecurityService.selectProfile($scope.selectedProfile.id).success(function(){SecurityService.getCurrentUser().success(function(data){$rootScope.security.currentUser=data,navigationService.back()||$location.path("/personal-page")})})},$scope.resetPassword=function(){SecurityService.getResetPassword($scope.user)}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:SecurityLogoutCtrl",["$scope","xpsui:SecurityService","$location",function($scope,SecurityService,$location){$scope.logout=function(){SecurityService.getLogout().then(function(){$scope.security.currentUser=void 0,$location.path("/login")})}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:SecurityPersonalChangePasswordCtrl",["$scope","xpsui:SecurityService","$rootScope","$location","xpsui:NotificationFactory",function($scope,SecurityService,$rootScope,$location,notificationFactory){$scope.currentPassword="",$scope.newPassword="",$scope.newPasswordCheck="",$scope.changePassword=function(){if($scope.newPassword!==$scope.newPasswordCheck){var mes={translationCode:"personal.change.password.passwords.not.equal"};notificationFactory.warn(mes)}else SecurityService.getChangePassword($scope.currentPassword,$scope.newPassword).success(function(data){var mes={translationCode:"personal.change.password.password.changed"};notificationFactory.info(mes)}).error(function(err,data){if(400==data){var mes={translationCode:err.code,translationData:data,time:3e3};notificationFactory.error(mes)}else{var mes={translationCode:"security.user.missing.permissions",translationData:data,time:3e3};notificationFactory.error(mes)}})}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:SecurityProfileEditCtrl",["$scope","$routeParams","xpsui:SecurityService","xpsui:GenericSearchFactory","xpsui:SchemaUtil","xpsui:NotificationFactory",function($scope,$routeParams,securityService,genericSearchFactory,schemaUtilFactory,notificationFactory){function mapOperator(operator){for(var op in $scope.searchDef.operators)if($scope.searchDef.operators[op].value===operator)return $scope.searchDef.operators[op]}function mapAttribute(attributes,attribute){for(var att in attributes)if(attributes[att].path===attribute)return attributes[att]}function convertCriteria(crit){var retval=[];return crit.map(function(c){c&&c.attribute&&c.attribute.path&&(c.attribute.objectLink2?retval.push({f:c.attribute.path,v:c.object.oid,op:c.operator.value}):retval.push({f:c.attribute.path,v:c.value,op:c.operator.value}))}),retval}function convertProfileCriteria(crit){var retval=[];return crit.map(function(c){c&&c.attribute&&c.attribute.path&&(c.attribute.render&&c.attribute.render.objectLink2?retval.push({schema:c.schema,f:c.attribute.path,v:c.obj?c.obj.oid:null,expr:c.expr,op:c.operator.value,obj:c.obj}):retval.push({schema:c.schema,f:c.attribute.path,v:c.value,expr:c.expr,op:c.operator.value}))}),retval}function remove(arr,item){for(var i=arr.length;i--;)arr[i]===item&&arr.splice(i,1)}function fillProfilePerm(profile,perms){var retval=[];if("security"in profile&&"permissions"in profile.security)for(var per in profile.security.permissions)profile.security.permissions[per]&&(retval.push(per),remove(perms,per));return retval}function fillProfileGroups(profile,groups){var retval=[];"security"in profile||(profile.security={}),"groups"in profile.security||(profile.security.groups=[]);for(var ug in profile.security.groups){var profilegroup=profile.security.groups[ug];groups.map(function(item){profilegroup.id===item.id&&(retval.push(item),remove(groups,item))})}return retval}var entityUri="uri://registries/security#profilesmaster";$scope.profileList=[],$scope.selectedProfile=null,$scope.profile={},$scope.profile.permissions=[],$scope.profile.groups=[],$scope.removeCrit=function(index){$scope.searchCrit.splice(index,1)},$scope.searchCrit=[],$scope.profileCrit=[],$scope.editCrit=function(index){$scope.critTempAtt=$scope.searchCrit[index].attribute,$scope.critTempOper=$scope.searchCrit[index].oper,$scope.critTempVal=$scope.searchCrit[index].value},$scope.addCrit=function(){$scope.searchCrit.push({})},$scope.addProfileCrit=function(){$scope.profileCrit.push({})},$scope.removeProfileCrit=function(index){$scope.profileCrit.splice(index,1)},$scope.schemaChange=function(crit,done){schemaUtilFactory.getCompiledSchema(crit.schema).success(function(data){crit.attDef=genericSearchFactory.parseSearchDef(data),done&&done(crit)}).error(function(err){notificationFactory.error(err)})},schemaUtilFactory.getCompiledSchema(entityUri,"search").success(function(data){$scope.searchDef=genericSearchFactory.parseSearchDef(data),$scope.schema=data,$scope.addCrit({})}).error(function(err){notificationFactory.error(err)}),securityService.getSecuritySearchSchemas().success(function(data){$scope.searchSchemas=data}).error(function(err){notificationFactory.error(err)}),$scope.search=function(){genericSearchFactory.getSearch(entityUri,convertCriteria($scope.searchCrit)).success(function(data){$scope.profileList=data}).error(function(err){notificationFactory.error(err)})},$scope.addPermission=function(value){$scope.profile.permissions.push(value),remove($scope.permissions,value)},$scope.removePermission=function(value){$scope.permissions.push(value),remove($scope.profile.permissions,value)},$scope.addGroup=function(value){$scope.profile.groups.push(value),remove($scope.groups,value)},$scope.removeGroup=function(value){$scope.groups.push(value),remove($scope.profile.groups,value)},$scope.selectProfile=function(profile){$scope.selectedProfile=profile,$scope.profileCrit=[],"security"in profile||(profile.security={}),"groups"in profile.security||(profile.security.groups=[]),"forcedCriteria"in profile.security&&profile.security.forcedCriteria.map(function(schemaCrit){schemaCrit.crits.map(function(crit){var modelCrit={schema:schemaCrit.applySchema,operator:mapOperator(crit.op),attribute:crit.f,value:crit.v};$scope.schemaChange(modelCrit,function(c){c.attribute=mapAttribute(c.attDef.attributes,c.attribute),c.obj=crit.obj,c.expr=crit.expr,$scope.profileCrit.push(c)})})}),securityService.getSecurityPermissions().success(function(data){$scope.permissions=data,$scope.profile.permissions=fillProfilePerm($scope.selectedProfile,data)}).error(function(err){notificationFactory.error(err)}),securityService.getSecurityGroups().success(function(data){$scope.groups=data,$scope.profile.groups=fillProfileGroups($scope.selectedProfile,$scope.groups)}).error(function(err){notificationFactory.error(err)})},$scope.updateProfileSecurity=function(){securityService.updateProfileSecurity($scope.selectedProfile.id,$scope.selectedProfile.baseData.name,$scope.profile.permissions,$scope.profile.groups,convertProfileCriteria($scope.profileCrit)).success(function(data){notificationFactory.info({translationCode:"security.profile.edit.modification.done",time:3e3}),$scope.search()}).error(function(err){console.log(err),notificationFactory.error(err)})},$scope.fieldKeyDown=function($event){return 13==$event.keyCode?($scope.search(),$event.preventDefault(),!1):void 0}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:SecurityUserEditCtrl",["$scope","$routeParams","xpsui:SecurityService","xpsui:GenericSearchFactory","xpsui:SchemaUtil","xpsui:NotificationFactory",function($scope,$routeParams,securityService,genericSearchFactory,schemaUtilFactory,notificationFactory){function convertCriteria(crit){var retval=[];return crit.map(function(c){c.attribute&&c.attribute.path&&c.operator.value&&(c.value||(c.value=""),retval.push({f:c.attribute.path,v:c.value,op:c.operator.value}))}),retval}function convertSortBy(searchBy){return searchBy?[{f:searchBy.header.field,o:searchBy.direction}]:null}function remove(arr,item){for(var i=arr.length;i--;)arr[i]===item&&arr.splice(i,1)}function fillUserProfiles(user,groups){var retval=[];return"systemCredentials"in user||(user.systemCredentials={}),"profiles"in user.systemCredentials||(user.systemCredentials.profiles=[]),user.systemCredentials.profiles.map(function(pr){groups.map(function(item){pr===item.id&&(retval.push(item),remove(groups,item))})}),retval}function convertProfiles(profiles){var retval=[];for(var profile in profiles)retval.push(profiles[profile].id);return retval}var entityUri="uri://registries/userSecurity",pageSize=20;$scope.userList=[],$scope.selectedUser=null,$scope.user={},$scope.profiles=[],$scope.user.profiles=[],$scope.removeCrit=function(index){$scope.searchCrit.splice(index,1)},$scope.searchCrit=[],$scope.editCrit=function(index){$scope.critTempAtt=$scope.searchCrit[index].attribute,$scope.critTempOper=$scope.searchCrit[index].oper,$scope.critTempVal=$scope.searchCrit[index].value},$scope.addCrit=function(){$scope.searchCrit.push({})},schemaUtilFactory.getCompiledSchema(entityUri,"search").success(function(data){$scope.searchDef=genericSearchFactory.parseSearchDef(data),$scope.schema=data,$scope.addCrit({})}).error(function(err){notificationFactory.error(err)}),$scope.search=function(){var c=convertCriteria($scope.searchCrit);$scope.lastCriteria=JSON.parse(JSON.stringify(c)),genericSearchFactory.getSearch(entityUri,c,convertSortBy($scope.sortBy),0,pageSize).success(function(data){$scope.userList=data}).error(function(err){notificationFactory.error(err)})},$scope.searchNext=function(){convertCriteria($scope.searchCrit);genericSearchFactory.getSearch(entityUri,$scope.lastCriteria,convertSortBy($scope.sortBy),$scope.userList.length,pageSize).success(function(data){data.map(function(newItems){$scope.userList.push(newItems)})}).error(function(err){notificationFactory.error(err)})},$scope.addProfile=function(value){$scope.user.profiles.push(value),remove($scope.profiles,value)},$scope.removeProfile=function(value){$scope.profiles.push(value),remove($scope.user.profiles,value)},$scope.selectUser=function(user){$scope.selectedUser=user,securityService.getSecurityProfiles().success(function(data){$scope.profiles=data,$scope.user.profiles=fillUserProfiles($scope.selectedUser,data)}).error(function(err){notificationFactory.error(err)}),"systemCredentials"in user||(user.systemCredentials={},"contactInfo"in user&&"email"in user.contactInfo?(user.systemCredentials.login={loginName:user.contactInfo.email,email:user.contactInfo.email},setTimeout($scope.updateUserSecurity(),2e3)):(user.systemCredentials={},user.systemCredentials.login={loginName:""}))},$scope.updateUserSecurity=function(){securityService.updateUserSecurity($scope.selectedUser.id,$scope.selectedUser.systemCredentials.login.loginName,$scope.selectedUser.systemCredentials.login.email,convertProfiles($scope.user.profiles)).success(function(){notificationFactory.info({translationCode:"security.user.edit.modification.done",time:3e3}),$scope.search()}).error(function(err){console.log(err),notificationFactory.error(err)})},$scope.resetPassword=function(){securityService.updateUserSecurity($scope.selectedUser.id,$scope.selectedUser.systemCredentials.login.loginName,$scope.selectedUser.systemCredentials.login.email,$scope.user.permissions,$scope.user.groups,$scope.user.profiles).success(function(){securityService.getResetPassword($scope.selectedUser.id).success(function(){notificationFactory.info({type:"info",text:"Nové heslo bolo zaslané na: "+$scope.selectedUser.systemCredentials.login.email,deletable:!0,time:5e3,timeout:null})}).error(function(err){console.log(err),notificationFactory.error(err)})}).error(function(err){console.log(err),notificationFactory.error(err)})},$scope.fieldKeyDown=function($event){return 13==$event.keyCode?($scope.search(),$event.preventDefault(),!1):void 0}}])}(window.angular),function(angular){"use strict";angular.module("xpsui:controllers").controller("xpsui:StatisticsViewCtrl",["$scope","$routeParams","$http","$location","xpsui:SchemaUtil","xpsui:NotificationFactory","xpsui:StatisticsServiceFactory",function($scope,$routeParams,$http,$location,schemaUtilFactory,notificationFactory,StatisticsServiceFactory){var generateObjectFromSchema=function(schema,obj){var _obj=obj;angular.forEach(schema.properties,function(value,key){"object"===value.type?(_obj[key]={},generateObjectFromSchema(value,_obj[key])):_obj[key]=""})};$scope.currentId=$routeParams.id,$scope.currentSchemaUri="uri://registries/statistics",$scope.currentSchema=schemaUtilFactory.encodeUri($scope.currentSchemaUri),$scope.model={},$scope.model.obj={},$scope.schemaFormOptions={modelPath:"model.obj",schema:{}},$scope.save=function(){};var schemaUri="uri://registries/statistics";schemaUtilFactory.getCompiledSchema(schemaUri,"view").success(function(data){$scope.schemaFormOptions.schema=data,StatisticsServiceFactory.getStatisticsData().success(function(data,status,headers,config){generateObjectFromSchema($scope.schemaFormOptions.schema,$scope.model.obj),$scope.model.obj=data}).error(function(err){notificationFactory.error(err)})})}])}(window.angular),function(angular){"use strict";angular.module("xpsui:filters",[])}(angular),function(angular){"use strict";angular.module("xpsui:filters").filter("dateToString",function(){return function(value){if(value){var year=value.substring(0,4),month=value.substring(4,6),day=value.substring(6,8);if(4===year.length&&2===month.length&&2===day.length){var d=new Date(year,month-1,day);return d.getDate()+"."+(d.getMonth()+1)+"."+d.getFullYear()}return value}return""}})}(window.angular),function(angular){"use strict";angular.module("xpsui:filters").filter("httpPrefixed",function(){return function(value){return value&&(value.toLowerCase().startsWith("http://")||value.toLowerCase().startsWith("https://"))?value:"http://"+value}})}(window.angular),function(angular){"use strict";angular.module("xpsui:filters").filter("xpsuiuriescape",["xpsui:SchemaUtil",function(schemaUtilFactory){return function(data){return schemaUtilFactory.encodeUri(data)}}])}(window.angular);
//# sourceMappingURL=xpsui.min.js.map